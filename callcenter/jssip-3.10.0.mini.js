!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JsSIP=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var Utils=require("./Utils"),JsSIP_C=require("./Constants"),Grammar=require("./Grammar"),URI=require("./URI"),Socket=require("./Socket"),Exceptions=require("./Exceptions"),checks=(exports.settings={authorization_user:null,password:null,realm:null,ha1:null,authorization_jwt:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:JsSIP_C.UPDATE,session_timers_force_refresher:!1,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:JsSIP_C.CONNECTION_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:JsSIP_C.CONNECTION_RECOVERY_MIN_INTERVAL,extra_headers:null,via_host:"".concat(Utils.createRandomToken(12),".invalid")},{mandatory:{sockets:function(_sockets2){var _sockets=[];if(Socket.isSocket(_sockets2))_sockets.push({socket:_sockets2});else{if(!Array.isArray(_sockets2)||!_sockets2.length)return;var _step,_iterator=_createForOfIteratorHelper(_sockets2);try{for(_iterator.s();!(_step=_iterator.n()).done;){var socket=_step.value;Object.prototype.hasOwnProperty.call(socket,"socket")&&Socket.isSocket(socket.socket)?_sockets.push(socket):Socket.isSocket(socket)&&_sockets.push({socket:socket})}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return _sockets},uri:function(_uri){/^sip:/i.test(_uri)||(_uri="".concat(JsSIP_C.SIP,":").concat(_uri));_uri=URI.parse(_uri);if(_uri&&_uri.user)return _uri}},optional:{authorization_user:function(_authorization_user){if(-1!==Grammar.parse('"'.concat(_authorization_user,'"'),"quoted_string"))return _authorization_user},authorization_jwt:function(_authorization_jwt){if("string"==typeof _authorization_jwt)return _authorization_jwt},user_agent:function(_user_agent){if("string"==typeof _user_agent)return _user_agent},connection_recovery_max_interval:function(_connection_recovery_max_interval){if(Utils.isDecimal(_connection_recovery_max_interval)){_connection_recovery_max_interval=Number(_connection_recovery_max_interval);if(0<_connection_recovery_max_interval)return _connection_recovery_max_interval}},connection_recovery_min_interval:function(_connection_recovery_min_interval){if(Utils.isDecimal(_connection_recovery_min_interval)){_connection_recovery_min_interval=Number(_connection_recovery_min_interval);if(0<_connection_recovery_min_interval)return _connection_recovery_min_interval}},contact_uri:function(_contact_uri){if("string"==typeof _contact_uri){_contact_uri=Grammar.parse(_contact_uri,"SIP_URI");if(-1!==_contact_uri)return _contact_uri}},display_name:function(_display_name){return _display_name},instance_id:function(_instance_id){if(/^uuid:/i.test(_instance_id)&&(_instance_id=_instance_id.substr(5)),-1!==Grammar.parse(_instance_id,"uuid"))return _instance_id},no_answer_timeout:function(_no_answer_timeout){if(Utils.isDecimal(_no_answer_timeout)){_no_answer_timeout=Number(_no_answer_timeout);if(0<_no_answer_timeout)return _no_answer_timeout}},session_timers:function(_session_timers){if("boolean"==typeof _session_timers)return _session_timers},session_timers_refresh_method:function(method){if("string"==typeof method&&((method=method.toUpperCase())===JsSIP_C.INVITE||method===JsSIP_C.UPDATE))return method},session_timers_force_refresher:function(_session_timers_force_refresher){if("boolean"==typeof _session_timers_force_refresher)return _session_timers_force_refresher},password:function(_password){return String(_password)},realm:function(_realm){return String(_realm)},ha1:function(_ha){return String(_ha)},register:function(_register){if("boolean"==typeof _register)return _register},register_expires:function(_register_expires){if(Utils.isDecimal(_register_expires)){_register_expires=Number(_register_expires);if(0<_register_expires)return _register_expires}},registrar_server:function(_registrar_server){/^sip:/i.test(_registrar_server)||(_registrar_server="".concat(JsSIP_C.SIP,":").concat(_registrar_server));_registrar_server=URI.parse(_registrar_server);if(_registrar_server&&!_registrar_server.user)return _registrar_server},use_preloaded_route:function(_use_preloaded_route){if("boolean"==typeof _use_preloaded_route)return _use_preloaded_route},extra_headers:function(_extra_headers){var _extraHeaders=[];if(Array.isArray(_extra_headers)&&_extra_headers.length){var _step2,_iterator2=_createForOfIteratorHelper(_extra_headers);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var header=_step2.value;"string"==typeof header&&_extraHeaders.push(header)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return _extraHeaders}}}});exports.load=function(dst,src){for(var parameter in checks.mandatory){if(!src.hasOwnProperty(parameter))throw new Exceptions.ConfigurationError(parameter);var value=src[parameter],checked_value=checks.mandatory[parameter](value);if(void 0===checked_value)throw new Exceptions.ConfigurationError(parameter,value);dst[parameter]=checked_value}for(var _parameter in checks.optional)if(src.hasOwnProperty(_parameter)){var _value=src[_parameter];if(!Utils.isEmpty(_value)){var _checked_value=checks.optional[_parameter](_value);if(void 0===_checked_value)throw new Exceptions.ConfigurationError(_parameter,_value);dst[_parameter]=_checked_value}}}},{"./Constants":2,"./Exceptions":6,"./Grammar":7,"./Socket":22,"./URI":27,"./Utils":28}],2:[function(require,module,exports){"use strict";require=require("../package.json");module.exports={USER_AGENT:"".concat(require.title," ").concat(require.version),SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",DTMF_TRANSPORT:{INFO:"INFO",RFC2833:"RFC2833"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60,CONNECTION_RECOVERY_MAX_INTERVAL:30,CONNECTION_RECOVERY_MIN_INTERVAL:2}},{"../package.json":40}],3:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}var Logger=require("./Logger"),SIPMessage=require("./SIPMessage"),JsSIP_C=require("./Constants"),Transactions=require("./Transactions"),Dialog_RequestSender=require("./Dialog/RequestSender"),Utils=require("./Utils"),logger=new Logger("Dialog"),C={STATUS_EARLY:1,STATUS_CONFIRMED:2,STATUS_TERMINATED:3};module.exports=function(){function Dialog(owner,message,type){var state=3<arguments.length&&void 0!==arguments[3]?arguments[3]:C.STATUS_CONFIRMED,instance=this,Constructor=Dialog;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");if(this._owner=owner,this._ua=owner._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!message.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};message instanceof SIPMessage.IncomingResponse&&(state=message.status_code<200?C.STATUS_EARLY:C.STATUS_CONFIRMED);instance=message.parseHeader("contact");"UAS"===type?(this._id={call_id:message.call_id,local_tag:message.to_tag,remote_tag:message.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=state,this._remote_seqnum=message.cseq,this._local_uri=message.parseHeader("to").uri,this._remote_uri=message.parseHeader("from").uri,this._remote_target=instance.uri,this._route_set=message.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):"UAC"===type&&(this._id={call_id:message.call_id,local_tag:message.from_tag,remote_tag:message.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=state,this._local_seqnum=message.cseq,this._local_uri=message.parseHeader("from").uri,this._remote_uri=message.parseHeader("to").uri,this._remote_target=instance.uri,this._route_set=message.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),logger.debug("new ".concat(type," dialog created with status ").concat(this._state===C.STATUS_EARLY?"EARLY":"CONFIRMED"))}return _createClass(Dialog,null,[{key:"C",get:function(){return C}}]),_createClass(Dialog,[{key:"isTerminated",value:function(){return this._status===C.STATUS_TERMINATED}},{key:"update",value:function(message,type){this._state=C.STATUS_CONFIRMED,logger.debug("dialog ".concat(this._id.toString(),"  changed to CONFIRMED state")),"UAC"===type&&(this._route_set=message.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){logger.debug("dialog ".concat(this._id.toString()," deleted")),this._ua.destroyDialog(this),this._state=C.STATUS_TERMINATED}},{key:"sendRequest",value:function(method){var _this=this,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},extraHeaders=Utils.cloneArray(options.extraHeaders),eventHandlers=Utils.cloneObject(options.eventHandlers),options=options.body||null,method=this._createRequest(method,extraHeaders,options);return eventHandlers.onAuthenticated=function(){_this._local_seqnum+=1},new Dialog_RequestSender(this,method,eventHandlers).send(),method}},{key:"receiveRequest",value:function(request){this._checkInDialogRequest(request)&&(request.method===JsSIP_C.ACK&&null!==this._ack_seqnum?this._ack_seqnum=null:request.method===JsSIP_C.INVITE&&(this._ack_seqnum=request.cseq),this._owner.receiveRequest(request))}},{key:"_createRequest",value:function(method,extraHeaders,body){extraHeaders=Utils.cloneArray(extraHeaders),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));var cseq=method===JsSIP_C.CANCEL||method===JsSIP_C.ACK?this._local_seqnum:this._local_seqnum+=1;return new SIPMessage.OutgoingRequest(method,this._remote_target,this._ua,{cseq:cseq,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},extraHeaders,body)}},{key:"_checkInDialogRequest",value:function(request){var retryAfter,_this2=this;if(this._remote_seqnum)if(request.cseq<this._remote_seqnum){if(request.method!==JsSIP_C.ACK)return request.reply(500),!1;if(null===this._ack_seqnum||request.cseq!==this._ack_seqnum)return!1}else request.cseq>this._remote_seqnum&&(this._remote_seqnum=request.cseq);else this._remote_seqnum=request.cseq;if(request.method===JsSIP_C.INVITE||request.method===JsSIP_C.UPDATE&&request.body){if(!0===this._uac_pending_reply)request.reply(491);else{if(!0===this._uas_pending_reply)return retryAfter=1+(10*Math.random()|0),request.reply(500,null,["Retry-After:".concat(retryAfter)]),!1;this._uas_pending_reply=!0,request.server_transaction.on("stateChanged",function stateChanged(){request.server_transaction.state!==Transactions.C.STATUS_ACCEPTED&&request.server_transaction.state!==Transactions.C.STATUS_COMPLETED&&request.server_transaction.state!==Transactions.C.STATUS_TERMINATED||(request.server_transaction.removeListener("stateChanged",stateChanged),_this2._uas_pending_reply=!1)})}request.hasHeader("contact")&&request.server_transaction.on("stateChanged",function(){request.server_transaction.state===Transactions.C.STATUS_ACCEPTED&&(_this2._remote_target=request.parseHeader("contact").uri)})}else request.method===JsSIP_C.NOTIFY&&request.hasHeader("contact")&&request.server_transaction.on("stateChanged",function(){request.server_transaction.state===Transactions.C.STATUS_COMPLETED&&(_this2._remote_target=request.parseHeader("contact").uri)});return!0}},{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(num){this._local_seqnum=num}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(pending){this._uac_pending_reply=pending}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}}]),Dialog}()},{"./Constants":2,"./Dialog/RequestSender":4,"./Logger":9,"./SIPMessage":21,"./Transactions":24,"./Utils":28}],4:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var JsSIP_C=require("../Constants"),Transactions=require("../Transactions"),RequestSender=require("../RequestSender"),EventHandlers={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}};module.exports=function(){function DialogRequestSender(dialog,request,eventHandlers){if(!(this instanceof DialogRequestSender))throw new TypeError("Cannot call a class as a function");for(var handler in this._dialog=dialog,this._ua=dialog._ua,this._request=request,this._eventHandlers=eventHandlers,this._reattempt=!1,this._reattemptTimer=null,EventHandlers)!Object.prototype.hasOwnProperty.call(EventHandlers,handler)||this._eventHandlers[handler]||(this._eventHandlers[handler]=EventHandlers[handler])}var Constructor,protoProps,staticProps;return Constructor=DialogRequestSender,(protoProps=[{key:"send",value:function(){var _this=this,request_sender=new RequestSender(this._ua,this._request,{onRequestTimeout:function(){_this._eventHandlers.onRequestTimeout()},onTransportError:function(){_this._eventHandlers.onTransportError()},onAuthenticated:function(request){_this._eventHandlers.onAuthenticated(request)},onReceiveResponse:function(response){_this._receiveResponse(response)}});request_sender.send(),(this._request.method===JsSIP_C.INVITE||this._request.method===JsSIP_C.UPDATE&&this._request.body)&&request_sender.clientTransaction.state!==Transactions.C.STATUS_TERMINATED&&(this._dialog.uac_pending_reply=!0,request_sender.clientTransaction.on("stateChanged",function stateChanged(){request_sender.clientTransaction.state!==Transactions.C.STATUS_ACCEPTED&&request_sender.clientTransaction.state!==Transactions.C.STATUS_COMPLETED&&request_sender.clientTransaction.state!==Transactions.C.STATUS_TERMINATED||(request_sender.clientTransaction.removeListener("stateChanged",stateChanged),_this._dialog.uac_pending_reply=!1)}))}},{key:"_receiveResponse",value:function(response){var _this2=this;408===response.status_code||481===response.status_code?this._eventHandlers.onDialogError(response):response.method!==JsSIP_C.INVITE||491!==response.status_code||this._reattempt?200<=response.status_code&&response.status_code<300?this._eventHandlers.onSuccessResponse(response):300<=response.status_code&&this._eventHandlers.onErrorResponse(response):(this._request.cseq=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(function(){_this2._dialog.isTerminated()||(_this2._reattempt=!0,_this2.send())},1e3))}},{key:"request",get:function(){return this._request}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),DialogRequestSender}()},{"../Constants":2,"../RequestSender":20,"../Transactions":24}],5:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Logger=require("./Logger"),Utils=require("./Utils"),logger=new Logger("DigestAuthentication");module.exports=function(){function DigestAuthentication(credentials){if(!(this instanceof DigestAuthentication))throw new TypeError("Cannot call a class as a function");this._credentials=credentials,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}var Constructor,protoProps,staticProps;return Constructor=DigestAuthentication,(protoProps=[{key:"get",value:function(parameter){switch(parameter){case"realm":return this._realm;case"ha1":return this._ha1;default:return void logger.warn('get() | cannot get "%s" parameter',parameter)}}},{key:"authenticate",value:function(_ref,challenge){var method=_ref.method,ruri=_ref.ruri,_ref=_ref.body,cnonce=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(this._algorithm=challenge.algorithm,this._realm=challenge.realm,this._nonce=challenge.nonce,this._opaque=challenge.opaque,this._stale=challenge.stale,this._algorithm){if("MD5"!==this._algorithm)return logger.warn('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return logger.warn("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return logger.warn("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return logger.warn("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return logger.warn('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(challenge.qop)if(-1<challenge.qop.indexOf("auth-int"))this._qop="auth-int";else{if(!(-1<challenge.qop.indexOf("auth")))return logger.warn('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=method,this._uri=ruri,this._cnonce=cnonce||Utils.createRandomToken(12),this._nc+=1;var a2,ha2,challenge=Number(this._nc).toString(16);return this._ncHex="00000000".substr(0,8-challenge.length)+challenge,4294967296===this._nc&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=Utils.calculateMD5("".concat(this._credentials.username,":").concat(this._realm,":").concat(this._credentials.password)):this._ha1=this._credentials.ha1,"auth"===this._qop?(a2="".concat(this._method,":").concat(this._uri),ha2=Utils.calculateMD5(a2),logger.debug('authenticate() | using qop=auth [a2:"%s"]',a2),this._response=Utils.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth:").concat(ha2))):"auth-int"===this._qop?(a2="".concat(this._method,":").concat(this._uri,":").concat(Utils.calculateMD5(_ref||"")),ha2=Utils.calculateMD5(a2),logger.debug('authenticate() | using qop=auth-int [a2:"%s"]',a2),this._response=Utils.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(this._ncHex,":").concat(this._cnonce,":auth-int:").concat(ha2))):null===this._qop&&(a2="".concat(this._method,":").concat(this._uri),ha2=Utils.calculateMD5(a2),logger.debug('authenticate() | using qop=null [a2:"%s"]',a2),this._response=Utils.calculateMD5("".concat(this._ha1,":").concat(this._nonce,":").concat(ha2))),logger.debug("authenticate() | response generated"),!0}},{key:"toString",value:function(){var auth_params=[];if(this._response)return auth_params.push("algorithm=".concat(this._algorithm)),auth_params.push('username="'.concat(this._credentials.username,'"')),auth_params.push('realm="'.concat(this._realm,'"')),auth_params.push('nonce="'.concat(this._nonce,'"')),auth_params.push('uri="'.concat(this._uri,'"')),auth_params.push('response="'.concat(this._response,'"')),this._opaque&&auth_params.push('opaque="'.concat(this._opaque,'"')),this._qop&&(auth_params.push("qop=".concat(this._qop)),auth_params.push('cnonce="'.concat(this._cnonce,'"')),auth_params.push("nc=".concat(this._ncHex))),"Digest ".concat(auth_params.join(", "));throw new Error("response field does not exist, cannot generate Authorization header")}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),DigestAuthentication}()},{"./Logger":9,"./Utils":28}],6:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(Class){if(null===Class||-1===Function.toString.call(Class).indexOf("[native code]"))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,Class)})(Class)}function _construct(Parent,args,Class){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(Parent,args,Class){var a=[null];a.push.apply(a,args);args=new(Function.bind.apply(Parent,a));return Class&&_setPrototypeOf(args,Class.prototype),args}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var ConfigurationError=function(){_inherits(ConfigurationError,_wrapNativeSuper(Error));var _super=_createSuper(ConfigurationError);function ConfigurationError(parameter,value){var _this;return _classCallCheck(this,ConfigurationError),(_this=_super.call(this)).code=1,_this.name="CONFIGURATION_ERROR",_this.parameter=parameter,_this.value=value,_this.message=_this.value?"Invalid value ".concat(JSON.stringify(_this.value),' for parameter "').concat(_this.parameter,'"'):"Missing parameter: ".concat(_this.parameter),_this}return ConfigurationError}(),InvalidStateError=function(){_inherits(InvalidStateError,_wrapNativeSuper(Error));var _super2=_createSuper(InvalidStateError);function InvalidStateError(status){var _this2;return _classCallCheck(this,InvalidStateError),(_this2=_super2.call(this)).code=2,_this2.name="INVALID_STATE_ERROR",_this2.status=status,_this2.message="Invalid status: ".concat(status),_this2}return InvalidStateError}(),NotSupportedError=function(){_inherits(NotSupportedError,_wrapNativeSuper(Error));var _super3=_createSuper(NotSupportedError);function NotSupportedError(message){var _this3;return _classCallCheck(this,NotSupportedError),(_this3=_super3.call(this)).code=3,_this3.name="NOT_SUPPORTED_ERROR",_this3.message=message,_this3}return NotSupportedError}(),NotReadyError=function(){_inherits(NotReadyError,_wrapNativeSuper(Error));var _super4=_createSuper(NotReadyError);function NotReadyError(message){var _this4;return _classCallCheck(this,NotReadyError),(_this4=_super4.call(this)).code=4,_this4.name="NOT_READY_ERROR",_this4.message=message,_this4}return NotReadyError}();module.exports={ConfigurationError:ConfigurationError,InvalidStateError:InvalidStateError,NotSupportedError:NotSupportedError,NotReadyError:NotReadyError}},{}],7:[function(require,module,exports){"use strict";function quote(s){return'"'+s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}module.exports=((module={parse:function(input,startRule){var parseFunctions={CRLF:parse_CRLF,DIGIT:parse_DIGIT,ALPHA:parse_ALPHA,HEXDIG:parse_HEXDIG,WSP:parse_WSP,OCTET:parse_OCTET,DQUOTE:parse_DQUOTE,SP:parse_SP,HTAB:parse_HTAB,alphanum:parse_alphanum,reserved:parse_reserved,unreserved:parse_unreserved,mark:parse_mark,escaped:parse_escaped,LWS:parse_LWS,SWS:parse_SWS,HCOLON:parse_HCOLON,TEXT_UTF8_TRIM:parse_TEXT_UTF8_TRIM,TEXT_UTF8char:parse_TEXT_UTF8char,UTF8_NONASCII:parse_UTF8_NONASCII,UTF8_CONT:parse_UTF8_CONT,LHEX:function(){var result0;null===(result0=parse_DIGIT())&&(/^[a-f]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[a-f]")));return result0},token:parse_token,token_nodot:parse_token_nodot,separators:function(){var result0;40===input.charCodeAt(pos)?(result0="(",pos++):(result0=null,0===reportFailures&&matchFailed('"("'));null===result0&&(41===input.charCodeAt(pos)?(result0=")",pos++):(result0=null,0===reportFailures&&matchFailed('")"')),null===result0)&&(60===input.charCodeAt(pos)?(result0="<",pos++):(result0=null,0===reportFailures&&matchFailed('"<"')),null===result0)&&(62===input.charCodeAt(pos)?(result0=">",pos++):(result0=null,0===reportFailures&&matchFailed('">"')),null===result0)&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0)&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')),null===result0)&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0)&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0)&&(92===input.charCodeAt(pos)?(result0="\\",pos++):(result0=null,0===reportFailures&&matchFailed('"\\\\"')),null===result0)&&null===(result0=parse_DQUOTE())&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0)&&(91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null===result0)&&(93===input.charCodeAt(pos)?(result0="]",pos++):(result0=null,0===reportFailures&&matchFailed('"]"')),null===result0)&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0)&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0)&&(123===input.charCodeAt(pos)?(result0="{",pos++):(result0=null,0===reportFailures&&matchFailed('"{"')),null===result0)&&(125===input.charCodeAt(pos)?(result0="}",pos++):(result0=null,0===reportFailures&&matchFailed('"}"')),null===result0)&&null===(result0=parse_SP())&&(result0=parse_HTAB());return result0},word:parse_word,STAR:parse_STAR,SLASH:parse_SLASH,EQUAL:parse_EQUAL,LPAREN:parse_LPAREN,RPAREN:parse_RPAREN,RAQUOT:parse_RAQUOT,LAQUOT:parse_LAQUOT,COMMA:parse_COMMA,SEMI:parse_SEMI,COLON:parse_COLON,LDQUOT:parse_LDQUOT,RDQUOT:parse_RDQUOT,comment:function parse_comment(){var result0,result1,result2;var pos0;pos0=pos;result0=parse_LPAREN();if(null!==result0){for(result1=[],null===(result2=parse_ctext())&&null===(result2=parse_quoted_pair())&&(result2=parse_comment());null!==result2;)result1.push(result2),null===(result2=parse_ctext())&&null===(result2=parse_quoted_pair())&&(result2=parse_comment());null!==result1&&null!==(result2=parse_RPAREN())?result0=[result0,result1,result2]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},ctext:parse_ctext,quoted_string:parse_quoted_string,quoted_string_clean:parse_quoted_string_clean,qdtext:parse_qdtext,quoted_pair:parse_quoted_pair,SIP_URI_noparams:parse_SIP_URI_noparams,SIP_URI:parse_SIP_URI,uri_scheme:parse_uri_scheme,uri_scheme_sips:parse_uri_scheme_sips,uri_scheme_sip:parse_uri_scheme_sip,userinfo:parse_userinfo,user:parse_user,user_unreserved:parse_user_unreserved,password:parse_password,hostport:parse_hostport,host:parse_host,hostname:parse_hostname,domainlabel:parse_domainlabel,toplabel:parse_toplabel,IPv6reference:parse_IPv6reference,IPv6address:parse_IPv6address,h16:parse_h16,ls32:parse_ls32,IPv4address:parse_IPv4address,dec_octet:parse_dec_octet,port:parse_port,uri_parameters:parse_uri_parameters,uri_parameter:parse_uri_parameter,transport_param:parse_transport_param,user_param:parse_user_param,method_param:parse_method_param,ttl_param:parse_ttl_param,maddr_param:parse_maddr_param,lr_param:parse_lr_param,other_param:parse_other_param,pname:parse_pname,pvalue:parse_pvalue,paramchar:parse_paramchar,param_unreserved:parse_param_unreserved,headers:parse_headers,header:parse_header,hname:parse_hname,hvalue:parse_hvalue,hnv_unreserved:parse_hnv_unreserved,Request_Response:function(){var result0;null===(result0=parse_Status_Line())&&(result0=parse_Request_Line());return result0},Request_Line:parse_Request_Line,Request_URI:parse_Request_URI,absoluteURI:parse_absoluteURI,hier_part:parse_hier_part,net_path:parse_net_path,abs_path:parse_abs_path,opaque_part:parse_opaque_part,uric:parse_uric,uric_no_slash:parse_uric_no_slash,path_segments:parse_path_segments,segment:parse_segment,param:parse_param,pchar:parse_pchar,scheme:parse_scheme,authority:parse_authority,srvr:parse_srvr,reg_name:parse_reg_name,query:parse_query,SIP_Version:parse_SIP_Version,INVITEm:parse_INVITEm,ACKm:parse_ACKm,OPTIONSm:parse_OPTIONSm,BYEm:parse_BYEm,CANCELm:parse_CANCELm,REGISTERm:parse_REGISTERm,SUBSCRIBEm:parse_SUBSCRIBEm,NOTIFYm:parse_NOTIFYm,REFERm:parse_REFERm,Method:parse_Method,Status_Line:parse_Status_Line,Status_Code:parse_Status_Code,extension_code:parse_extension_code,Reason_Phrase:parse_Reason_Phrase,Allow_Events:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_event_type())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_event_type())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_event_type())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},Call_ID:function(){var result0,result1,result2,pos0,pos1,pos2;pos1=pos0=pos,null!==(result0=parse_word())&&(pos2=pos,64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null!==result1&&null!==(result2=parse_word())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos1);null!==result0&&(result0=void(data=input.substring(pos,pos0)));null===result0&&(pos=pos0);return result0},Contact:function(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos0=pos,null===(result0=parse_STAR()))if(pos1=pos,null!==(result0=parse_contact_param())){for(result1=[],pos2=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_contact_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_contact_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(){for(var length=data.multi_header.length,idx=0;idx<length;idx++)if(null===data.multi_header[idx].parsed){data=null;break}data=null!==data?data.multi_header:-1}());null===result0&&(pos=pos0);return result0},contact_param:parse_contact_param,name_addr:parse_name_addr,display_name:parse_display_name,contact_params:parse_contact_params,c_p_q:parse_c_p_q,c_p_expires:parse_c_p_expires,delta_seconds:parse_delta_seconds,qvalue:parse_qvalue,generic_param:parse_generic_param,gen_value:parse_gen_value,Content_Disposition:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_disp_type())){for(result1=[],pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_disp_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_disp_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},disp_type:parse_disp_type,disp_param:parse_disp_param,handling_param:parse_handling_param,Content_Encoding:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_token())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},Content_Length:function(){var result0,result1,pos0;if(pos0=pos,null!==(result1=parse_DIGIT()))for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;null!==result0&&(result0=void(data=parseInt(result0.join(""))));null===result0&&(pos=pos0);return result0},Content_Type:function(){var result0,pos0;pos0=pos,null!==(result0=parse_media_type())&&(result0=void(data=input.substring(pos,pos0)));null===result0&&(pos=pos0);return result0},media_type:parse_media_type,m_type:parse_m_type,discrete_type:parse_discrete_type,composite_type:parse_composite_type,extension_token:parse_extension_token,x_token:parse_x_token,m_subtype:parse_m_subtype,m_parameter:parse_m_parameter,m_value:parse_m_value,CSeq:function(){var result0,result1,result2,pos0;pos0=pos,null!==(result0=parse_CSeq_value())&&null!==(result1=parse_LWS())&&null!==(result2=parse_Method())?result0=[result0,result1,result2]:(result0=null,pos=pos0);return result0},CSeq_value:parse_CSeq_value,Expires:function(){var result0,pos0;pos0=pos,null!==(result0=parse_delta_seconds())&&(result0=void(data=result0));null===result0&&(pos=pos0);return result0},Event:function(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos1=pos0=pos,null!==(result0=parse_event_type())){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(event_type){data.event=event_type.join("").toLowerCase()}(result0[0]));null===result0&&(pos=pos0);return result0},event_type:parse_event_type,From:function(){var result0,result1,result2,result3,pos0,pos1,pos2;pos1=pos0=pos,null===(result0=parse_SIP_URI_noparams())&&(result0=parse_name_addr());if(null!==result0){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_from_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_from_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params),tag&&data.setParam("tag",tag)}catch(e){data=-1}}());null===result0&&(pos=pos0);return result0},from_param:parse_from_param,tag_param:parse_tag_param,Max_Forwards:function(){var result0,result1,pos0;if(pos0=pos,null!==(result1=parse_DIGIT()))for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;null!==result0&&(result0=void(data=parseInt(result0.join(""))));null===result0&&(pos=pos0);return result0},Min_Expires:function(){var result0,pos0;pos0=pos,null!==(result0=parse_delta_seconds())&&(result0=void(data=result0));null===result0&&(pos=pos0);return result0},Name_Addr_Header:function(){var result0,result1,result2,result3,result4,result5,result6,pos0,pos1,pos2;pos1=pos0=pos,result0=[],result1=parse_display_name();for(;null!==result1;)result0.push(result1),result1=parse_display_name();if(null!==result0)if(null!==(result1=parse_LAQUOT()))if(null!==(result2=parse_SIP_URI()))if(null!==(result3=parse_RAQUOT())){for(result4=[],pos2=pos,null!==(result5=parse_SEMI())&&null!==(result6=parse_generic_param())?result5=[result5,result6]:(result5=null,pos=pos2);null!==result5;)result4.push(result5),pos2=pos,null!==(result5=parse_SEMI())&&null!==(result6=parse_generic_param())?result5=[result5,result6]:(result5=null,pos=pos2);null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;else result0=null,pos=pos1;else result0=null,pos=pos1;null!==result0&&(result0=function(){try{data=new NameAddrHeader(data.uri,data.display_name,data.params)}catch(e){data=-1}}());null===result0&&(pos=pos0);return result0},Proxy_Authenticate:function(){return parse_challenge()},challenge:parse_challenge,other_challenge:parse_other_challenge,auth_param:parse_auth_param,digest_cln:parse_digest_cln,realm:parse_realm,realm_value:parse_realm_value,domain:parse_domain,URI:parse_URI,nonce:parse_nonce,nonce_value:parse_nonce_value,opaque:parse_opaque,stale:parse_stale,algorithm:parse_algorithm,qop_options:parse_qop_options,qop_value:parse_qop_value,Proxy_Require:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_token())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},Record_Route:function(){var result0,result1,result2,result3,pos0,pos1,pos2;if(pos1=pos0=pos,null!==(result0=parse_rec_route())){for(result1=[],pos2=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_rec_route())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_rec_route())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(){for(var length=data.multi_header.length,idx=0;idx<length;idx++)if(null===data.multi_header[idx].parsed){data=null;break}data=null!==data?data.multi_header:-1}());null===result0&&(pos=pos0);return result0},rec_route:parse_rec_route,Reason:function(){var result0,result1,result2,result3,pos0,pos1,pos2;pos1=pos0=pos,"sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"SIP"'));null===result0&&(result0=parse_token());if(null!==result0){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_reason_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_reason_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(protocol){data.protocol=protocol.toLowerCase(),data.params||(data.params={}),data.params.text&&'"'===data.params.text[0]&&(protocol=data.params.text,data.text=protocol.substring(1,protocol.length-1),delete data.params.text)}(result0[0]));null===result0&&(pos=pos0);return result0},reason_param:parse_reason_param,reason_cause:parse_reason_cause,Require:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_token())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},Route:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_route_param())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_route_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_route_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},route_param:parse_route_param,Subscription_State:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_substate_value())){for(result1=[],pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_subexp_params())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_subexp_params())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},substate_value:parse_substate_value,subexp_params:parse_subexp_params,event_reason_value:parse_event_reason_value,Subject:function(){var result0;return result0=null!==(result0=parse_TEXT_UTF8_TRIM())?result0:""},Supported:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_token())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0=null!==result0?result0:""},To:function(){var result0,result1,result2,result3,pos0,pos1,pos2;pos1=pos0=pos,null===(result0=parse_SIP_URI_noparams())&&(result0=parse_name_addr());if(null!==result0){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_to_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_to_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(){var tag=data.tag;try{data=new NameAddrHeader(data.uri,data.display_name,data.params),tag&&data.setParam("tag",tag)}catch(e){data=-1}}());null===result0&&(pos=pos0);return result0},to_param:parse_to_param,Via:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_via_param())){for(result1=[],pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_via_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_COMMA())&&null!==(result3=parse_via_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},via_param:parse_via_param,via_params:parse_via_params,via_ttl:parse_via_ttl,via_maddr:parse_via_maddr,via_received:parse_via_received,via_branch:parse_via_branch,response_port:parse_response_port,rport:parse_rport,sent_protocol:parse_sent_protocol,protocol_name:parse_protocol_name,transport:parse_transport,sent_by:parse_sent_by,via_host:parse_via_host,via_port:parse_via_port,ttl:parse_ttl,WWW_Authenticate:function(){return parse_challenge()},Session_Expires:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_s_e_expires())){for(result1=[],pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_s_e_params())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_s_e_params())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},s_e_expires:parse_s_e_expires,s_e_params:parse_s_e_params,s_e_refresher:parse_s_e_refresher,extension_header:function(){var result0,result1,result2,pos0;pos0=pos,null!==(result0=parse_token())&&null!==(result1=parse_HCOLON())&&null!==(result2=parse_header_value())?result0=[result0,result1,result2]:(result0=null,pos=pos0);return result0},header_value:parse_header_value,message_body:function(){var result0,result1;result0=[],result1=parse_OCTET();for(;null!==result1;)result0.push(result1),result1=parse_OCTET();return result0},uuid_URI:function(){var result0,result1,pos0;pos0=pos,"uuid:"===input.substr(pos,5)?(result0="uuid:",pos+=5):(result0=null,0===reportFailures&&matchFailed('"uuid:"'));null!==result0&&null!==(result1=parse_uuid())?result0=[result0,result1]:(result0=null,pos=pos0);return result0},uuid:parse_uuid,hex4:parse_hex4,hex8:parse_hex8,hex12:parse_hex12,Refer_To:function(){var result0,result1,result2,result3,pos0,pos1,pos2;pos1=pos0=pos,null===(result0=parse_SIP_URI_noparams())&&(result0=parse_name_addr());if(null!==result0){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;null!==result0&&(result0=function(){try{data=new NameAddrHeader(data.uri,data.display_name,data.params)}catch(e){data=-1}}());null===result0&&(pos=pos0);return result0},Replaces:function(){var result0,result1,result2,result3,pos0,pos1;if(pos0=pos,null!==(result0=parse_call_id())){for(result1=[],pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_replaces_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_replaces_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0},call_id:parse_call_id,replaces_param:parse_replaces_param,to_tag:parse_to_tag,from_tag:parse_from_tag,early_flag:parse_early_flag};if(void 0!==startRule){if(void 0===parseFunctions[startRule])throw new Error("Invalid rule name: "+quote(startRule)+".")}else startRule="CRLF";var pos=0,reportFailures=0,rightmostFailuresPos=0,rightmostFailuresExpected=[];function matchFailed(failure){pos<rightmostFailuresPos||(rightmostFailuresPos<pos&&(rightmostFailuresPos=pos,rightmostFailuresExpected=[]),rightmostFailuresExpected.push(failure))}function parse_CRLF(){var result0;return"\r\n"===input.substr(pos,2)?(result0="\r\n",pos+=2):(result0=null,0===reportFailures&&matchFailed('"\\r\\n"')),result0}function parse_DIGIT(){var result0;return/^[0-9]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[0-9]")),result0}function parse_ALPHA(){var result0;return/^[a-zA-Z]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[a-zA-Z]")),result0}function parse_HEXDIG(){var result0;return/^[0-9a-fA-F]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[0-9a-fA-F]")),result0}function parse_WSP(){var result0=parse_SP();return result0=null===result0?parse_HTAB():result0}function parse_OCTET(){var result0;return/^[\0-\xFF]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\0-\\xFF]")),result0}function parse_DQUOTE(){var result0;return/^["]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed('["]')),result0}function parse_SP(){var result0;return 32===input.charCodeAt(pos)?(result0=" ",pos++):(result0=null,0===reportFailures&&matchFailed('" "')),result0}function parse_HTAB(){var result0;return 9===input.charCodeAt(pos)?(result0="\t",pos++):(result0=null,0===reportFailures&&matchFailed('"\\t"')),result0}function parse_alphanum(){var result0;return/^[a-zA-Z0-9]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[a-zA-Z0-9]")),result0}function parse_reserved(){var result0;return 59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0)&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0)&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0)&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0)&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0)&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0)&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0)&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0)&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","'))),result0}function parse_unreserved(){var result0=parse_alphanum();return result0=null===result0?parse_mark():result0}function parse_mark(){var result0;return 45===input.charCodeAt(pos)?(result0="-",pos++):(result0=null,0===reportFailures&&matchFailed('"-"')),null===result0&&(95===input.charCodeAt(pos)?(result0="_",pos++):(result0=null,0===reportFailures&&matchFailed('"_"')),null===result0)&&(46===input.charCodeAt(pos)?(result0=".",pos++):(result0=null,0===reportFailures&&matchFailed('"."')),null===result0)&&(33===input.charCodeAt(pos)?(result0="!",pos++):(result0=null,0===reportFailures&&matchFailed('"!"')),null===result0)&&(126===input.charCodeAt(pos)?(result0="~",pos++):(result0=null,0===reportFailures&&matchFailed('"~"')),null===result0)&&(42===input.charCodeAt(pos)?(result0="*",pos++):(result0=null,0===reportFailures&&matchFailed('"*"')),null===result0)&&(39===input.charCodeAt(pos)?(result0="'",pos++):(result0=null,0===reportFailures&&matchFailed('"\'"')),null===result0)&&(40===input.charCodeAt(pos)?(result0="(",pos++):(result0=null,0===reportFailures&&matchFailed('"("')),null===result0)&&(41===input.charCodeAt(pos)?(result0=")",pos++):(result0=null,0===reportFailures&&matchFailed('")"'))),result0}function parse_escaped(){var result0,result1,result2,pos0=pos,pos1=pos;return 37===input.charCodeAt(pos)?(result0="%",pos++):(result0=null,0===reportFailures&&matchFailed('"%"')),null!==result0&&null!==(result1=parse_HEXDIG())&&null!==(result2=parse_HEXDIG())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?result0.join(""):result0)&&(pos=pos0),result0}function parse_LWS(){for(var result2,pos0=pos,pos1=pos,pos2=pos,result0=[],result1=parse_WSP();null!==result1;)result0.push(result1),result1=parse_WSP();if(null!==result0&&null!==(result1=parse_CRLF())?result0=[result0,result1]:(result0=null,pos=pos2),null!==(result0=null!==result0?result0:"")){if(null!==(result2=parse_WSP()))for(result1=[];null!==result2;)result1.push(result2),result2=parse_WSP();else result1=null;null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null===(result0=null!==result0?" ":result0)&&(pos=pos0),result0}function parse_SWS(){var result0=parse_LWS();return null!==result0?result0:""}function parse_HCOLON(){var result2,pos0=pos,pos1=pos,result0=[],result1=parse_SP();for(null===result1&&(result1=parse_HTAB());null!==result1;)result0.push(result1),null===(result1=parse_SP())&&(result1=parse_HTAB());return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?":":result0)&&(pos=pos0),result0}function parse_TEXT_UTF8_TRIM(){var result0,result2,result3,pos2,pos0=pos,pos1=pos,result1=parse_TEXT_UTF8char();if(null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_TEXT_UTF8char();else result0=null;if(null!==result0){for(result1=[],pos2=pos,result2=[],result3=parse_LWS();null!==result3;)result2.push(result3),result3=parse_LWS();for(null!==result2&&null!==(result3=parse_TEXT_UTF8char())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;){for(result1.push(result2),pos2=pos,result2=[],result3=parse_LWS();null!==result3;)result2.push(result3),result3=parse_LWS();null!==result2&&null!==(result3=parse_TEXT_UTF8char())?result2=[result2,result3]:(result2=null,pos=pos2)}null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null===(result0=null!==result0?input.substring(pos,pos0):result0)&&(pos=pos0),result0}function parse_TEXT_UTF8char(){var result0;return/^[!-~]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[!-~]")),result0=null===result0?parse_UTF8_NONASCII():result0}function parse_UTF8_NONASCII(){var result0;return/^[\x80-\uFFFF]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\x80-\\uFFFF]")),result0}function parse_UTF8_CONT(){var result0;return/^[\x80-\xBF]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\x80-\\xBF]")),result0}function parse_token(){var result0,pos0=pos,result1=parse_alphanum();if(null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1)&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1)&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1)&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1)&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1)&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1)&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1)&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"'))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),null===(result1=parse_alphanum())&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1)&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1)&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1)&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1)&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1)&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1)&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1)&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')));else result0=null;return null===(result0=null!==result0?input.substring(pos,pos0):result0)&&(pos=pos0),result0}function parse_token_nodot(){var result0,pos0=pos,result1=parse_alphanum();if(null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1)&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1)&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1)&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1)&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1)&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1)&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"'))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),null===(result1=parse_alphanum())&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1)&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1)&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1)&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1)&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1)&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1)&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')));else result0=null;return null===(result0=null!==result0?input.substring(pos,pos0):result0)&&(pos=pos0),result0}function parse_word(){var result0,pos0=pos,result1=parse_alphanum();if(null===result1&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1)&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1)&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1)&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1)&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1)&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1)&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1)&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')),null===result1)&&(40===input.charCodeAt(pos)?(result1="(",pos++):(result1=null,0===reportFailures&&matchFailed('"("')),null===result1)&&(41===input.charCodeAt(pos)?(result1=")",pos++):(result1=null,0===reportFailures&&matchFailed('")"')),null===result1)&&(60===input.charCodeAt(pos)?(result1="<",pos++):(result1=null,0===reportFailures&&matchFailed('"<"')),null===result1)&&(62===input.charCodeAt(pos)?(result1=">",pos++):(result1=null,0===reportFailures&&matchFailed('">"')),null===result1)&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1)&&(92===input.charCodeAt(pos)?(result1="\\",pos++):(result1=null,0===reportFailures&&matchFailed('"\\\\"')),null===result1)&&null===(result1=parse_DQUOTE())&&(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null===result1)&&(91===input.charCodeAt(pos)?(result1="[",pos++):(result1=null,0===reportFailures&&matchFailed('"["')),null===result1)&&(93===input.charCodeAt(pos)?(result1="]",pos++):(result1=null,0===reportFailures&&matchFailed('"]"')),null===result1)&&(63===input.charCodeAt(pos)?(result1="?",pos++):(result1=null,0===reportFailures&&matchFailed('"?"')),null===result1)&&(123===input.charCodeAt(pos)?(result1="{",pos++):(result1=null,0===reportFailures&&matchFailed('"{"')),null===result1)&&(125===input.charCodeAt(pos)?(result1="}",pos++):(result1=null,0===reportFailures&&matchFailed('"}"'))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),null===(result1=parse_alphanum())&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null===result1)&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null===result1)&&(33===input.charCodeAt(pos)?(result1="!",pos++):(result1=null,0===reportFailures&&matchFailed('"!"')),null===result1)&&(37===input.charCodeAt(pos)?(result1="%",pos++):(result1=null,0===reportFailures&&matchFailed('"%"')),null===result1)&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null===result1)&&(95===input.charCodeAt(pos)?(result1="_",pos++):(result1=null,0===reportFailures&&matchFailed('"_"')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(96===input.charCodeAt(pos)?(result1="`",pos++):(result1=null,0===reportFailures&&matchFailed('"`"')),null===result1)&&(39===input.charCodeAt(pos)?(result1="'",pos++):(result1=null,0===reportFailures&&matchFailed('"\'"')),null===result1)&&(126===input.charCodeAt(pos)?(result1="~",pos++):(result1=null,0===reportFailures&&matchFailed('"~"')),null===result1)&&(40===input.charCodeAt(pos)?(result1="(",pos++):(result1=null,0===reportFailures&&matchFailed('"("')),null===result1)&&(41===input.charCodeAt(pos)?(result1=")",pos++):(result1=null,0===reportFailures&&matchFailed('")"')),null===result1)&&(60===input.charCodeAt(pos)?(result1="<",pos++):(result1=null,0===reportFailures&&matchFailed('"<"')),null===result1)&&(62===input.charCodeAt(pos)?(result1=">",pos++):(result1=null,0===reportFailures&&matchFailed('">"')),null===result1)&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1)&&(92===input.charCodeAt(pos)?(result1="\\",pos++):(result1=null,0===reportFailures&&matchFailed('"\\\\"')),null===result1)&&null===(result1=parse_DQUOTE())&&(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null===result1)&&(91===input.charCodeAt(pos)?(result1="[",pos++):(result1=null,0===reportFailures&&matchFailed('"["')),null===result1)&&(93===input.charCodeAt(pos)?(result1="]",pos++):(result1=null,0===reportFailures&&matchFailed('"]"')),null===result1)&&(63===input.charCodeAt(pos)?(result1="?",pos++):(result1=null,0===reportFailures&&matchFailed('"?"')),null===result1)&&(123===input.charCodeAt(pos)?(result1="{",pos++):(result1=null,0===reportFailures&&matchFailed('"{"')),null===result1)&&(125===input.charCodeAt(pos)?(result1="}",pos++):(result1=null,0===reportFailures&&matchFailed('"}"')));else result0=null;return null===(result0=null!==result0?input.substring(pos,pos0):result0)&&(pos=pos0),result0}function parse_STAR(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(42===input.charCodeAt(pos)?(result1="*",pos++):(result1=null,0===reportFailures&&matchFailed('"*"')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?"*":result0)&&(pos=pos0),result0}function parse_SLASH(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?"/":result0)&&(pos=pos0),result0}function parse_EQUAL(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?"=":result0)&&(pos=pos0),result0}function parse_LPAREN(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(40===input.charCodeAt(pos)?(result1="(",pos++):(result1=null,0===reportFailures&&matchFailed('"("')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?"(":result0)&&(pos=pos0),result0}function parse_RPAREN(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(41===input.charCodeAt(pos)?(result1=")",pos++):(result1=null,0===reportFailures&&matchFailed('")"')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?")":result0)&&(pos=pos0),result0}function parse_RAQUOT(){var result0,result1,pos0=pos,pos1=pos;return 62===input.charCodeAt(pos)?(result0=">",pos++):(result0=null,0===reportFailures&&matchFailed('">"')),null!==result0&&null!==(result1=parse_SWS())?result0=[result0,result1]:(result0=null,pos=pos1),null===(result0=null!==result0?">":result0)&&(pos=pos0),result0}function parse_LAQUOT(){var result1,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(60===input.charCodeAt(pos)?(result1="<",pos++):(result1=null,0===reportFailures&&matchFailed('"<"')),null!==result1)?result0=[result0,result1]:(result0=null,pos=pos1),null===(result0=null!==result0?"<":result0)&&(pos=pos0),result0}function parse_COMMA(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?",":result0)&&(pos=pos0),result0}function parse_SEMI(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?";":result0)&&(pos=pos0),result0}function parse_COLON(){var result1,result2,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=parse_SWS())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?":":result0)&&(pos=pos0),result0}function parse_LDQUOT(){var result1,pos0=pos,pos1=pos,result0=parse_SWS();return null!==result0&&null!==(result1=parse_DQUOTE())?result0=[result0,result1]:(result0=null,pos=pos1),null===(result0=null!==result0?'"':result0)&&(pos=pos0),result0}function parse_RDQUOT(){var result1,pos0=pos,pos1=pos,result0=parse_DQUOTE();return null!==result0&&null!==(result1=parse_SWS())?result0=[result0,result1]:(result0=null,pos=pos1),null===(result0=null!==result0?'"':result0)&&(pos=pos0),result0}function parse_ctext(){var result0;return/^[!-']/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[!-']")),result0=null===result0&&(/^[*-[]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[*-[]")),null===result0)&&(/^[\]-~]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\]-~]")),null===result0)&&null===(result0=parse_UTF8_NONASCII())?parse_LWS():result0}function parse_quoted_string(){var result1,result2,result3,pos0=pos,pos1=pos,result0=parse_SWS();if(null!==result0)if(null!==(result1=parse_DQUOTE())){for(result2=[],null===(result3=parse_qdtext())&&(result3=parse_quoted_pair());null!==result3;)result2.push(result3),null===(result3=parse_qdtext())&&(result3=parse_quoted_pair());null!==result2&&null!==(result3=parse_DQUOTE())?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;return null===(result0=null!==result0?input.substring(pos,pos0):result0)&&(pos=pos0),result0}function parse_quoted_string_clean(){var result2,result3,result1,pos0=pos,pos1=pos,result0=parse_SWS();if(null!==result0)if(null!==(result1=parse_DQUOTE())){for(result2=[],null===(result3=parse_qdtext())&&(result3=parse_quoted_pair());null!==result3;)result2.push(result3),null===(result3=parse_qdtext())&&(result3=parse_quoted_pair());null!==result2&&null!==(result3=parse_DQUOTE())?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;return null===(result0=null!==result0?(result1=input.substring(pos,pos0).trim()).substring(1,result1.length-1).replace(/\\([\x00-\x09\x0b-\x0c\x0e-\x7f])/g,"$1"):result0)&&(pos=pos0),result0}function parse_qdtext(){var result0=parse_LWS();return result0=null===result0&&(33===input.charCodeAt(pos)?(result0="!",pos++):(result0=null,0===reportFailures&&matchFailed('"!"')),null===result0)&&(/^[#-[]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[#-[]")),null===result0)&&(/^[\]-~]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[\\]-~]")),null===result0)?parse_UTF8_NONASCII():result0}function parse_quoted_pair(){var result0,result1,pos0=pos;return 92===input.charCodeAt(pos)?(result0="\\",pos++):(result0=null,0===reportFailures&&matchFailed('"\\\\"')),null!==result0&&(/^[\0-\t]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[\\0-\\t]")),null===result1&&(/^[\x0B-\f]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[\\x0B-\\f]")),null===result1)&&(/^[\x0E-]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[\\x0E-]"))),null!==result1)?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_SIP_URI_noparams(){var result1,result2,result3,pos0=pos,pos1=pos,result0=parse_uri_scheme();return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=null!==(result2=parse_userinfo())?result2:"")&&null!==(result3=parse_hostport())?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1),null===(result0=null!==result0?function(){try{data.uri=new URI(data.scheme,data.user,data.host,data.port),delete data.scheme,delete data.user,delete data.host,delete data.host_type,delete data.port}catch(e){data=-1}}():result0)&&(pos=pos0),result0}function parse_SIP_URI(){var result1,result2,result3,result4,result5,pos0=pos,pos1=pos,result0=parse_uri_scheme();return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=null!==(result2=parse_userinfo())?result2:"")&&null!==(result3=parse_hostport())&&null!==(result4=parse_uri_parameters())&&null!==(result5=null!==(result5=parse_headers())?result5:"")?result0=[result0,result1,result2,result3,result4,result5]:(result0=null,pos=pos1),null===(result0=null!==result0?function(){try{data.uri=new URI(data.scheme,data.user,data.host,data.port,data.uri_params,data.uri_headers),delete data.scheme,delete data.user,delete data.host,delete data.host_type,delete data.port,delete data.uri_params,"SIP_URI"===startRule&&(data=data.uri)}catch(e){data=-1}}():result0)&&(pos=pos0),result0}function parse_uri_scheme(){var result0=parse_uri_scheme_sips();return result0=null===result0?parse_uri_scheme_sip():result0}function parse_uri_scheme_sips(){var result0,scheme,pos0=pos;return"sips"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"sips"')),null!==result0&&(scheme=result0,result0=void(data.scheme=scheme.toLowerCase())),null===result0&&(pos=pos0),result0}function parse_uri_scheme_sip(){var result0,scheme,pos0=pos;return"sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"sip"')),null!==result0&&(scheme=result0,result0=void(data.scheme=scheme.toLowerCase())),null===result0&&(pos=pos0),result0}function parse_userinfo(){var result1,result2,pos2,pos0=pos,pos1=pos,result0=parse_user();return null!==result0&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_password())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&(64===input.charCodeAt(pos)?(result2="@",pos++):(result2=null,0===reportFailures&&matchFailed('"@"')),null!==result2)?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?void(data.user=decodeURIComponent(input.substring(pos-1,pos0))):result0)&&(pos=pos0),result0}function parse_user(){var result0,result1=parse_unreserved();if(null!==(result1=null===result1&&null===(result1=parse_escaped())?parse_user_unreserved():result1))for(result0=[];null!==result1;)result0.push(result1),null===(result1=parse_unreserved())&&null===(result1=parse_escaped())&&(result1=parse_user_unreserved());else result0=null;return result0}function parse_user_unreserved(){var result0;return 38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0)&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0)&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0)&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","')),null===result0)&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0)&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0)&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"'))),result0}function parse_password(){var pos0=pos,result0=[],result1=parse_unreserved();for(null===result1&&null===(result1=parse_escaped())&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1)&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1)&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')));null!==result1;)result0.push(result1),null===(result1=parse_unreserved())&&null===(result1=parse_escaped())&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1)&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')),null===result1)&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1)&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')));return null===(result0=null!==result0?void(data.password=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_hostport(){var result1,result2,pos1,pos0=pos,result0=parse_host();return null!==result0&&(pos1=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_port())?result1=[result1,result2]:(result1=null,pos=pos1),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_host(){var pos0=pos,result0=parse_hostname();return null!==(result0=null===result0&&null===(result0=parse_IPv4address())?parse_IPv6reference():result0)&&(data.host=input.substring(pos,pos0).toLowerCase(),result0=data.host),null===result0&&(pos=pos0),result0}function parse_hostname(){var result2,pos0=pos,pos1=pos,result0=[],pos2=pos,result1=parse_domainlabel();for(null!==result1&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2)?result1=[result1,result2]:(result1=null,pos=pos2);null!==result1;)result0.push(result1),pos2=pos,null!==(result1=parse_domainlabel())&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2)?result1=[result1,result2]:(result1=null,pos=pos2);return null!==result0&&null!==(result1=parse_toplabel())&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==(result2=null!==result2?result2:""))?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(pos1=pos0,data.host_type="domain",result0=input.substring(pos,pos1)),null===result0&&(pos=pos0),result0}function parse_domainlabel(){var result1,result2,pos0=pos,result0=parse_alphanum();if(null!==result0){for(result1=[],null===(result2=parse_alphanum())&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2)&&(95===input.charCodeAt(pos)?(result2="_",pos++):(result2=null,0===reportFailures&&matchFailed('"_"')));null!==result2;)result1.push(result2),null===(result2=parse_alphanum())&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2)&&(95===input.charCodeAt(pos)?(result2="_",pos++):(result2=null,0===reportFailures&&matchFailed('"_"')));null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_toplabel(){var result1,result2,pos0=pos,result0=parse_ALPHA();if(null!==result0){for(result1=[],null===(result2=parse_alphanum())&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2)&&(95===input.charCodeAt(pos)?(result2="_",pos++):(result2=null,0===reportFailures&&matchFailed('"_"')));null!==result2;)result1.push(result2),null===(result2=parse_alphanum())&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2)&&(95===input.charCodeAt(pos)?(result2="_",pos++):(result2=null,0===reportFailures&&matchFailed('"_"')));null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_IPv6reference(){var result0,result2,result1,pos0=pos,pos1=pos;return 91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null!==result0&&null!==(result1=parse_IPv6address())&&(93===input.charCodeAt(pos)?(result2="]",pos++):(result2=null,0===reportFailures&&matchFailed('"]"')),null!==result2)?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=pos0,data.host_type="IPv6",result0=input.substring(pos,result1)),null===result0&&(pos=pos0),result0}function parse_IPv6address(){var result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,pos2,result12,pos0=pos,pos1=pos,result0=parse_h16();return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=parse_h16())&&(58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3)&&null!==(result4=parse_h16())&&(58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5)&&null!==(result6=parse_h16())&&(58===input.charCodeAt(pos)?(result7=":",pos++):(result7=null,0===reportFailures&&matchFailed('":"')),null!==result7)&&null!==(result8=parse_h16())&&(58===input.charCodeAt(pos)?(result9=":",pos++):(result9=null,0===reportFailures&&matchFailed('":"')),null!==result9)&&null!==(result10=parse_h16())&&(58===input.charCodeAt(pos)?(result11=":",pos++):(result11=null,0===reportFailures&&matchFailed('":"')),null!==result11)&&null!==(result12=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11,result12]:(result0=null,pos=pos1),null===result0&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_h16())&&(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2)&&null!==(result3=parse_h16())&&(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4)&&null!==(result5=parse_h16())&&(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6)&&null!==(result7=parse_h16())&&(58===input.charCodeAt(pos)?(result8=":",pos++):(result8=null,0===reportFailures&&matchFailed('":"')),null!==result8)&&null!==(result9=parse_h16())&&(58===input.charCodeAt(pos)?(result10=":",pos++):(result10=null,0===reportFailures&&matchFailed('":"')),null!==result10)&&null!==(result11=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10,result11]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_h16())&&(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2)&&null!==(result3=parse_h16())&&(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4)&&null!==(result5=parse_h16())&&(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6)&&null!==(result7=parse_h16())&&(58===input.charCodeAt(pos)?(result8=":",pos++):(result8=null,0===reportFailures&&matchFailed('":"')),null!==result8)&&null!==(result9=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_h16())&&(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2)&&null!==(result3=parse_h16())&&(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4)&&null!==(result5=parse_h16())&&(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6)&&null!==(result7=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_h16())&&(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2)&&null!==(result3=parse_h16())&&(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4)&&null!==(result5=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_h16())&&(58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2)&&null!==(result3=parse_ls32())?result0=[result0,result1,result2,result3]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_ls32())?result0=[result0,result1]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,"::"===input.substr(pos,2)?(result0="::",pos+=2):(result0=null,0===reportFailures&&matchFailed('"::"')),null!==result0&&null!==(result1=parse_h16())?result0=[result0,result1]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&("::"===input.substr(pos,2)?(result1="::",pos+=2):(result1=null,0===reportFailures&&matchFailed('"::"')),null!==result1)&&null!==(result2=parse_h16())&&(58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3)&&null!==(result4=parse_h16())&&(58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5)&&null!==(result6=parse_h16())&&(58===input.charCodeAt(pos)?(result7=":",pos++):(result7=null,0===reportFailures&&matchFailed('":"')),null!==result7)&&null!==(result8=parse_h16())&&(58===input.charCodeAt(pos)?(result9=":",pos++):(result9=null,0===reportFailures&&matchFailed('":"')),null!==result9)&&null!==(result10=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9,result10]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_h16())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&("::"===input.substr(pos,2)?(result2="::",pos+=2):(result2=null,0===reportFailures&&matchFailed('"::"')),null!==result2)&&null!==(result3=parse_h16())&&(58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4)&&null!==(result5=parse_h16())&&(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6)&&null!==(result7=parse_h16())&&(58===input.charCodeAt(pos)?(result8=":",pos++):(result8=null,0===reportFailures&&matchFailed('":"')),null!==result8)&&null!==(result9=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8,result9]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_h16())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2&&null!==(result3=parse_h16())?result2=[result2,result3]:(result2=null,pos=pos2),null!==(result2=null!==result2?result2:""))&&("::"===input.substr(pos,2)?(result3="::",pos+=2):(result3=null,0===reportFailures&&matchFailed('"::"')),null!==result3)&&null!==(result4=parse_h16())&&(58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5)&&null!==(result6=parse_h16())&&(58===input.charCodeAt(pos)?(result7=":",pos++):(result7=null,0===reportFailures&&matchFailed('":"')),null!==result7)&&null!==(result8=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_h16())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2&&null!==(result3=parse_h16())?result2=[result2,result3]:(result2=null,pos=pos2),null!==(result2=null!==result2?result2:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3&&null!==(result4=parse_h16())?result3=[result3,result4]:(result3=null,pos=pos2),null!==(result3=null!==result3?result3:""))&&("::"===input.substr(pos,2)?(result4="::",pos+=2):(result4=null,0===reportFailures&&matchFailed('"::"')),null!==result4)&&null!==(result5=parse_h16())&&(58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6)&&null!==(result7=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_h16())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2&&null!==(result3=parse_h16())?result2=[result2,result3]:(result2=null,pos=pos2),null!==(result2=null!==result2?result2:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3&&null!==(result4=parse_h16())?result3=[result3,result4]:(result3=null,pos=pos2),null!==(result3=null!==result3?result3:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4&&null!==(result5=parse_h16())?result4=[result4,result5]:(result4=null,pos=pos2),null!==(result4=null!==result4?result4:""))&&("::"===input.substr(pos,2)?(result5="::",pos+=2):(result5=null,0===reportFailures&&matchFailed('"::"')),null!==result5)&&null!==(result6=parse_ls32())?result0=[result0,result1,result2,result3,result4,result5,result6]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_h16())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2&&null!==(result3=parse_h16())?result2=[result2,result3]:(result2=null,pos=pos2),null!==(result2=null!==result2?result2:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3&&null!==(result4=parse_h16())?result3=[result3,result4]:(result3=null,pos=pos2),null!==(result3=null!==result3?result3:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4&&null!==(result5=parse_h16())?result4=[result4,result5]:(result4=null,pos=pos2),null!==(result4=null!==result4?result4:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5&&null!==(result6=parse_h16())?result5=[result5,result6]:(result5=null,pos=pos2),null!==(result5=null!==result5?result5:""))&&("::"===input.substr(pos,2)?(result6="::",pos+=2):(result6=null,0===reportFailures&&matchFailed('"::"')),null!==result6)&&null!==(result7=parse_h16())?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1),null===result0)&&(pos1=pos,null!==(result0=parse_h16())&&(pos2=pos,58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1&&null!==(result2=parse_h16())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result2=":",pos++):(result2=null,0===reportFailures&&matchFailed('":"')),null!==result2&&null!==(result3=parse_h16())?result2=[result2,result3]:(result2=null,pos=pos2),null!==(result2=null!==result2?result2:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result3=":",pos++):(result3=null,0===reportFailures&&matchFailed('":"')),null!==result3&&null!==(result4=parse_h16())?result3=[result3,result4]:(result3=null,pos=pos2),null!==(result3=null!==result3?result3:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result4=":",pos++):(result4=null,0===reportFailures&&matchFailed('":"')),null!==result4&&null!==(result5=parse_h16())?result4=[result4,result5]:(result4=null,pos=pos2),null!==(result4=null!==result4?result4:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result5=":",pos++):(result5=null,0===reportFailures&&matchFailed('":"')),null!==result5&&null!==(result6=parse_h16())?result5=[result5,result6]:(result5=null,pos=pos2),null!==(result5=null!==result5?result5:""))&&(pos2=pos,58===input.charCodeAt(pos)?(result6=":",pos++):(result6=null,0===reportFailures&&matchFailed('":"')),null!==result6&&null!==(result7=parse_h16())?result6=[result6,result7]:(result6=null,pos=pos2),null!==(result6=null!==result6?result6:""))&&("::"===input.substr(pos,2)?(result7="::",pos+=2):(result7=null,0===reportFailures&&matchFailed('"::"')),null!==result7)?result0=[result0,result1,result2,result3,result4,result5,result6,result7]:(result0=null,pos=pos1)),null!==result0&&(result12=pos0,data.host_type="IPv6",result0=input.substring(pos,result12)),null===result0&&(pos=pos0),result0}function parse_h16(){var result1,result2,result3,pos0=pos,result0=parse_HEXDIG();return null!==result0&&null!==(result1=null!==(result1=parse_HEXDIG())?result1:"")&&null!==(result2=null!==(result2=parse_HEXDIG())?result2:"")&&null!==(result3=null!==(result3=parse_HEXDIG())?result3:"")?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0),result0}function parse_ls32(){var result1,result2,pos0=pos,result0=parse_h16();return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=parse_h16())?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0=null===result0?parse_IPv4address():result0}function parse_IPv4address(){var result2,result3,result4,result5,result6,result1,pos0=pos,pos1=pos,result0=parse_dec_octet();return null!==result0&&(46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null!==result1)&&null!==(result2=parse_dec_octet())&&(46===input.charCodeAt(pos)?(result3=".",pos++):(result3=null,0===reportFailures&&matchFailed('"."')),null!==result3)&&null!==(result4=parse_dec_octet())&&(46===input.charCodeAt(pos)?(result5=".",pos++):(result5=null,0===reportFailures&&matchFailed('"."')),null!==result5)&&null!==(result6=parse_dec_octet())?result0=[result0,result1,result2,result3,result4,result5,result6]:(result0=null,pos=pos1),null!==result0&&(result1=pos0,data.host_type="IPv4",result0=input.substring(pos,result1)),null===result0&&(pos=pos0),result0}function parse_dec_octet(){var result0,result1,result2,pos0=pos;return"25"===input.substr(pos,2)?(result0="25",pos+=2):(result0=null,0===reportFailures&&matchFailed('"25"')),null!==result0&&(/^[0-5]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[0-5]")),null!==result1)?result0=[result0,result1]:(result0=null,pos=pos0),result0=null===result0&&(pos0=pos,50===input.charCodeAt(pos)?(result0="2",pos++):(result0=null,0===reportFailures&&matchFailed('"2"')),null!==result0&&(/^[0-4]/.test(input.charAt(pos))?(result1=input.charAt(pos),pos++):(result1=null,0===reportFailures&&matchFailed("[0-4]")),null!==result1)&&null!==(result2=parse_DIGIT())?result0=[result0,result1,result2]:(result0=null,pos=pos0),null===result0)&&(pos0=pos,49===input.charCodeAt(pos)?(result0="1",pos++):(result0=null,0===reportFailures&&matchFailed('"1"')),null!==result0&&null!==(result1=parse_DIGIT())&&null!==(result2=parse_DIGIT())?result0=[result0,result1,result2]:(result0=null,pos=pos0),null===result0)&&(pos0=pos,/^[1-9]/.test(input.charAt(pos))?(result0=input.charAt(pos),pos++):(result0=null,0===reportFailures&&matchFailed("[1-9]")),null!==result0&&null!==(result1=parse_DIGIT())?result0=[result0,result1]:(result0=null,pos=pos0),null===result0)?parse_DIGIT():result0}function parse_port(){var result2,result3,result4,result1,pos0=pos,pos1=pos,result0=parse_DIGIT();return null!==(result0=null!==result0?result0:"")&&null!==(result1=null!==(result1=parse_DIGIT())?result1:"")&&null!==(result2=null!==(result2=parse_DIGIT())?result2:"")&&null!==(result3=null!==(result3=parse_DIGIT())?result3:"")&&null!==(result4=null!==(result4=parse_DIGIT())?result4:"")?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1),null!==result0&&(result1=result0,result1=parseInt(result1.join("")),result0=data.port=result1),null===result0&&(pos=pos0),result0}function parse_uri_parameters(){var result1,result2,result0=[],pos0=pos;for(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null!==result1&&null!==(result2=parse_uri_parameter())?result1=[result1,result2]:(result1=null,pos=pos0);null!==result1;)result0.push(result1),pos0=pos,59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null!==result1&&null!==(result2=parse_uri_parameter())?result1=[result1,result2]:(result1=null,pos=pos0);return result0}function parse_uri_parameter(){var result0=parse_transport_param();return result0=null===result0&&null===(result0=parse_user_param())&&null===(result0=parse_method_param())&&null===(result0=parse_ttl_param())&&null===(result0=parse_maddr_param())&&null===(result0=parse_lr_param())?parse_other_param():result0}function parse_transport_param(){var result0,result1,pos0=pos,pos1=pos;return"transport="===input.substr(pos,10).toLowerCase()?(result0=input.substr(pos,10),pos+=10):(result0=null,0===reportFailures&&matchFailed('"transport="')),null!==result0&&("udp"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"udp"')),null!==(result1=null===result1&&("tcp"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"tcp"')),null===result1)&&("sctp"===input.substr(pos,4).toLowerCase()?(result1=input.substr(pos,4),pos+=4):(result1=null,0===reportFailures&&matchFailed('"sctp"')),null===result1)&&("tls"===input.substr(pos,3).toLowerCase()?(result1=input.substr(pos,3),pos+=3):(result1=null,0===reportFailures&&matchFailed('"tls"')),null===result1)?parse_token():result1))?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result1=result0[1],data.uri_params||(data.uri_params={}),result0=void(data.uri_params.transport=result1.toLowerCase())),null===result0&&(pos=pos0),result0}function parse_user_param(){var result0,result1,pos0=pos,pos1=pos;return"user="===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"user="')),null!==result0&&("phone"===input.substr(pos,5).toLowerCase()?(result1=input.substr(pos,5),pos+=5):(result1=null,0===reportFailures&&matchFailed('"phone"')),null!==(result1=null===result1&&("ip"===input.substr(pos,2).toLowerCase()?(result1=input.substr(pos,2),pos+=2):(result1=null,0===reportFailures&&matchFailed('"ip"')),null===result1)?parse_token():result1))?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result1=result0[1],data.uri_params||(data.uri_params={}),result0=void(data.uri_params.user=result1.toLowerCase())),null===result0&&(pos=pos0),result0}function parse_method_param(){var result0,result1,pos0=pos,pos1=pos;return"method="===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"method="')),null!==result0&&null!==(result1=parse_Method())?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result1=result0[1],data.uri_params||(data.uri_params={}),result0=void(data.uri_params.method=result1)),null===result0&&(pos=pos0),result0}function parse_ttl_param(){var result0,result1,pos0=pos,pos1=pos;return"ttl="===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"ttl="')),null!==result0&&null!==(result1=parse_ttl())?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result1=result0[1],data.params||(data.params={}),result0=void(data.params.ttl=result1)),null===result0&&(pos=pos0),result0}function parse_maddr_param(){var result0,result1,pos0=pos,pos1=pos;return"maddr="===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"maddr="')),null!==result0&&null!==(result1=parse_host())?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result1=result0[1],data.uri_params||(data.uri_params={}),result0=void(data.uri_params.maddr=result1)),null===result0&&(pos=pos0),result0}function parse_lr_param(){var result0,result1,result2,pos2,pos0=pos,pos1=pos;return"lr"===input.substr(pos,2).toLowerCase()?(result0=input.substr(pos,2),pos+=2):(result0=null,0===reportFailures&&matchFailed('"lr"')),null!==result0&&(pos2=pos,61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1&&null!==(result2=parse_token())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(data.uri_params||(data.uri_params={}),result0=void(data.uri_params.lr=void 0)),null===result0&&(pos=pos0),result0}function parse_other_param(){var result1,result2,pos2,pos0=pos,pos1=pos,result0=parse_pname();return null!==result0&&(pos2=pos,61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1&&null!==(result2=parse_pvalue())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result2=result0[0],pos2=result0[1],data.uri_params||(data.uri_params={}),pos2=void 0===pos2?void 0:pos2[1],result0=void(data.uri_params[result2.toLowerCase()]=pos2)),null===result0&&(pos=pos0),result0}function parse_pname(){var result0,pos0=pos,result1=parse_paramchar();if(null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_paramchar();else result0=null;return null===(result0=null!==result0?result0.join(""):result0)&&(pos=pos0),result0}function parse_pvalue(){var result0,pos0=pos,result1=parse_paramchar();if(null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_paramchar();else result0=null;return null===(result0=null!==result0?result0.join(""):result0)&&(pos=pos0),result0}function parse_paramchar(){var result0=parse_param_unreserved();return result0=null===result0&&null===(result0=parse_unreserved())?parse_escaped():result0}function parse_param_unreserved(){var result0;return 91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null===result0&&(93===input.charCodeAt(pos)?(result0="]",pos++):(result0=null,0===reportFailures&&matchFailed('"]"')),null===result0)&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0)&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0)&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0)&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0)&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"'))),result0}function parse_headers(){var result0,result1,result2,result3,result4,pos1,pos0=pos;if(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null!==result0)if(null!==(result1=parse_header())){for(result2=[],pos1=pos,38===input.charCodeAt(pos)?(result3="&",pos++):(result3=null,0===reportFailures&&matchFailed('"&"')),null!==result3&&null!==(result4=parse_header())?result3=[result3,result4]:(result3=null,pos=pos1);null!==result3;)result2.push(result3),pos1=pos,38===input.charCodeAt(pos)?(result3="&",pos++):(result3=null,0===reportFailures&&matchFailed('"&"')),null!==result3&&null!==(result4=parse_header())?result3=[result3,result4]:(result3=null,pos=pos1);null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_header(){var result1,result2,pos0=pos,pos1=pos,result0=parse_hname();return null!==result0&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null!==result1)&&null!==(result2=parse_hvalue())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[0],result2=result0[2],result1=result1.join("").toLowerCase(),result2=result2.join(""),data.uri_headers||(data.uri_headers={}),result0=void(data.uri_headers[result1]?data.uri_headers[result1].push(result2):data.uri_headers[result1]=[result2])),null===result0&&(pos=pos0),result0}function parse_hname(){var result0,result1=parse_hnv_unreserved();if(null!==(result1=null===result1&&null===(result1=parse_unreserved())?parse_escaped():result1))for(result0=[];null!==result1;)result0.push(result1),null===(result1=parse_hnv_unreserved())&&null===(result1=parse_unreserved())&&(result1=parse_escaped());else result0=null;return result0}function parse_hvalue(){var result0=[],result1=parse_hnv_unreserved();for(null===result1&&null===(result1=parse_unreserved())&&(result1=parse_escaped());null!==result1;)result0.push(result1),null===(result1=parse_hnv_unreserved())&&null===(result1=parse_unreserved())&&(result1=parse_escaped());return result0}function parse_hnv_unreserved(){var result0;return 91===input.charCodeAt(pos)?(result0="[",pos++):(result0=null,0===reportFailures&&matchFailed('"["')),null===result0&&(93===input.charCodeAt(pos)?(result0="]",pos++):(result0=null,0===reportFailures&&matchFailed('"]"')),null===result0)&&(47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null===result0)&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0)&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0)&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0)&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"'))),result0}function parse_Request_Line(){var result1,result2,result3,result4,pos0=pos,result0=parse_Method();return null!==result0&&null!==(result1=parse_SP())&&null!==(result2=parse_Request_URI())&&null!==(result3=parse_SP())&&null!==(result4=parse_SIP_Version())?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0),result0}function parse_Request_URI(){var result0=parse_SIP_URI();return result0=null===result0?parse_absoluteURI():result0}function parse_absoluteURI(){var result1,result2,pos0=pos,result0=parse_scheme();return null!==result0&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null!==result1)&&null!==(result2=null===(result2=parse_hier_part())?parse_opaque_part():result2)?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_hier_part(){var result1,result2,pos1,pos0=pos,result0=parse_net_path();return null!==(result0=null===result0?parse_abs_path():result0)&&(pos1=pos,63===input.charCodeAt(pos)?(result1="?",pos++):(result1=null,0===reportFailures&&matchFailed('"?"')),null!==result1&&null!==(result2=parse_query())?result1=[result1,result2]:(result1=null,pos=pos1),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_net_path(){var result0,result1,result2,pos0=pos;return"//"===input.substr(pos,2)?(result0="//",pos+=2):(result0=null,0===reportFailures&&matchFailed('"//"')),null!==result0&&null!==(result1=parse_authority())&&null!==(result2=null!==(result2=parse_abs_path())?result2:"")?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_abs_path(){var result0,result1,pos0=pos;return 47===input.charCodeAt(pos)?(result0="/",pos++):(result0=null,0===reportFailures&&matchFailed('"/"')),null!==result0&&null!==(result1=parse_path_segments())?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_opaque_part(){var result1,result2,pos0=pos,result0=parse_uric_no_slash();if(null!==result0){for(result1=[],result2=parse_uric();null!==result2;)result1.push(result2),result2=parse_uric();null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_uric(){var result0=parse_reserved();return result0=null===result0&&null===(result0=parse_unreserved())?parse_escaped():result0}function parse_uric_no_slash(){var result0=parse_unreserved();return null===result0&&null===(result0=parse_escaped())&&(59===input.charCodeAt(pos)?(result0=";",pos++):(result0=null,0===reportFailures&&matchFailed('";"')),null===result0)&&(63===input.charCodeAt(pos)?(result0="?",pos++):(result0=null,0===reportFailures&&matchFailed('"?"')),null===result0)&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0)&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0)&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0)&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0)&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0)&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0)&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","'))),result0}function parse_path_segments(){var result1,result2,result3,pos1,pos0=pos,result0=parse_segment();if(null!==result0){for(result1=[],pos1=pos,47===input.charCodeAt(pos)?(result2="/",pos++):(result2=null,0===reportFailures&&matchFailed('"/"')),null!==result2&&null!==(result3=parse_segment())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,47===input.charCodeAt(pos)?(result2="/",pos++):(result2=null,0===reportFailures&&matchFailed('"/"')),null!==result2&&null!==(result3=parse_segment())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_segment(){for(var result2,result3,pos1,pos0=pos,result0=[],result1=parse_pchar();null!==result1;)result0.push(result1),result1=parse_pchar();if(null!==result0){for(result1=[],pos1=pos,59===input.charCodeAt(pos)?(result2=";",pos++):(result2=null,0===reportFailures&&matchFailed('";"')),null!==result2&&null!==(result3=parse_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,59===input.charCodeAt(pos)?(result2=";",pos++):(result2=null,0===reportFailures&&matchFailed('";"')),null!==result2&&null!==(result3=parse_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_param(){for(var result0=[],result1=parse_pchar();null!==result1;)result0.push(result1),result1=parse_pchar();return result0}function parse_pchar(){var result0=parse_unreserved();return null===result0&&null===(result0=parse_escaped())&&(58===input.charCodeAt(pos)?(result0=":",pos++):(result0=null,0===reportFailures&&matchFailed('":"')),null===result0)&&(64===input.charCodeAt(pos)?(result0="@",pos++):(result0=null,0===reportFailures&&matchFailed('"@"')),null===result0)&&(38===input.charCodeAt(pos)?(result0="&",pos++):(result0=null,0===reportFailures&&matchFailed('"&"')),null===result0)&&(61===input.charCodeAt(pos)?(result0="=",pos++):(result0=null,0===reportFailures&&matchFailed('"="')),null===result0)&&(43===input.charCodeAt(pos)?(result0="+",pos++):(result0=null,0===reportFailures&&matchFailed('"+"')),null===result0)&&(36===input.charCodeAt(pos)?(result0="$",pos++):(result0=null,0===reportFailures&&matchFailed('"$"')),null===result0)&&(44===input.charCodeAt(pos)?(result0=",",pos++):(result0=null,0===reportFailures&&matchFailed('","'))),result0}function parse_scheme(){var result1,result2,pos0=pos,pos1=pos,result0=parse_ALPHA();if(null!==result0){for(result1=[],null===(result2=parse_ALPHA())&&null===(result2=parse_DIGIT())&&(43===input.charCodeAt(pos)?(result2="+",pos++):(result2=null,0===reportFailures&&matchFailed('"+"')),null===result2)&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2)&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')));null!==result2;)result1.push(result2),null===(result2=parse_ALPHA())&&null===(result2=parse_DIGIT())&&(43===input.charCodeAt(pos)?(result2="+",pos++):(result2=null,0===reportFailures&&matchFailed('"+"')),null===result2)&&(45===input.charCodeAt(pos)?(result2="-",pos++):(result2=null,0===reportFailures&&matchFailed('"-"')),null===result2)&&(46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')));null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null===(result0=null!==result0?void(data.scheme=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_authority(){var result0=parse_srvr();return result0=null===result0?parse_reg_name():result0}function parse_srvr(){var result1,pos0=pos,pos1=pos,result0=parse_userinfo();return null!==result0&&(64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null!==result1)?result0=[result0,result1]:(result0=null,pos=pos1),null!==(result0=null!==result0?result0:"")&&null!==(result1=parse_hostport())?result0=[result0,result1]:(result0=null,pos=pos0),result0=null!==result0?result0:""}function parse_reg_name(){var result0,result1=parse_unreserved();if(null===result1&&null===(result1=parse_escaped())&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1)&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')),null===result1)&&(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null===result1)&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1)&&(64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null===result1)&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1)&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"'))),null!==result1)for(result0=[];null!==result1;)result0.push(result1),null===(result1=parse_unreserved())&&null===(result1=parse_escaped())&&(36===input.charCodeAt(pos)?(result1="$",pos++):(result1=null,0===reportFailures&&matchFailed('"$"')),null===result1)&&(44===input.charCodeAt(pos)?(result1=",",pos++):(result1=null,0===reportFailures&&matchFailed('","')),null===result1)&&(59===input.charCodeAt(pos)?(result1=";",pos++):(result1=null,0===reportFailures&&matchFailed('";"')),null===result1)&&(58===input.charCodeAt(pos)?(result1=":",pos++):(result1=null,0===reportFailures&&matchFailed('":"')),null===result1)&&(64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null===result1)&&(38===input.charCodeAt(pos)?(result1="&",pos++):(result1=null,0===reportFailures&&matchFailed('"&"')),null===result1)&&(61===input.charCodeAt(pos)?(result1="=",pos++):(result1=null,0===reportFailures&&matchFailed('"="')),null===result1)&&(43===input.charCodeAt(pos)?(result1="+",pos++):(result1=null,0===reportFailures&&matchFailed('"+"')));else result0=null;return result0}function parse_query(){for(var result0=[],result1=parse_uric();null!==result1;)result0.push(result1),result1=parse_uric();return result0}function parse_SIP_Version(){var result0,result1,result2,result3,result4,result5,pos0=pos,pos1=pos;if("sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"SIP"')),null!==result0)if(47===input.charCodeAt(pos)?(result1="/",pos++):(result1=null,0===reportFailures&&matchFailed('"/"')),null!==result1){if(null!==(result3=parse_DIGIT()))for(result2=[];null!==result3;)result2.push(result3),result3=parse_DIGIT();else result2=null;if(null!==result2)if(46===input.charCodeAt(pos)?(result3=".",pos++):(result3=null,0===reportFailures&&matchFailed('"."')),null!==result3){if(null!==(result5=parse_DIGIT()))for(result4=[];null!==result5;)result4.push(result5),result5=parse_DIGIT();else result4=null;null!==result4?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1}else result0=null,pos=pos1;else result0=null,pos=pos1;return null===(result0=null!==result0?void(data.sip_version=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_INVITEm(){var result0;return"INVITE"===input.substr(pos,6)?(result0="INVITE",pos+=6):(result0=null,0===reportFailures&&matchFailed('"INVITE"')),result0}function parse_ACKm(){var result0;return"ACK"===input.substr(pos,3)?(result0="ACK",pos+=3):(result0=null,0===reportFailures&&matchFailed('"ACK"')),result0}function parse_OPTIONSm(){var result0;return"OPTIONS"===input.substr(pos,7)?(result0="OPTIONS",pos+=7):(result0=null,0===reportFailures&&matchFailed('"OPTIONS"')),result0}function parse_BYEm(){var result0;return"BYE"===input.substr(pos,3)?(result0="BYE",pos+=3):(result0=null,0===reportFailures&&matchFailed('"BYE"')),result0}function parse_CANCELm(){var result0;return"CANCEL"===input.substr(pos,6)?(result0="CANCEL",pos+=6):(result0=null,0===reportFailures&&matchFailed('"CANCEL"')),result0}function parse_REGISTERm(){var result0;return"REGISTER"===input.substr(pos,8)?(result0="REGISTER",pos+=8):(result0=null,0===reportFailures&&matchFailed('"REGISTER"')),result0}function parse_SUBSCRIBEm(){var result0;return"SUBSCRIBE"===input.substr(pos,9)?(result0="SUBSCRIBE",pos+=9):(result0=null,0===reportFailures&&matchFailed('"SUBSCRIBE"')),result0}function parse_NOTIFYm(){var result0;return"NOTIFY"===input.substr(pos,6)?(result0="NOTIFY",pos+=6):(result0=null,0===reportFailures&&matchFailed('"NOTIFY"')),result0}function parse_REFERm(){var result0;return"REFER"===input.substr(pos,5)?(result0="REFER",pos+=5):(result0=null,0===reportFailures&&matchFailed('"REFER"')),result0}function parse_Method(){var pos0=pos,result0=parse_INVITEm();return null!==(result0=null===result0&&null===(result0=parse_ACKm())&&null===(result0=parse_OPTIONSm())&&null===(result0=parse_BYEm())&&null===(result0=parse_CANCELm())&&null===(result0=parse_REGISTERm())&&null===(result0=parse_SUBSCRIBEm())&&null===(result0=parse_NOTIFYm())&&null===(result0=parse_REFERm())?parse_token():result0)&&(data.method=input.substring(pos,pos0),result0=data.method),null===result0&&(pos=pos0),result0}function parse_Status_Line(){var result1,result2,result3,result4,pos0=pos,result0=parse_SIP_Version();return null!==result0&&null!==(result1=parse_SP())&&null!==(result2=parse_Status_Code())&&null!==(result3=parse_SP())&&null!==(result4=parse_Reason_Phrase())?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0),result0}function parse_Status_Code(){var status_code,pos0=pos,result0=parse_extension_code();return null!==result0&&(status_code=result0,result0=void(data.status_code=parseInt(status_code.join("")))),null===result0&&(pos=pos0),result0}function parse_extension_code(){var result1,result2,pos0=pos,result0=parse_DIGIT();return null!==result0&&null!==(result1=parse_DIGIT())&&null!==(result2=parse_DIGIT())?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_Reason_Phrase(){var pos0=pos,result0=[],result1=parse_reserved();for(null===result1&&null===(result1=parse_unreserved())&&null===(result1=parse_escaped())&&null===(result1=parse_UTF8_NONASCII())&&null===(result1=parse_UTF8_CONT())&&null===(result1=parse_SP())&&(result1=parse_HTAB());null!==result1;)result0.push(result1),null===(result1=parse_reserved())&&null===(result1=parse_unreserved())&&null===(result1=parse_escaped())&&null===(result1=parse_UTF8_NONASCII())&&null===(result1=parse_UTF8_CONT())&&null===(result1=parse_SP())&&(result1=parse_HTAB());return null===(result0=null!==result0?void(data.reason_phrase=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_contact_param(){var result1,result2,result3,pos2,pos0=pos,pos1=pos,result0=parse_SIP_URI_noparams();if(null!==(result0=null===result0?parse_name_addr():result0)){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_contact_params())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_contact_params())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null===(result0=null!==result0?function(offset){var header;data.multi_header||(data.multi_header=[]);try{header=new NameAddrHeader(data.uri,data.display_name,data.params),delete data.uri,delete data.display_name,delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0):result0)&&(pos=pos0),result0}function parse_name_addr(){var result1,result2,result3,pos0=pos,result0=parse_display_name();return null!==(result0=null!==result0?result0:"")&&null!==(result1=parse_LAQUOT())&&null!==(result2=parse_SIP_URI())&&null!==(result3=parse_RAQUOT())?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0),result0}function parse_display_name(){var result1,result2,result3,pos2,pos0=pos,pos1=pos,result0=parse_token();if(null!==result0){for(result1=[],pos2=pos,null!==(result2=parse_LWS())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_LWS())&&null!==(result3=parse_token())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null!==(result0=null===result0?parse_quoted_string_clean():result0)&&(pos1=result0,result0=void(data.display_name="string"==typeof pos1?pos1:pos1[1].reduce(function(acc,cur){return acc+cur[0]+cur[1]},pos1[0]))),null===result0&&(pos=pos0),result0}function parse_contact_params(){var result0=parse_c_p_q();return result0=null===result0&&null===(result0=parse_c_p_expires())?parse_generic_param():result0}function parse_c_p_q(){var result0,result2,result1,pos0=pos,pos1=pos;return"q"===input.substr(pos,1).toLowerCase()?(result0=input.substr(pos,1),pos++):(result0=null,0===reportFailures&&matchFailed('"q"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_qvalue())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],data.params||(data.params={}),result0=void(data.params.q=result1)),null===result0&&(pos=pos0),result0}function parse_c_p_expires(){var result0,result2,result1,pos0=pos,pos1=pos;return"expires"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"expires"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_delta_seconds())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],data.params||(data.params={}),result0=void(data.params.expires=result1)),null===result0&&(pos=pos0),result0}function parse_delta_seconds(){var result0,pos0=pos,result1=parse_DIGIT();if(null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;return null===(result0=null!==result0?parseInt(result0.join("")):result0)&&(pos=pos0),result0}function parse_qvalue(){var result0,result1,result2,result3,result4,pos2,pos0=pos,pos1=pos;return 48===input.charCodeAt(pos)?(result0="0",pos++):(result0=null,0===reportFailures&&matchFailed('"0"')),null!==result0&&(pos2=pos,46===input.charCodeAt(pos)?(result1=".",pos++):(result1=null,0===reportFailures&&matchFailed('"."')),null!==result1&&null!==(result2=null!==(result2=parse_DIGIT())?result2:"")&&null!==(result3=null!==(result3=parse_DIGIT())?result3:"")&&null!==(result4=null!==(result4=parse_DIGIT())?result4:"")?result1=[result1,result2,result3,result4]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos1),null===(result0=null!==result0?parseFloat(input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_generic_param(){var result1,result2,pos2,pos0=pos,pos1=pos,result0=parse_token();return null!==result0&&(pos2=pos,null!==(result1=parse_EQUAL())&&null!==(result2=parse_gen_value())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos1),null!==result0&&(result2=result0[0],pos2=result0[1],data.params||(data.params={}),pos2=void 0===pos2?void 0:pos2[1],result0=void(data.params[result2.toLowerCase()]=pos2)),null===result0&&(pos=pos0),result0}function parse_gen_value(){var result0=parse_token();return result0=null===result0&&null===(result0=parse_host())?parse_quoted_string():result0}function parse_disp_type(){var result0;return"render"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"render"')),result0=null===result0&&("session"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"session"')),null===result0)&&("icon"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"icon"')),null===result0)&&("alert"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"alert"')),null===result0)?parse_token():result0}function parse_disp_param(){var result0=parse_handling_param();return result0=null===result0?parse_generic_param():result0}function parse_handling_param(){var result0,result1,result2,pos0=pos;return"handling"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"handling"')),null!==result0&&null!==(result1=parse_EQUAL())&&("optional"===input.substr(pos,8).toLowerCase()?(result2=input.substr(pos,8),pos+=8):(result2=null,0===reportFailures&&matchFailed('"optional"')),null!==(result2=null===result2&&("required"===input.substr(pos,8).toLowerCase()?(result2=input.substr(pos,8),pos+=8):(result2=null,0===reportFailures&&matchFailed('"required"')),null===result2)?parse_token():result2))?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_media_type(){var result1,result2,result3,result4,result5,pos1,pos0=pos,result0=parse_m_type();if(null!==result0)if(null!==(result1=parse_SLASH()))if(null!==(result2=parse_m_subtype())){for(result3=[],pos1=pos,null!==(result4=parse_SEMI())&&null!==(result5=parse_m_parameter())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,null!==(result4=parse_SEMI())&&null!==(result5=parse_m_parameter())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_m_type(){var result0=parse_discrete_type();return result0=null===result0?parse_composite_type():result0}function parse_discrete_type(){var result0;return"text"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"text"')),result0=null===result0&&("image"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"image"')),null===result0)&&("audio"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"audio"')),null===result0)&&("video"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"video"')),null===result0)&&("application"===input.substr(pos,11).toLowerCase()?(result0=input.substr(pos,11),pos+=11):(result0=null,0===reportFailures&&matchFailed('"application"')),null===result0)?parse_extension_token():result0}function parse_composite_type(){var result0;return"message"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"message"')),result0=null===result0&&("multipart"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"multipart"')),null===result0)?parse_extension_token():result0}function parse_extension_token(){var result0=parse_token();return result0=null===result0?parse_x_token():result0}function parse_x_token(){var result0,result1,pos0=pos;return"x-"===input.substr(pos,2).toLowerCase()?(result0=input.substr(pos,2),pos+=2):(result0=null,0===reportFailures&&matchFailed('"x-"')),null!==result0&&null!==(result1=parse_token())?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_m_subtype(){var result0=parse_extension_token();return result0=null===result0?parse_token():result0}function parse_m_parameter(){var result1,result2,pos0=pos,result0=parse_token();return null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_m_value())?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_m_value(){var result0=parse_token();return result0=null===result0?parse_quoted_string():result0}function parse_CSeq_value(){var result0,cseq_value,pos0=pos,result1=parse_DIGIT();if(null!==result1)for(result0=[];null!==result1;)result0.push(result1),result1=parse_DIGIT();else result0=null;return null!==result0&&(cseq_value=result0,result0=void(data.value=parseInt(cseq_value.join("")))),null===result0&&(pos=pos0),result0}function parse_event_type(){var result1,result2,result3,pos1,pos0=pos,result0=parse_token_nodot();if(null!==result0){for(result1=[],pos1=pos,46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2&&null!==(result3=parse_token_nodot())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,46===input.charCodeAt(pos)?(result2=".",pos++):(result2=null,0===reportFailures&&matchFailed('"."')),null!==result2&&null!==(result3=parse_token_nodot())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_from_param(){var result0=parse_tag_param();return result0=null===result0?parse_generic_param():result0}function parse_tag_param(){var result0,result2,result1,pos0=pos,pos1=pos;return"tag"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"tag"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_token())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.tag=result1)),null===result0&&(pos=pos0),result0}function parse_challenge(){var result0,result1,result2,result3,result4,result5,pos1,pos0=pos;if("digest"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"Digest"')),null!==result0)if(null!==(result1=parse_LWS()))if(null!==(result2=parse_digest_cln())){for(result3=[],pos1=pos,null!==(result4=parse_COMMA())&&null!==(result5=parse_digest_cln())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,null!==(result4=parse_COMMA())&&null!==(result5=parse_digest_cln())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0=null===result0?parse_other_challenge():result0}function parse_other_challenge(){var result1,result2,result3,result4,result5,pos1,pos0=pos,result0=parse_token();if(null!==result0)if(null!==(result1=parse_LWS()))if(null!==(result2=parse_auth_param())){for(result3=[],pos1=pos,null!==(result4=parse_COMMA())&&null!==(result5=parse_auth_param())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,null!==(result4=parse_COMMA())&&null!==(result5=parse_auth_param())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_auth_param(){var result1,result2,pos0=pos,result0=parse_token();return null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=null===(result2=parse_token())?parse_quoted_string():result2)?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_digest_cln(){var result0=parse_realm();return result0=null===result0&&null===(result0=parse_domain())&&null===(result0=parse_nonce())&&null===(result0=parse_opaque())&&null===(result0=parse_stale())&&null===(result0=parse_algorithm())&&null===(result0=parse_qop_options())?parse_auth_param():result0}function parse_realm(){var result0,result1,result2,pos0=pos;return"realm"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"realm"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_realm_value())?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_realm_value(){var realm,pos0=pos,result0=parse_quoted_string_clean();return null!==result0&&(realm=result0,result0=void(data.realm=realm)),null===result0&&(pos=pos0),result0}function parse_domain(){var result0,result1,result2,result3,result4,result5,result6,pos1,pos0=pos;if("domain"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"domain"')),null!==result0)if(null!==(result1=parse_EQUAL()))if(null!==(result2=parse_LDQUOT()))if(null!==(result3=parse_URI())){if(result4=[],pos1=pos,null!==(result6=parse_SP()))for(result5=[];null!==result6;)result5.push(result6),result6=parse_SP();else result5=null;for(null!==result5&&null!==(result6=parse_URI())?result5=[result5,result6]:(result5=null,pos=pos1);null!==result5;){if(result4.push(result5),pos1=pos,null!==(result6=parse_SP()))for(result5=[];null!==result6;)result5.push(result6),result6=parse_SP();else result5=null;null!==result5&&null!==(result6=parse_URI())?result5=[result5,result6]:(result5=null,pos=pos1)}null!==result4&&null!==(result5=parse_RDQUOT())?result0=[result0,result1,result2,result3,result4,result5]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_URI(){var result0=parse_absoluteURI();return result0=null===result0?parse_abs_path():result0}function parse_nonce(){var result0,result1,result2,pos0=pos;return"nonce"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"nonce"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_nonce_value())?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_nonce_value(){var nonce,pos0=pos,result0=parse_quoted_string_clean();return null!==result0&&(nonce=result0,result0=void(data.nonce=nonce)),null===result0&&(pos=pos0),result0}function parse_opaque(){var result0,result2,result1,pos0=pos,pos1=pos;return"opaque"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"opaque"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_quoted_string_clean())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.opaque=result1)),null===result0&&(pos=pos0),result0}function parse_stale(){var result0,result1,result2,pos1,pos0=pos;return"stale"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"stale"')),null!==result0&&null!==(result1=parse_EQUAL())&&(pos1=pos,"true"===input.substr(pos,4).toLowerCase()?(result2=input.substr(pos,4),pos+=4):(result2=null,0===reportFailures&&matchFailed('"true"')),null===(result2=null!==result2?void(data.stale=!0):result2)&&(pos=pos1),null===result2&&(pos1=pos,"false"===input.substr(pos,5).toLowerCase()?(result2=input.substr(pos,5),pos+=5):(result2=null,0===reportFailures&&matchFailed('"false"')),null===(result2=null!==result2?void(data.stale=!1):result2))&&(pos=pos1),null!==result2)?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_algorithm(){var result0,result2,result1,pos0=pos,pos1=pos;return"algorithm"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"algorithm"')),null!==result0&&null!==(result1=parse_EQUAL())&&("md5"===input.substr(pos,3).toLowerCase()?(result2=input.substr(pos,3),pos+=3):(result2=null,0===reportFailures&&matchFailed('"MD5"')),null!==(result2=null===result2&&("md5-sess"===input.substr(pos,8).toLowerCase()?(result2=input.substr(pos,8),pos+=8):(result2=null,0===reportFailures&&matchFailed('"MD5-sess"')),null===result2)?parse_token():result2))?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.algorithm=result1.toUpperCase())),null===result0&&(pos=pos0),result0}function parse_qop_options(){var result0,result1,result2,result3,result4,result5,result6,pos1,pos2,pos0=pos;if("qop"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"qop"')),null!==result0)if(null!==(result1=parse_EQUAL()))if(null!==(result2=parse_LDQUOT())){if(pos1=pos,null!==(result3=parse_qop_value())){for(result4=[],pos2=pos,44===input.charCodeAt(pos)?(result5=",",pos++):(result5=null,0===reportFailures&&matchFailed('","')),null!==result5&&null!==(result6=parse_qop_value())?result5=[result5,result6]:(result5=null,pos=pos2);null!==result5;)result4.push(result5),pos2=pos,44===input.charCodeAt(pos)?(result5=",",pos++):(result5=null,0===reportFailures&&matchFailed('","')),null!==result5&&null!==(result6=parse_qop_value())?result5=[result5,result6]:(result5=null,pos=pos2);null!==result4?result3=[result3,result4]:(result3=null,pos=pos1)}else result3=null,pos=pos1;null!==result3&&null!==(result4=parse_RDQUOT())?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_qop_value(){var result0,qop_value,pos0=pos;return"auth-int"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"auth-int"')),null!==(result0=null===result0&&("auth"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"auth"')),null===result0)?parse_token():result0)&&(qop_value=result0,data.qop||(data.qop=[]),result0=void data.qop.push(qop_value.toLowerCase())),null===result0&&(pos=pos0),result0}function parse_rec_route(){var result1,result2,result3,pos2,pos0=pos,pos1=pos,result0=parse_name_addr();if(null!==result0){for(result1=[],pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result2;)result1.push(result2),pos2=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos2);null!==result1?result0=[result0,result1]:(result0=null,pos=pos1)}else result0=null,pos=pos1;return null===(result0=null!==result0?function(offset){var header;data.multi_header||(data.multi_header=[]);try{header=new NameAddrHeader(data.uri,data.display_name,data.params),delete data.uri,delete data.display_name,delete data.params}catch(e){header=null}data.multi_header.push({possition:pos,offset:offset,parsed:header})}(pos0):result0)&&(pos=pos0),result0}function parse_reason_param(){var result0=parse_reason_cause();return result0=null===result0?parse_generic_param():result0}function parse_reason_cause(){var result0,result2,result3,result1,pos0=pos,pos1=pos;if("cause"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"cause"')),null!==result0)if(null!==(result1=parse_EQUAL())){if(null!==(result3=parse_DIGIT()))for(result2=[];null!==result3;)result2.push(result3),result3=parse_DIGIT();else result2=null;null!==result2?result0=[result0,result1,result2]:(result0=null,pos=pos1)}else result0=null,pos=pos1;else result0=null,pos=pos1;return null!==result0&&(result1=result0[2],result0=void(data.cause=parseInt(result1.join("")))),null===result0&&(pos=pos0),result0}function parse_route_param(){var result1,result2,result3,pos1,pos0=pos,result0=parse_name_addr();if(null!==result0){for(result1=[],pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result2;)result1.push(result2),pos1=pos,null!==(result2=parse_SEMI())&&null!==(result3=parse_generic_param())?result2=[result2,result3]:(result2=null,pos=pos1);null!==result1?result0=[result0,result1]:(result0=null,pos=pos0)}else result0=null,pos=pos0;return result0}function parse_substate_value(){var result0,pos0=pos;return"active"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"active"')),null===(result0=null!==(result0=null===result0&&("pending"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"pending"')),null===result0)&&("terminated"===input.substr(pos,10).toLowerCase()?(result0=input.substr(pos,10),pos+=10):(result0=null,0===reportFailures&&matchFailed('"terminated"')),null===result0)?parse_token():result0)?void(data.state=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_subexp_params(){var result0,result2,result1,reason,pos0=pos,pos1=pos;return"reason"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"reason"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_event_reason_value())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?void(void 0!==(reason=result0[2])&&(data.reason=reason)):result0)&&(pos=pos0),result0=null===result0&&(pos1=pos0=pos,"expires"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"expires"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_delta_seconds())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?void(void 0!==(reason=result0[2])&&(data.expires=reason)):result0)&&(pos=pos0),null===result0)&&(pos1=pos0=pos,"retry_after"===input.substr(pos,11).toLowerCase()?(result0=input.substr(pos,11),pos+=11):(result0=null,0===reportFailures&&matchFailed('"retry_after"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_delta_seconds())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?void(void 0!==(result1=result0[2])&&(data.retry_after=result1)):result0)&&(pos=pos0),null===result0)?parse_generic_param():result0}function parse_event_reason_value(){var result0;return"deactivated"===input.substr(pos,11).toLowerCase()?(result0=input.substr(pos,11),pos+=11):(result0=null,0===reportFailures&&matchFailed('"deactivated"')),result0=null===result0&&("probation"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"probation"')),null===result0)&&("rejected"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"rejected"')),null===result0)&&("timeout"===input.substr(pos,7).toLowerCase()?(result0=input.substr(pos,7),pos+=7):(result0=null,0===reportFailures&&matchFailed('"timeout"')),null===result0)&&("giveup"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"giveup"')),null===result0)&&("noresource"===input.substr(pos,10).toLowerCase()?(result0=input.substr(pos,10),pos+=10):(result0=null,0===reportFailures&&matchFailed('"noresource"')),null===result0)&&("invariant"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"invariant"')),null===result0)?parse_token():result0}function parse_to_param(){var result0=parse_tag_param();return result0=null===result0?parse_generic_param():result0}function parse_via_param(){var result1,result2,result3,result4,result5,pos1,pos0=pos,result0=parse_sent_protocol();if(null!==result0)if(null!==(result1=parse_LWS()))if(null!==(result2=parse_sent_by())){for(result3=[],pos1=pos,null!==(result4=parse_SEMI())&&null!==(result5=parse_via_params())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result4;)result3.push(result4),pos1=pos,null!==(result4=parse_SEMI())&&null!==(result5=parse_via_params())?result4=[result4,result5]:(result4=null,pos=pos1);null!==result3?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0)}else result0=null,pos=pos0;else result0=null,pos=pos0;else result0=null,pos=pos0;return result0}function parse_via_params(){var result0=parse_via_ttl();return result0=null===result0&&null===(result0=parse_via_maddr())&&null===(result0=parse_via_received())&&null===(result0=parse_via_branch())&&null===(result0=parse_response_port())?parse_generic_param():result0}function parse_via_ttl(){var result0,result2,result1,pos0=pos,pos1=pos;return"ttl"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"ttl"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_ttl())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.ttl=result1)),null===result0&&(pos=pos0),result0}function parse_via_maddr(){var result0,result2,result1,pos0=pos,pos1=pos;return"maddr"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"maddr"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_host())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.maddr=result1)),null===result0&&(pos=pos0),result0}function parse_via_received(){var result0,result2,result1,pos0=pos,pos1=pos;return"received"===input.substr(pos,8).toLowerCase()?(result0=input.substr(pos,8),pos+=8):(result0=null,0===reportFailures&&matchFailed('"received"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=null===(result2=parse_IPv4address())?parse_IPv6address():result2)?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.received=result1)),null===result0&&(pos=pos0),result0}function parse_via_branch(){var result0,result2,result1,pos0=pos,pos1=pos;return"branch"===input.substr(pos,6).toLowerCase()?(result0=input.substr(pos,6),pos+=6):(result0=null,0===reportFailures&&matchFailed('"branch"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_token())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.branch=result1)),null===result0&&(pos=pos0),result0}function parse_response_port(){var result0,result1,result2,pos1,pos0=pos;return"rport"===input.substr(pos,5).toLowerCase()?(result0=input.substr(pos,5),pos+=5):(result0=null,0===reportFailures&&matchFailed('"rport"')),null!==result0&&(pos1=pos,null!==(result1=parse_EQUAL())&&null!==(result2=parse_rport())?result1=[result1,result2]:(result1=null,pos=pos1),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_rport(){var result2,result3,result4,result1,pos0=pos,pos1=pos,result0=parse_DIGIT();return null!==(result0=null!==result0?result0:"")&&null!==(result1=null!==(result1=parse_DIGIT())?result1:"")&&null!==(result2=null!==(result2=parse_DIGIT())?result2:"")&&null!==(result3=null!==(result3=parse_DIGIT())?result3:"")&&null!==(result4=null!==(result4=parse_DIGIT())?result4:"")?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1),null!==result0&&(result1=result0,result0=void(data.rport=parseInt(result1.join("")))),null===result0&&(pos=pos0),result0}function parse_sent_protocol(){var result1,result2,result3,result4,pos0=pos,result0=parse_protocol_name();return null!==result0&&null!==(result1=parse_SLASH())&&null!==(result2=parse_token())&&null!==(result3=parse_SLASH())&&null!==(result4=parse_transport())?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos0),result0}function parse_protocol_name(){var result0,via_protocol,pos0=pos;return"sip"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"SIP"')),null!==(result0=null===result0?parse_token():result0)&&(via_protocol=result0,result0=void(data.protocol=via_protocol)),null===result0&&(pos=pos0),result0}function parse_transport(){var result0,via_transport,pos0=pos;return"udp"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"UDP"')),null!==(result0=null===result0&&("tcp"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"TCP"')),null===result0)&&("tls"===input.substr(pos,3).toLowerCase()?(result0=input.substr(pos,3),pos+=3):(result0=null,0===reportFailures&&matchFailed('"TLS"')),null===result0)&&("sctp"===input.substr(pos,4).toLowerCase()?(result0=input.substr(pos,4),pos+=4):(result0=null,0===reportFailures&&matchFailed('"SCTP"')),null===result0)?parse_token():result0)&&(via_transport=result0,result0=void(data.transport=via_transport)),null===result0&&(pos=pos0),result0}function parse_sent_by(){var result1,result2,pos1,pos0=pos,result0=parse_via_host();return null!==result0&&(pos1=pos,null!==(result1=parse_COLON())&&null!==(result2=parse_via_port())?result1=[result1,result2]:(result1=null,pos=pos1),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_via_host(){var pos0=pos,result0=parse_IPv4address();return null===(result0=null!==(result0=null===result0&&null===(result0=parse_IPv6reference())?parse_hostname():result0)?void(data.host=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_via_port(){var result2,result3,result4,result1,pos0=pos,pos1=pos,result0=parse_DIGIT();return null!==(result0=null!==result0?result0:"")&&null!==(result1=null!==(result1=parse_DIGIT())?result1:"")&&null!==(result2=null!==(result2=parse_DIGIT())?result2:"")&&null!==(result3=null!==(result3=parse_DIGIT())?result3:"")&&null!==(result4=null!==(result4=parse_DIGIT())?result4:"")?result0=[result0,result1,result2,result3,result4]:(result0=null,pos=pos1),null!==result0&&(result1=result0,result0=void(data.port=parseInt(result1.join("")))),null===result0&&(pos=pos0),result0}function parse_ttl(){var result1,result2,pos0=pos,pos1=pos,result0=parse_DIGIT();return null!==result0&&null!==(result1=null!==(result1=parse_DIGIT())?result1:"")&&null!==(result2=null!==(result2=parse_DIGIT())?result2:"")?result0=[result0,result1,result2]:(result0=null,pos=pos1),null===(result0=null!==result0?parseInt(result0.join("")):result0)&&(pos=pos0),result0}function parse_s_e_expires(){var expires,pos0=pos,result0=parse_delta_seconds();return null!==result0&&(expires=result0,result0=void(data.expires=expires)),null===result0&&(pos=pos0),result0}function parse_s_e_params(){var result0=parse_s_e_refresher();return result0=null===result0?parse_generic_param():result0}function parse_s_e_refresher(){var result0,result2,result1,pos0=pos,pos1=pos;return"refresher"===input.substr(pos,9).toLowerCase()?(result0=input.substr(pos,9),pos+=9):(result0=null,0===reportFailures&&matchFailed('"refresher"')),null!==result0&&null!==(result1=parse_EQUAL())&&("uac"===input.substr(pos,3).toLowerCase()?(result2=input.substr(pos,3),pos+=3):(result2=null,0===reportFailures&&matchFailed('"uac"')),null===result2&&("uas"===input.substr(pos,3).toLowerCase()?(result2=input.substr(pos,3),pos+=3):(result2=null,0===reportFailures&&matchFailed('"uas"'))),null!==result2)?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.refresher=result1.toLowerCase())),null===result0&&(pos=pos0),result0}function parse_header_value(){var result0=[],result1=parse_TEXT_UTF8char();for(null===result1&&null===(result1=parse_UTF8_CONT())&&(result1=parse_LWS());null!==result1;)result0.push(result1),null===(result1=parse_TEXT_UTF8char())&&null===(result1=parse_UTF8_CONT())&&(result1=parse_LWS());return result0}function parse_uuid(){var result1,result2,result3,result4,result5,result6,result7,result8,pos0=pos,pos1=pos,result0=parse_hex8();return null!==result0&&(45===input.charCodeAt(pos)?(result1="-",pos++):(result1=null,0===reportFailures&&matchFailed('"-"')),null!==result1)&&null!==(result2=parse_hex4())&&(45===input.charCodeAt(pos)?(result3="-",pos++):(result3=null,0===reportFailures&&matchFailed('"-"')),null!==result3)&&null!==(result4=parse_hex4())&&(45===input.charCodeAt(pos)?(result5="-",pos++):(result5=null,0===reportFailures&&matchFailed('"-"')),null!==result5)&&null!==(result6=parse_hex4())&&(45===input.charCodeAt(pos)?(result7="-",pos++):(result7=null,0===reportFailures&&matchFailed('"-"')),null!==result7)&&null!==(result8=parse_hex12())?result0=[result0,result1,result2,result3,result4,result5,result6,result7,result8]:(result0=null,pos=pos1),null!==result0&&(result0[0],result0=void(data=input.substring(pos+5,pos0))),null===result0&&(pos=pos0),result0}function parse_hex4(){var result1,result2,result3,pos0=pos,result0=parse_HEXDIG();return null!==result0&&null!==(result1=parse_HEXDIG())&&null!==(result2=parse_HEXDIG())&&null!==(result3=parse_HEXDIG())?result0=[result0,result1,result2,result3]:(result0=null,pos=pos0),result0}function parse_hex8(){var result1,pos0=pos,result0=parse_hex4();return null!==result0&&null!==(result1=parse_hex4())?result0=[result0,result1]:(result0=null,pos=pos0),result0}function parse_hex12(){var result1,result2,pos0=pos,result0=parse_hex4();return null!==result0&&null!==(result1=parse_hex4())&&null!==(result2=parse_hex4())?result0=[result0,result1,result2]:(result0=null,pos=pos0),result0}function parse_call_id(){var result1,result2,pos2,pos0=pos,pos1=pos,result0=parse_word();return null!==result0&&(pos2=pos,64===input.charCodeAt(pos)?(result1="@",pos++):(result1=null,0===reportFailures&&matchFailed('"@"')),null!==result1&&null!==(result2=parse_word())?result1=[result1,result2]:(result1=null,pos=pos2),null!==(result1=null!==result1?result1:""))?result0=[result0,result1]:(result0=null,pos=pos1),null===(result0=null!==result0?void(data.call_id=input.substring(pos,pos0)):result0)&&(pos=pos0),result0}function parse_replaces_param(){var result0=parse_to_tag();return result0=null===result0&&null===(result0=parse_from_tag())&&null===(result0=parse_early_flag())?parse_generic_param():result0}function parse_to_tag(){var result0,result2,result1,pos0=pos,pos1=pos;return"to-tag"===input.substr(pos,6)?(result0="to-tag",pos+=6):(result0=null,0===reportFailures&&matchFailed('"to-tag"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_token())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.to_tag=result1)),null===result0&&(pos=pos0),result0}function parse_from_tag(){var result0,result2,result1,pos0=pos,pos1=pos;return"from-tag"===input.substr(pos,8)?(result0="from-tag",pos+=8):(result0=null,0===reportFailures&&matchFailed('"from-tag"')),null!==result0&&null!==(result1=parse_EQUAL())&&null!==(result2=parse_token())?result0=[result0,result1,result2]:(result0=null,pos=pos1),null!==result0&&(result1=result0[2],result0=void(data.from_tag=result1)),null===result0&&(pos=pos0),result0}function parse_early_flag(){var result0,pos0=pos;return"early-only"===input.substr(pos,10)?(result0="early-only",pos+=10):(result0=null,0===reportFailures&&matchFailed('"early-only"')),null===(result0=null!==result0?void(data.early_only=!0):result0)&&(pos=pos0),result0}var found,errorPosition,URI=require("./URI"),NameAddrHeader=require("./NameAddrHeader"),data={};return null===parseFunctions[startRule]()||pos!==input.length?(found=(parseFunctions=Math.max(pos,rightmostFailuresPos))<input.length?input.charAt(parseFunctions):null,errorPosition=function(){for(var line=1,column=1,seenCR=!1,i=0;i<Math.max(pos,rightmostFailuresPos);i++)var ch=input.charAt(i),seenCR="\n"===ch?(seenCR||line++,!(column=1)):"\r"===ch||"\u2028"===ch||"\u2029"===ch?(line++,column=1,!0):(column++,!1);return{line:line,column:column}}(),new this.SyntaxError(function(expected){expected.sort();for(var lastExpected=null,cleanExpected=[],i=0;i<expected.length;i++)expected[i]!==lastExpected&&(cleanExpected.push(expected[i]),lastExpected=expected[i]);return cleanExpected}(rightmostFailuresExpected),found,parseFunctions,errorPosition.line,errorPosition.column),-1):data},toSource:function(){return this._source}}).SyntaxError=function(expected,found,offset,line,column){this.name="SyntaxError",this.expected=expected,this.found=found,this.message=function(expected,found){var expectedHumanized;switch(expected.length){case 0:expectedHumanized="end of input";break;case 1:expectedHumanized=expected[0];break;default:expectedHumanized=expected.slice(0,expected.length-1).join(", ")+" or "+expected[expected.length-1]}return"Expected "+expectedHumanized+" but "+(found?quote(found):"end of input")+" found."}(expected,found),this.offset=offset,this.line=line,this.column=column},module.SyntaxError.prototype=Error.prototype,module)},{"./NameAddrHeader":11,"./URI":27}],8:[function(require,module,exports){"use strict";var pkg=require("../package.json"),C=require("./Constants"),Exceptions=require("./Exceptions"),Utils=require("./Utils"),UA=require("./UA"),URI=require("./URI"),NameAddrHeader=require("./NameAddrHeader"),Grammar=require("./Grammar"),WebSocketInterface=require("./WebSocketInterface");require("debug")("JsSIP")("version %s",pkg.version),module.exports={C:C,Exceptions:Exceptions,Utils:Utils,UA:UA,URI:URI,NameAddrHeader:NameAddrHeader,WebSocketInterface:WebSocketInterface,Grammar:Grammar,debug:require("debug"),get name(){return pkg.title},get version(){return pkg.version}}},{"../package.json":40,"./Constants":2,"./Exceptions":6,"./Grammar":7,"./NameAddrHeader":11,"./UA":26,"./URI":27,"./Utils":28,"./WebSocketInterface":29,debug:32}],9:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var debug=require("debug");module.exports=function(){function Logger(prefix){if(!(this instanceof Logger))throw new TypeError("Cannot call a class as a function");prefix?(this._debug=debug.default("".concat("JsSIP",":").concat(prefix)),this._warn=debug.default("".concat("JsSIP",":WARN:").concat(prefix)),this._error=debug.default("".concat("JsSIP",":ERROR:").concat(prefix))):(this._debug=debug.default("JsSIP"),this._warn=debug.default("".concat("JsSIP",":WARN")),this._error=debug.default("".concat("JsSIP",":ERROR"))),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}var Constructor,protoProps,staticProps;return Constructor=Logger,(protoProps=[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Logger}()},{debug:32}],10:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,Logger=require("./Logger"),JsSIP_C=require("./Constants"),SIPMessage=require("./SIPMessage"),Utils=require("./Utils"),RequestSender=require("./RequestSender"),Exceptions=require("./Exceptions"),URI=require("./URI"),logger=new Logger("Message");module.exports=function(){var subClass=Message,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var staticProps,_super=_createSuper(Message);function Message(ua){var _this;if(this instanceof Message)return(_this=_super.call(this))._ua=ua,_this._request=null,_this._closed=!1,_this._direction=null,_this._local_identity=null,_this._remote_identity=null,_this._is_replied=!1,_this._data={},_this;throw new TypeError("Cannot call a class as a function")}return subClass=Message,(superClass=[{key:"send",value:function(target,body){var _this2=this,options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},originalTarget=target;if(void 0===target||void 0===body)throw new TypeError("Not enough arguments");if(!(target=this._ua.normalizeTarget(target)))throw new TypeError("Invalid target: ".concat(originalTarget));var event,originalTarget=Utils.cloneArray(options.extraHeaders),eventHandlers=Utils.cloneObject(options.eventHandlers),contentType=options.contentType||"text/plain",requestParams={};for(event in options.fromUserName&&(requestParams.from_uri=new URI("sip",options.fromUserName,this._ua.configuration.uri.host),originalTarget.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),options.fromDisplayName&&(requestParams.from_display_name=options.fromDisplayName),eventHandlers)Object.prototype.hasOwnProperty.call(eventHandlers,event)&&this.on(event,eventHandlers[event]);originalTarget.push("Content-Type: ".concat(contentType)),this._request=new SIPMessage.OutgoingRequest(JsSIP_C.MESSAGE,target,this._ua,requestParams,originalTarget),body&&(this._request.body=body);options=new RequestSender(this._ua,this._request,{onRequestTimeout:function(){_this2._onRequestTimeout()},onTransportError:function(){_this2._onTransportError()},onReceiveResponse:function(response){_this2._receiveResponse(response)}});this._newMessage("local",this._request),options.send()}},{key:"init_incoming",value:function(request){this._request=request,this._newMessage("remote",request),this._is_replied||(this._is_replied=!0,request.reply(200)),this._close()}},{key:"accept",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},extraHeaders=Utils.cloneArray(options.extraHeaders),options=options.body;if("incoming"!==this._direction)throw new Exceptions.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,extraHeaders,options)}},{key:"reject",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},status_code=options.status_code||480,reason_phrase=options.reason_phrase,extraHeaders=Utils.cloneArray(options.extraHeaders),options=options.body;if("incoming"!==this._direction)throw new Exceptions.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(status_code<300||700<=status_code)throw new TypeError("Invalid status_code: ".concat(status_code));this._is_replied=!0,this._request.reply(status_code,reason_phrase,extraHeaders,options)}},{key:"_receiveResponse",value:function(response){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this._succeeded("remote",response);break;default:var cause=Utils.sipErrorCause(response.status_code);this._failed("remote",response,cause)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,JsSIP_C.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,JsSIP_C.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(originator,request){"remote"===originator?(this._direction="incoming",this._local_identity=request.to,this._remote_identity=request.from):"local"===originator&&(this._direction="outgoing",this._local_identity=request.from,this._remote_identity=request.to),this._ua.newMessage(this,{originator:originator,message:this,request:request})}},{key:"_failed",value:function(originator,response,cause){logger.debug("MESSAGE failed"),this._close(),logger.debug('emit "failed"'),this.emit("failed",{originator:originator,response:response||null,cause:cause})}},{key:"_succeeded",value:function(originator,response){logger.debug("MESSAGE succeeded"),this._close(),logger.debug('emit "succeeded"'),this.emit("succeeded",{originator:originator,response:response})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}])&&_defineProperties(subClass.prototype,superClass),staticProps&&_defineProperties(subClass,staticProps),Message}()},{"./Constants":2,"./Exceptions":6,"./Logger":9,"./RequestSender":20,"./SIPMessage":21,"./URI":27,"./Utils":28,events:31}],11:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}var URI=require("./URI"),Grammar=require("./Grammar");module.exports=function(){function NameAddrHeader(uri,display_name,parameters){if(!(this instanceof NameAddrHeader))throw new TypeError("Cannot call a class as a function");if(!(uri&&uri instanceof URI))throw new TypeError('missing or invalid "uri" parameter');for(var param in this._uri=uri,this._parameters={},this.display_name=display_name,parameters)Object.prototype.hasOwnProperty.call(parameters,param)&&this.setParam(param,parameters[param])}return _createClass(NameAddrHeader,null,[{key:"parse",value:function(name_addr_header){if(-1!==(name_addr_header=Grammar.parse(name_addr_header,"Name_Addr_Header")))return name_addr_header}}]),_createClass(NameAddrHeader,[{key:"setParam",value:function(key,value){key&&(this._parameters[key.toLowerCase()]=null==value?null:value.toString())}},{key:"getParam",value:function(key){if(key)return this._parameters[key.toLowerCase()]}},{key:"hasParam",value:function(key){if(key)return!!this._parameters.hasOwnProperty(key.toLowerCase())}},{key:"deleteParam",value:function(parameter){var value;if(parameter=parameter.toLowerCase(),this._parameters.hasOwnProperty(parameter))return value=this._parameters[parameter],delete this._parameters[parameter],value}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new NameAddrHeader(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"_quote",value:function(str){return str.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}},{key:"toString",value:function(){var parameter,body=this._display_name?'"'.concat(this._quote(this._display_name),'" '):"";for(parameter in body+="<".concat(this._uri.toString(),">"),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,parameter)&&(body+=";".concat(parameter),null!==this._parameters[parameter])&&(body+="=".concat(this._parameters[parameter]));return body}},{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(value){this._display_name=0===value?"0":value}}]),NameAddrHeader}()},{"./Grammar":7,"./URI":27}],12:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,Logger=require("./Logger"),JsSIP_C=require("./Constants"),SIPMessage=require("./SIPMessage"),Utils=require("./Utils"),RequestSender=require("./RequestSender"),Exceptions=require("./Exceptions"),logger=new Logger("Options");module.exports=function(){var subClass=Options,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var staticProps,_super=_createSuper(Options);function Options(ua){var _this;if(this instanceof Options)return(_this=_super.call(this))._ua=ua,_this._request=null,_this._closed=!1,_this._direction=null,_this._local_identity=null,_this._remote_identity=null,_this._is_replied=!1,_this._data={},_this;throw new TypeError("Cannot call a class as a function")}return subClass=Options,(superClass=[{key:"send",value:function(target,body){var _this2=this,options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},originalTarget=target;if(void 0===target)throw new TypeError("A target is required for OPTIONS");if(!(target=this._ua.normalizeTarget(target)))throw new TypeError("Invalid target: ".concat(originalTarget));var event,originalTarget=Utils.cloneArray(options.extraHeaders),eventHandlers=Utils.cloneObject(options.eventHandlers),options=options.contentType||"application/sdp";for(event in eventHandlers)Object.prototype.hasOwnProperty.call(eventHandlers,event)&&this.on(event,eventHandlers[event]);originalTarget.push("Content-Type: ".concat(options)),this._request=new SIPMessage.OutgoingRequest(JsSIP_C.OPTIONS,target,this._ua,null,originalTarget),body&&(this._request.body=body);options=new RequestSender(this._ua,this._request,{onRequestTimeout:function(){_this2._onRequestTimeout()},onTransportError:function(){_this2._onTransportError()},onReceiveResponse:function(response){_this2._receiveResponse(response)}});this._newOptions("local",this._request),options.send()}},{key:"init_incoming",value:function(request){this._request=request,this._newOptions("remote",request),this._is_replied||(this._is_replied=!0,request.reply(200)),this._close()}},{key:"accept",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},extraHeaders=Utils.cloneArray(options.extraHeaders),options=options.body;if("incoming"!==this._direction)throw new Exceptions.NotSupportedError('"accept" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");this._is_replied=!0,this._request.reply(200,null,extraHeaders,options)}},{key:"reject",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},status_code=options.status_code||480,reason_phrase=options.reason_phrase,extraHeaders=Utils.cloneArray(options.extraHeaders),options=options.body;if("incoming"!==this._direction)throw new Exceptions.NotSupportedError('"reject" not supported for outgoing Options');if(this._is_replied)throw new Error("incoming Options already replied");if(status_code<300||700<=status_code)throw new TypeError("Invalid status_code: ".concat(status_code));this._is_replied=!0,this._request.reply(status_code,reason_phrase,extraHeaders,options)}},{key:"_receiveResponse",value:function(response){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):this._succeeded("remote",response);break;default:var cause=Utils.sipErrorCause(response.status_code);this._failed("remote",response,cause)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,JsSIP_C.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,JsSIP_C.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newOptions",value:function(originator,request){"remote"===originator?(this._direction="incoming",this._local_identity=request.to,this._remote_identity=request.from):"local"===originator&&(this._direction="outgoing",this._local_identity=request.from,this._remote_identity=request.to),this._ua.newOptions(this,{originator:originator,message:this,request:request})}},{key:"_failed",value:function(originator,response,cause){logger.debug("OPTIONS failed"),this._close(),logger.debug('emit "failed"'),this.emit("failed",{originator:originator,response:response||null,cause:cause})}},{key:"_succeeded",value:function(originator,response){logger.debug("OPTIONS succeeded"),this._close(),logger.debug('emit "succeeded"'),this.emit("succeeded",{originator:originator,response:response})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}])&&_defineProperties(subClass.prototype,superClass),staticProps&&_defineProperties(subClass,staticProps),Options}()},{"./Constants":2,"./Exceptions":6,"./Logger":9,"./RequestSender":20,"./SIPMessage":21,"./Utils":28,events:31}],13:[function(require,module,exports){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var Logger=require("./Logger"),Grammar=require("./Grammar"),SIPMessage=require("./SIPMessage"),logger=new Logger("Parser");exports.parseMessage=function(data,ua){var message,bodyStart,headerEnd=data.indexOf("\r\n");if(-1===headerEnd)logger.warn("parseMessage() | no CRLF found, not a SIP message");else{var firstLine=data.substring(0,headerEnd),parsed=Grammar.parse(firstLine,"Request_Response");if(-1!==parsed){parsed.status_code?((message=new SIPMessage.IncomingResponse).status_code=parsed.status_code,message.reason_phrase=parsed.reason_phrase):((message=new SIPMessage.IncomingRequest(ua)).method=parsed.method,message.ruri=parsed.uri),message.data=data;for(var headerStart=headerEnd+2;;){if(-2===(headerEnd=function(data,headerStart){var start=headerStart,end=0,partialEnd=0;if(data.substring(start,start+2).match(/(^\r\n)/))return-2;for(;0===end;){if(-1===(partialEnd=data.indexOf("\r\n",start)))return partialEnd;!data.substring(partialEnd+2,partialEnd+4).match(/(^\r\n)/)&&data.charAt(partialEnd+2).match(/(^\s+)/)?start=partialEnd+2:end=partialEnd}return end}(data,headerStart))){bodyStart=headerStart+2;break}if(-1===headerEnd)return void logger.warn("parseMessage() | malformed message");if(!0!==(parsed=function(message,data,headerStart,headerEnd){var parsed,hcolonIndex=data.indexOf(":",headerStart),headerName=data.substring(headerStart,hcolonIndex).trim(),headerValue=data.substring(hcolonIndex+1,headerEnd).trim();switch(headerName.toLowerCase()){case"via":case"v":message.addHeader("via",headerValue),1===message.getHeaders("via").length?(parsed=message.parseHeader("Via"))&&(message.via=parsed,message.via_branch=parsed.branch):parsed=0;break;case"from":case"f":message.setHeader("from",headerValue),(parsed=message.parseHeader("from"))&&(message.from=parsed,message.from_tag=parsed.getParam("tag"));break;case"to":case"t":message.setHeader("to",headerValue),(parsed=message.parseHeader("to"))&&(message.to=parsed,message.to_tag=parsed.getParam("tag"));break;case"record-route":if(-1===(parsed=Grammar.parse(headerValue,"Record_Route")))parsed=void 0;else{var _step,_iterator=_createForOfIteratorHelper(parsed);try{for(_iterator.s();!(_step=_iterator.n()).done;){var header=_step.value;message.addHeader("record-route",headerValue.substring(header.possition,header.offset)),message.headers["Record-Route"][message.getHeaders("record-route").length-1].parsed=header.parsed}}catch(err){_iterator.e(err)}finally{_iterator.f()}}break;case"call-id":case"i":message.setHeader("call-id",headerValue),(parsed=message.parseHeader("call-id"))&&(message.call_id=headerValue);break;case"contact":case"m":if(-1===(parsed=Grammar.parse(headerValue,"Contact")))parsed=void 0;else{var _step2,_iterator2=_createForOfIteratorHelper(parsed);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _header=_step2.value;message.addHeader("contact",headerValue.substring(_header.possition,_header.offset)),message.headers.Contact[message.getHeaders("contact").length-1].parsed=_header.parsed}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}break;case"content-length":case"l":message.setHeader("content-length",headerValue),parsed=message.parseHeader("content-length");break;case"content-type":case"c":message.setHeader("content-type",headerValue),parsed=message.parseHeader("content-type");break;case"cseq":message.setHeader("cseq",headerValue),(parsed=message.parseHeader("cseq"))&&(message.cseq=parsed.value),message instanceof SIPMessage.IncomingResponse&&(message.method=parsed.method);break;case"max-forwards":message.setHeader("max-forwards",headerValue),parsed=message.parseHeader("max-forwards");break;case"www-authenticate":message.setHeader("www-authenticate",headerValue),parsed=message.parseHeader("www-authenticate");break;case"proxy-authenticate":message.setHeader("proxy-authenticate",headerValue),parsed=message.parseHeader("proxy-authenticate");break;case"session-expires":case"x":message.setHeader("session-expires",headerValue),(parsed=message.parseHeader("session-expires"))&&(message.session_expires=parsed.expires,message.session_expires_refresher=parsed.refresher);break;case"refer-to":case"r":message.setHeader("refer-to",headerValue),(parsed=message.parseHeader("refer-to"))&&(message.refer_to=parsed);break;case"replaces":message.setHeader("replaces",headerValue),(parsed=message.parseHeader("replaces"))&&(message.replaces=parsed);break;case"event":case"o":message.setHeader("event",headerValue),(parsed=message.parseHeader("event"))&&(message.event=parsed);break;default:message.addHeader(headerName,headerValue),parsed=0}return void 0!==parsed||{error:'error parsing header "'.concat(headerName,'"')}}(message,data,headerStart,headerEnd)))return void logger.warn("parseMessage() |",parsed.error);headerStart=headerEnd+2}return message.hasHeader("content-length")?(ua=message.getHeader("content-length"),message.body=data.substr(bodyStart,ua)):message.body=data.substring(bodyStart),message}logger.warn('parseMessage() | error parsing first line of SIP message: "'.concat(firstLine,'"'))}}},{"./Grammar":7,"./Logger":9,"./SIPMessage":21}],14:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e2){throw _e2},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e3){didErr=!0,err=_e3},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,sdp_transform=require("sdp-transform"),Logger=require("./Logger"),JsSIP_C=require("./Constants"),Exceptions=require("./Exceptions"),Transactions=require("./Transactions"),Utils=require("./Utils"),Timers=require("./Timers"),SIPMessage=require("./SIPMessage"),Dialog=require("./Dialog"),RequestSender=require("./RequestSender"),RTCSession_DTMF=require("./RTCSession/DTMF"),RTCSession_Info=require("./RTCSession/Info"),RTCSession_ReferNotifier=require("./RTCSession/ReferNotifier"),RTCSession_ReferSubscriber=require("./RTCSession/ReferSubscriber"),URI=require("./URI"),logger=new Logger("RTCSession"),C={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},holdMediaTypes=["audio","video"];module.exports=function(){var subClass=RTCSession,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var _super=_createSuper(RTCSession);function RTCSession(ua){var _this;if(this instanceof RTCSession)return logger.debug("new"),(_this=_super.call(this))._id=null,_this._ua=ua,_this._status=C.STATUS_NULL,_this._dialog=null,_this._earlyDialogs={},_this._contact=null,_this._from_tag=null,_this._to_tag=null,_this._connection=null,_this._connectionPromiseQueue=Promise.resolve(),_this._request=null,_this._is_canceled=!1,_this._cancel_reason="",_this._is_confirmed=!1,_this._late_sdp=!1,_this._rtcOfferConstraints=null,_this._rtcAnswerConstraints=null,_this._localMediaStream=null,_this._localMediaStreamLocallyGenerated=!1,_this._rtcReady=!0,_this._iceReady=!1,_this._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},_this._direction=null,_this._local_identity=null,_this._remote_identity=null,_this._start_time=null,_this._end_time=null,_this._tones=null,_this._audioMuted=!1,_this._videoMuted=!1,_this._localHold=!1,_this._remoteHold=!1,_this._sessionTimers={enabled:_this._ua.configuration.session_timers,refreshMethod:_this._ua.configuration.session_timers_refresh_method,defaultExpires:JsSIP_C.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},_this._referSubscribers={},_this._data={},_this;throw new TypeError("Cannot call a class as a function")}return _createClass(RTCSession,null,[{key:"C",get:function(){return C}}]),_createClass(RTCSession,[{key:"isInProgress",value:function(){switch(this._status){case C.STATUS_NULL:case C.STATUS_INVITE_SENT:case C.STATUS_1XX_RECEIVED:case C.STATUS_INVITE_RECEIVED:case C.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case C.STATUS_ANSWERED:case C.STATUS_WAITING_FOR_ACK:case C.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case C.STATUS_CANCELED:case C.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(target){var event,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},initCallback=2<arguments.length?arguments[2]:void 0,originalTarget=(logger.debug("connect()"),target),eventHandlers=Utils.cloneObject(options.eventHandlers),extraHeaders=Utils.cloneArray(options.extraHeaders),mediaConstraints=Utils.cloneObject(options.mediaConstraints,{audio:!0,video:!0}),mediaStream=options.mediaStream||null,pcConfig=Utils.cloneObject(options.pcConfig,{iceServers:[]}),rtcConstraints=options.rtcConstraints||null,rtcOfferConstraints=options.rtcOfferConstraints||null;if(this._rtcOfferConstraints=rtcOfferConstraints,this._rtcAnswerConstraints=options.rtcAnswerConstraints||null,this._data=options.data||this._data,void 0===target)throw new TypeError("Not enough arguments");if(this._status!==C.STATUS_NULL)throw new Exceptions.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new Exceptions.NotSupportedError("WebRTC not supported");if(!(target=this._ua.normalizeTarget(target)))throw new TypeError("Invalid target: ".concat(originalTarget));for(event in this._sessionTimers.enabled&&Utils.isDecimal(options.sessionTimersExpires)&&(options.sessionTimersExpires>=JsSIP_C.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=options.sessionTimersExpires:this._sessionTimers.defaultExpires=JsSIP_C.SESSION_EXPIRES),eventHandlers)Object.prototype.hasOwnProperty.call(eventHandlers,event)&&this.on(event,eventHandlers[event]);this._from_tag=Utils.newTag();var originalTarget=options.anonymous||!1,requestParams={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:originalTarget,outbound:!0}),originalTarget?(requestParams.from_display_name="Anonymous",requestParams.from_uri=new URI("sip","anonymous","anonymous.invalid"),extraHeaders.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString())),extraHeaders.push("Privacy: id")):options.fromUserName&&(requestParams.from_uri=new URI("sip",options.fromUserName,this._ua.configuration.uri.host),extraHeaders.push("P-Preferred-Identity: ".concat(this._ua.configuration.uri.toString()))),options.fromDisplayName&&(requestParams.from_display_name=options.fromDisplayName),extraHeaders.push("Contact: ".concat(this._contact)),extraHeaders.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&extraHeaders.push("Session-Expires: ".concat(this._sessionTimers.defaultExpires).concat(this._ua.configuration.session_timers_force_refresher?";refresher=uac":"")),this._request=new SIPMessage.InitialOutgoingInviteRequest(target,this._ua,requestParams,extraHeaders),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(pcConfig,rtcConstraints),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,initCallback&&initCallback(this),this._newRTCSession("local",this._request),this._sendInitialRequest(mediaConstraints,rtcOfferConstraints,mediaStream)}},{key:"init_incoming",value:function(request,initCallback){var expires,_this2=this,contentType=(logger.debug("init_incoming()"),request.hasHeader("Content-Type")?request.getHeader("Content-Type").toLowerCase():void 0);request.body&&"application/sdp"!==contentType?request.reply(415):(this._status=C.STATUS_INVITE_RECEIVED,this._from_tag=request.from_tag,this._id=request.call_id+this._from_tag,this._request=request,this._contact=this._ua.contact.toString(),request.hasHeader("expires")&&(expires=1e3*request.getHeader("expires")),request.to_tag=Utils.newTag(),this._createDialog(request,"UAS",!0)?(request.body?this._late_sdp=!1:this._late_sdp=!0,this._status=C.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(function(){request.reply(408),_this2._failed("local",null,JsSIP_C.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),expires&&(this._timers.expiresTimer=setTimeout(function(){_this2._status===C.STATUS_WAITING_FOR_ANSWER&&(request.reply(487),_this2._failed("system",null,JsSIP_C.causes.EXPIRES))},expires)),this._direction="incoming",this._local_identity=request.to,this._remote_identity=request.from,initCallback&&initCallback(this),this._newRTCSession("remote",request),this._status!==C.STATUS_TERMINATED&&(request.reply(180,null,["Contact: ".concat(this._contact)]),this._progress("local",null))):request.reply(500,"Missing Contact header field"))}},{key:"answer",value:function(){var _this3=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},request=(logger.debug("answer()"),this._request),extraHeaders=Utils.cloneArray(options.extraHeaders),mediaConstraints=Utils.cloneObject(options.mediaConstraints),mediaStream=options.mediaStream||null,pcConfig=Utils.cloneObject(options.pcConfig,{iceServers:[]}),rtcConstraints=options.rtcConstraints||null,rtcAnswerConstraints=options.rtcAnswerConstraints||null,rtcOfferConstraints=Utils.cloneObject(options.rtcOfferConstraints),peerHasAudioLine=!1,peerHasVideoLine=!1,peerOffersFullAudio=!1,peerOffersFullVideo=!1;if(this._rtcAnswerConstraints=rtcAnswerConstraints,this._rtcOfferConstraints=options.rtcOfferConstraints||null,this._data=options.data||this._data,"incoming"!==this._direction)throw new Exceptions.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==C.STATUS_WAITING_FOR_ANSWER)throw new Exceptions.InvalidStateError(this._status);if(this._sessionTimers.enabled&&Utils.isDecimal(options.sessionTimersExpires)&&(options.sessionTimersExpires>=JsSIP_C.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=options.sessionTimersExpires:this._sessionTimers.defaultExpires=JsSIP_C.SESSION_EXPIRES),this._status=C.STATUS_ANSWERED,this._createDialog(request,"UAS")){clearTimeout(this._timers.userNoAnswerTimer),extraHeaders.unshift("Contact: ".concat(this._contact));var _step,options=request.parseSDP(),_iterator=(Array.isArray(options.media)||(options.media=[options.media]),_createForOfIteratorHelper(options.media));try{for(_iterator.s();!(_step=_iterator.n()).done;){var m=_step.value;"audio"===m.type&&(peerHasAudioLine=!0,m.direction&&"sendrecv"!==m.direction||(peerOffersFullAudio=!0)),"video"===m.type&&(peerHasVideoLine=!0,m.direction&&"sendrecv"!==m.direction||(peerOffersFullVideo=!0))}}catch(err){_iterator.e(err)}finally{_iterator.f()}if(mediaStream&&!1===mediaConstraints.audio){var _step2,_iterator2=_createForOfIteratorHelper(mediaStream.getAudioTracks());try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var track=_step2.value;mediaStream.removeTrack(track)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}if(mediaStream&&!1===mediaConstraints.video){var _step3,_iterator3=_createForOfIteratorHelper(mediaStream.getVideoTracks());try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _track=_step3.value;mediaStream.removeTrack(_track)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}mediaStream||void 0!==mediaConstraints.audio||(mediaConstraints.audio=peerOffersFullAudio),mediaStream||void 0!==mediaConstraints.video||(mediaConstraints.video=peerOffersFullVideo),mediaStream||peerHasAudioLine||rtcOfferConstraints.offerToReceiveAudio||(mediaConstraints.audio=!1),mediaStream||peerHasVideoLine||rtcOfferConstraints.offerToReceiveVideo||(mediaConstraints.video=!1),this._createRTCConnection(pcConfig,rtcConstraints),Promise.resolve().then(function(){return mediaStream||(mediaConstraints.audio||mediaConstraints.video?(_this3._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(mediaConstraints).catch(function(error){if(_this3._status===C.STATUS_TERMINATED)throw new Error("terminated");throw request.reply(480),_this3._failed("local",null,JsSIP_C.causes.USER_DENIED_MEDIA_ACCESS),logger.warn('emit "getusermediafailed" [error:%o]',error),_this3.emit("getusermediafailed",error),new Error("getUserMedia() failed")})):void 0)}).then(function(stream){if(_this3._status===C.STATUS_TERMINATED)throw new Error("terminated");(_this3._localMediaStream=stream)&&stream.getTracks().forEach(function(track){_this3._connection.addTrack(track,stream)})}).then(function(){var e,offer;if(!_this3._late_sdp)return e={originator:"remote",type:"offer",sdp:request.body},logger.debug('emit "sdp"'),_this3.emit("sdp",e),offer=new RTCSessionDescription({type:"offer",sdp:e.sdp}),_this3._connectionPromiseQueue=_this3._connectionPromiseQueue.then(function(){return _this3._connection.setRemoteDescription(offer)}).catch(function(error){throw request.reply(488),_this3._failed("system",null,JsSIP_C.causes.WEBRTC_ERROR),logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this3.emit("peerconnection:setremotedescriptionfailed",error),new Error("peerconnection.setRemoteDescription() failed")}),_this3._connectionPromiseQueue}).then(function(){if(_this3._status===C.STATUS_TERMINATED)throw new Error("terminated");return _this3._connecting(request),(_this3._late_sdp?_this3._createLocalDescription("offer",_this3._rtcOfferConstraints):_this3._createLocalDescription("answer",rtcAnswerConstraints)).catch(function(){throw request.reply(500),new Error("_createLocalDescription() failed")})}).then(function(desc){if(_this3._status===C.STATUS_TERMINATED)throw new Error("terminated");_this3._handleSessionTimersInIncomingRequest(request,extraHeaders),request.reply(200,null,extraHeaders,desc,function(){_this3._status=C.STATUS_WAITING_FOR_ACK,_this3._setInvite2xxTimer(request,desc),_this3._setACKTimer(),_this3._accepted("local")},function(){_this3._failed("system",null,JsSIP_C.causes.CONNECTION_ERROR)})}).catch(function(error){_this3._status!==C.STATUS_TERMINATED&&logger.warn(error)})}else request.reply(500,"Error creating dialog")}},{key:"terminate",value:function(){var cancel_reason,dialog,_this4=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},cause=(logger.debug("terminate()"),options.cause||JsSIP_C.causes.BYE),extraHeaders=Utils.cloneArray(options.extraHeaders),body=options.body,status_code=options.status_code,reason_phrase=options.reason_phrase;if(this._status===C.STATUS_TERMINATED)throw new Exceptions.InvalidStateError(this._status);switch(this._status){case C.STATUS_NULL:case C.STATUS_INVITE_SENT:case C.STATUS_1XX_RECEIVED:if(logger.debug("canceling session"),status_code&&(status_code<200||700<=status_code))throw new TypeError("Invalid status_code: ".concat(status_code));status_code&&(reason_phrase=reason_phrase||JsSIP_C.REASON_PHRASE[status_code]||"",cancel_reason="SIP ;cause=".concat(status_code,' ;text="').concat(reason_phrase,'"')),this._status===C.STATUS_NULL||this._status===C.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=cancel_reason):this._status===C.STATUS_1XX_RECEIVED&&this._request.cancel(cancel_reason),this._status=C.STATUS_CANCELED,this._failed("local",null,JsSIP_C.causes.CANCELED);break;case C.STATUS_WAITING_FOR_ANSWER:case C.STATUS_ANSWERED:if(logger.debug("rejecting session"),(status_code=status_code||480)<300||700<=status_code)throw new TypeError("Invalid status_code: ".concat(status_code));this._request.reply(status_code,reason_phrase,extraHeaders,body),this._failed("local",null,JsSIP_C.causes.REJECTED);break;case C.STATUS_WAITING_FOR_ACK:case C.STATUS_CONFIRMED:if(logger.debug("terminating session"),reason_phrase=options.reason_phrase||JsSIP_C.REASON_PHRASE[status_code]||"",status_code&&(status_code<200||700<=status_code))throw new TypeError("Invalid status_code: ".concat(status_code));status_code&&extraHeaders.push("Reason: SIP ;cause=".concat(status_code,'; text="').concat(reason_phrase,'"')),this._status===C.STATUS_WAITING_FOR_ACK&&"incoming"===this._direction&&this._request.server_transaction.state!==Transactions.C.STATUS_TERMINATED?(dialog=this._dialog,this.receiveRequest=function(_ref){_ref.method===JsSIP_C.ACK&&(_this4.sendRequest(JsSIP_C.BYE,{extraHeaders:extraHeaders,body:body}),dialog.terminate())},this._request.server_transaction.on("stateChanged",function(){_this4._request.server_transaction.state===Transactions.C.STATUS_TERMINATED&&(_this4.sendRequest(JsSIP_C.BYE,{extraHeaders:extraHeaders,body:body}),dialog.terminate())}),this._ended("local",null,cause),this._dialog=dialog,this._ua.newDialog(dialog)):(this.sendRequest(JsSIP_C.BYE,{extraHeaders:extraHeaders,body:body}),this._ended("local",null,cause))}}},{key:"sendDTMF",value:function(tones){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},position=(logger.debug("sendDTMF() | tones: %s",tones),0),duration=options.duration||null,interToneGap=options.interToneGap||null,transportType=options.transportType||JsSIP_C.DTMF_TRANSPORT.INFO;if(void 0===tones)throw new TypeError("Not enough arguments");if(this._status!==C.STATUS_CONFIRMED&&this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_1XX_RECEIVED)throw new Exceptions.InvalidStateError(this._status);if(transportType!==JsSIP_C.DTMF_TRANSPORT.INFO&&transportType!==JsSIP_C.DTMF_TRANSPORT.RFC2833)throw new TypeError("invalid transportType: ".concat(transportType));if(!(tones="number"==typeof tones?tones.toString():tones)||"string"!=typeof tones||!tones.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: ".concat(tones));if(duration&&!Utils.isDecimal(duration))throw new TypeError("Invalid tone duration: ".concat(duration));if(duration=duration?duration<RTCSession_DTMF.C.MIN_DURATION?(logger.debug('"duration" value is lower than the minimum allowed, setting it to '.concat(RTCSession_DTMF.C.MIN_DURATION," milliseconds")),RTCSession_DTMF.C.MIN_DURATION):duration>RTCSession_DTMF.C.MAX_DURATION?(logger.debug('"duration" value is greater than the maximum allowed, setting it to '.concat(RTCSession_DTMF.C.MAX_DURATION," milliseconds")),RTCSession_DTMF.C.MAX_DURATION):Math.abs(duration):RTCSession_DTMF.C.DEFAULT_DURATION,options.duration=duration,interToneGap&&!Utils.isDecimal(interToneGap))throw new TypeError("Invalid interToneGap: ".concat(interToneGap));function _sendDTMF(){var tone,dtmf,_this5=this;this._status===C.STATUS_TERMINATED||!this._tones||position>=this._tones.length?this._tones=null:(tone=this._tones[position],position+=1,dtmf=","===tone?2e3:(dtmf=new RTCSession_DTMF(this),options.eventHandlers={onFailed:function(){_this5._tones=null}},dtmf.send(tone,options),duration+interToneGap),setTimeout(_sendDTMF.bind(this),dtmf))}interToneGap=interToneGap?interToneGap<RTCSession_DTMF.C.MIN_INTER_TONE_GAP?(logger.debug('"interToneGap" value is lower than the minimum allowed, setting it to '.concat(RTCSession_DTMF.C.MIN_INTER_TONE_GAP," milliseconds")),RTCSession_DTMF.C.MIN_INTER_TONE_GAP):Math.abs(interToneGap):RTCSession_DTMF.C.DEFAULT_INTER_TONE_GAP,transportType===JsSIP_C.DTMF_TRANSPORT.RFC2833?(transportType=this._getDTMFRTPSender())&&(tones=transportType.toneBuffer+tones,transportType.insertDTMF(tones,duration,interToneGap)):this._tones?this._tones+=tones:(this._tones=tones,_sendDTMF.call(this))}},{key:"sendInfo",value:function(contentType,body){var options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(logger.debug("sendInfo()"),this._status!==C.STATUS_CONFIRMED&&this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_1XX_RECEIVED)throw new Exceptions.InvalidStateError(this._status);new RTCSession_Info(this).send(contentType,body,options)}},{key:"mute",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!1},audioMuted=(logger.debug("mute()"),!1),videoMuted=!1;!1===this._audioMuted&&options.audio&&(this._audioMuted=audioMuted=!0,this._toggleMuteAudio(!0)),!1===this._videoMuted&&options.video&&(this._videoMuted=videoMuted=!0,this._toggleMuteVideo(!0)),!0!==audioMuted&&!0!==videoMuted||this._onmute({audio:audioMuted,video:videoMuted})}},{key:"unmute",value:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0},audioUnMuted=(logger.debug("unmute()"),!1),videoUnMuted=!1;!0===this._audioMuted&&options.audio&&(this._audioMuted=!(audioUnMuted=!0))===this._localHold&&this._toggleMuteAudio(!1),!0===this._videoMuted&&options.video&&(this._videoMuted=!(videoUnMuted=!0))===this._localHold&&this._toggleMuteVideo(!1),!0!==audioUnMuted&&!0!==videoUnMuted||this._onunmute({audio:audioUnMuted,video:videoUnMuted})}},{key:"hold",value:function(){var _this6=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},done=1<arguments.length?arguments[1]:void 0;if(logger.debug("hold()"),this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_CONFIRMED)return!1;if(!0===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var eventHandlers={succeeded:function(){done&&done()},failed:function(){_this6.terminate({cause:JsSIP_C.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return options.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:eventHandlers,extraHeaders:options.extraHeaders}):this._sendReinvite({eventHandlers:eventHandlers,extraHeaders:options.extraHeaders}),!0}},{key:"unhold",value:function(){var _this7=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},done=1<arguments.length?arguments[1]:void 0;if(logger.debug("unhold()"),this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_CONFIRMED)return!1;if(!1===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var eventHandlers={succeeded:function(){done&&done()},failed:function(){_this7.terminate({cause:JsSIP_C.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return options.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:eventHandlers,extraHeaders:options.extraHeaders}):this._sendReinvite({eventHandlers:eventHandlers,extraHeaders:options.extraHeaders}),!0}},{key:"renegotiate",value:function(){var eventHandlers,_this8=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},done=1<arguments.length?arguments[1]:void 0,rtcOfferConstraints=(logger.debug("renegotiate()"),options.rtcOfferConstraints||null);return!(this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_CONFIRMED||!this._isReadyToReOffer()||(eventHandlers={succeeded:function(){done&&done()},failed:function(){_this8.terminate({cause:JsSIP_C.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}},this._setLocalMediaStatus(),options.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:eventHandlers,rtcOfferConstraints:rtcOfferConstraints,extraHeaders:options.extraHeaders}):this._sendReinvite({eventHandlers:eventHandlers,rtcOfferConstraints:rtcOfferConstraints,extraHeaders:options.extraHeaders}),0))}},{key:"refer",value:function(target,options){var referSubscriber,id,_this9=this,originalTarget=(logger.debug("refer()"),target);if(this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_CONFIRMED)return!1;if(target=this._ua.normalizeTarget(target))return(referSubscriber=new RTCSession_ReferSubscriber(this)).sendRefer(target,options),id=referSubscriber.id,(this._referSubscribers[id]=referSubscriber).on("requestFailed",function(){delete _this9._referSubscribers[id]}),referSubscriber.on("accepted",function(){delete _this9._referSubscribers[id]}),referSubscriber.on("failed",function(){delete _this9._referSubscribers[id]}),referSubscriber;throw new TypeError("Invalid target: ".concat(originalTarget))}},{key:"sendRequest",value:function(method,options){return logger.debug("sendRequest()"),this._dialog.sendRequest(method,options)}},{key:"receiveRequest",value:function(request){var _this10=this;if(logger.debug("receiveRequest()"),request.method===JsSIP_C.CANCEL)this._status!==C.STATUS_WAITING_FOR_ANSWER&&this._status!==C.STATUS_ANSWERED||(this._status=C.STATUS_CANCELED,this._request.reply(487),console.log("call CANCELED recv ...."),this._ended("remote",request,JsSIP_C.causes.BYE),this._failed("remote",request,JsSIP_C.causes.CANCELED));else switch(request.method){case JsSIP_C.ACK:if(this._status===C.STATUS_WAITING_FOR_ACK)if(this._status=C.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!request.body){this.terminate({cause:JsSIP_C.causes.MISSING_SDP,status_code:400});break}var e={originator:"remote",type:"answer",sdp:request.body},answer=(logger.debug('emit "sdp"'),this.emit("sdp",e),new RTCSessionDescription({type:"answer",sdp:e.sdp}));this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this10._connection.setRemoteDescription(answer)}).then(function(){_this10._is_confirmed||_this10._confirmed("remote",request)}).catch(function(error){_this10.terminate({cause:JsSIP_C.causes.BAD_MEDIA_DESCRIPTION+" error: "+error.message+"\r\n"+error.stack,status_code:488}),logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this10.emit("peerconnection:setremotedescriptionfailed",error)})}else this._is_confirmed||this._confirmed("remote",request);break;case JsSIP_C.BYE:console.log("BYE recv ...."),this._status===C.STATUS_CONFIRMED||this._status===C.STATUS_WAITING_FOR_ACK?(request.reply(200),this._ended("remote",request,JsSIP_C.causes.BYE)):this._status===C.STATUS_INVITE_RECEIVED||this._status===C.STATUS_WAITING_FOR_ANSWER?(request.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",request,JsSIP_C.causes.BYE)):request.reply(403,"Wrong Status");break;case JsSIP_C.INVITE:this._status===C.STATUS_CONFIRMED?request.hasHeader("replaces")?this._receiveReplaces(request):this._receiveReinvite(request):request.reply(403,"Wrong Status");break;case JsSIP_C.INFO:this._status===C.STATUS_1XX_RECEIVED||this._status===C.STATUS_WAITING_FOR_ANSWER||this._status===C.STATUS_ANSWERED||this._status===C.STATUS_WAITING_FOR_ACK||this._status===C.STATUS_CONFIRMED?(e=request.hasHeader("Content-Type")?request.getHeader("Content-Type").toLowerCase():void 0)&&e.match(/^application\/dtmf-relay/i)?new RTCSession_DTMF(this).init_incoming(request):void 0!==e?new RTCSession_Info(this).init_incoming(request):request.reply(415):request.reply(403,"Wrong Status");break;case JsSIP_C.UPDATE:this._status===C.STATUS_CONFIRMED?this._receiveUpdate(request):request.reply(403,"Wrong Status");break;case JsSIP_C.REFER:this._status===C.STATUS_CONFIRMED?this._receiveRefer(request):request.reply(403,"Wrong Status");break;case JsSIP_C.NOTIFY:this._status===C.STATUS_CONFIRMED?this._receiveNotify(request):request.reply(403,"Wrong Status");break;default:request.reply(501)}}},{key:"onTransportError",value:function(){logger.warn("onTransportError()"),this._status!==C.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:JsSIP_C.causes.CONNECTION_ERROR,cause:JsSIP_C.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){logger.warn("onRequestTimeout()"),this._status!==C.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:JsSIP_C.causes.REQUEST_TIMEOUT,cause:JsSIP_C.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){logger.warn("onDialogError()"),this._status!==C.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:JsSIP_C.causes.DIALOG_ERROR,cause:JsSIP_C.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(data){logger.debug("newDTMF()"),this.emit("newDTMF",data)}},{key:"newInfo",value:function(data){logger.debug("newInfo()"),this.emit("newInfo",data)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?!0!==this._dialog.uac_pending_reply&&!0!==this._dialog.uas_pending_reply||(logger.debug("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(logger.debug("_isReadyToReOffer() | session not established yet"),!1):(logger.debug("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(logger.debug("close()"),this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(logger.debug("close() | closing local MediaStream"),Utils.closeMediaStream(this._localMediaStream)),this._status!==C.STATUS_TERMINATED){if(this._status=C.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(error){logger.warn("close() | error closing the RTCPeerConnection: %o",error)}for(var timer in this._timers)Object.prototype.hasOwnProperty.call(this._timers,timer)&&clearTimeout(this._timers[timer]);for(var dialog in clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog),this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,dialog)&&(this._earlyDialogs[dialog].terminate(),delete this._earlyDialogs[dialog]);for(var subscriber in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,subscriber)&&delete this._referSubscribers[subscriber];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(request,body){var timeout=Timers.T1;function invite2xxRetransmission(){this._status===C.STATUS_WAITING_FOR_ACK&&(request.reply(200,null,["Contact: ".concat(this._contact)],body),timeout<Timers.T2&&(timeout*=2)>Timers.T2&&(timeout=Timers.T2),this._timers.invite2xxTimer=setTimeout(invite2xxRetransmission.bind(this),timeout))}this._timers.invite2xxTimer=setTimeout(invite2xxRetransmission.bind(this),timeout)}},{key:"_setACKTimer",value:function(){var _this11=this;this._timers.ackTimer=setTimeout(function(){_this11._status===C.STATUS_WAITING_FOR_ACK&&(logger.debug("no ACK received, terminating the session"),clearTimeout(_this11._timers.invite2xxTimer),_this11.sendRequest(JsSIP_C.BYE),_this11._ended("remote",null,JsSIP_C.causes.NO_ACK))},Timers.TIMER_H)}},{key:"_createRTCConnection",value:function(pcConfig,rtcConstraints){var _this12=this;this._connection=new RTCPeerConnection(pcConfig,rtcConstraints),this._connection.addEventListener("iceconnectionstatechange",function(){"failed"===_this12._connection.iceConnectionState&&_this12.terminate({cause:JsSIP_C.causes.RTP_TIMEOUT,status_code:408,reason_phrase:JsSIP_C.causes.RTP_TIMEOUT})}),logger.debug('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(type,constraints){var _this13=this;if(logger.debug("createLocalDescription()"),"offer"!==type&&"answer"!==type)throw new Error('createLocalDescription() | invalid type "'.concat(type,'"'));var connection=this._connection;return this._rtcReady=!1,Promise.resolve().then(function(){return"offer"===type?connection.createOffer(constraints).catch(function(error){return logger.warn('emit "peerconnection:createofferfailed" [error:%o]',error),_this13.emit("peerconnection:createofferfailed",error),Promise.reject(error)}):connection.createAnswer(constraints).catch(function(error){return logger.warn('emit "peerconnection:createanswerfailed" [error:%o]',error),_this13.emit("peerconnection:createanswerfailed",error),Promise.reject(error)})}).then(function(desc){return connection.setLocalDescription(desc).catch(function(error){return _this13._rtcReady=!0,logger.warn('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',error),_this13.emit("peerconnection:setlocaldescriptionfailed",error),Promise.reject(error)})}).then(function(){var iceRestart=constraints&&constraints.iceRestart;return"complete"===connection.iceGatheringState&&!iceRestart||"gathering"===connection.iceGatheringState&&_this13._iceReady?(_this13._rtcReady=!0,iceRestart={originator:"local",type:type,sdp:connection.localDescription.sdp},logger.debug('emit "sdp"'),_this13.emit("sdp",iceRestart),Promise.resolve(iceRestart.sdp)):new Promise(function(resolve){function ready(){connection.removeEventListener("icecandidate",iceCandidateListener),connection.removeEventListener("icegatheringstatechange",iceGatheringStateListener),finished=!0,_this13._rtcReady=!0,_this13._iceReady=!0;var e={originator:"local",type:type,sdp:connection.localDescription.sdp};logger.debug('emit "sdp"'),_this13.emit("sdp",e),resolve(e.sdp)}var iceCandidateListener,iceGatheringStateListener,finished=!1;_this13._iceReady=!1;connection.addEventListener("icecandidate",iceCandidateListener=function(event){event=event.candidate;event?_this13.emit("icecandidate",{candidate:event,ready:ready}):finished||ready()}),connection.addEventListener("icegatheringstatechange",iceGatheringStateListener=function(){"complete"!==connection.iceGatheringState||finished||ready()})})})}},{key:"_createDialog",value:function(message,type,early){var local_tag="UAS"===type?message.to_tag:message.from_tag,remote_tag="UAS"===type?message.from_tag:message.to_tag,local_tag=message.call_id+local_tag+remote_tag,remote_tag=this._earlyDialogs[local_tag];return early?!!remote_tag||((remote_tag=new Dialog(this,message,type,Dialog.C.STATUS_EARLY)).error?(logger.debug(remote_tag.error),this._failed("remote",message,JsSIP_C.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[local_tag]=remote_tag,!0)):(this._from_tag=message.from_tag,this._to_tag=message.to_tag,remote_tag?(remote_tag.update(message,type),this._dialog=remote_tag,delete this._earlyDialogs[local_tag],!0):(early=new Dialog(this,message,type)).error?(logger.debug(early.error),this._failed("remote",message,JsSIP_C.causes.INTERNAL_ERROR),!1):(this._dialog=early,!0))}},{key:"_receiveReinvite",value:function(request){var _this14=this,contentType=(logger.debug("receiveReinvite()"),request.hasHeader("Content-Type")?request.getHeader("Content-Type").toLowerCase():void 0),data={request:request,callback:void 0,reject:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},status_code=(rejected=!0,options.status_code||403),reason_phrase=options.reason_phrase||"",options=Utils.cloneArray(options.extraHeaders);if(this._status!==C.STATUS_CONFIRMED)return!1;if(status_code<300||700<=status_code)throw new TypeError("Invalid status_code: ".concat(status_code));request.reply(status_code,reason_phrase,options)}.bind(this)},rejected=!1;function sendAnswer(desc){var _this15=this,extraHeaders=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(request,extraHeaders),this._late_sdp&&(desc=this._mangleOffer(desc)),request.reply(200,null,extraHeaders,desc,function(){_this15._status=C.STATUS_WAITING_FOR_ACK,_this15._setInvite2xxTimer(request,desc),_this15._setACKTimer()}),"function"==typeof data.callback&&data.callback()}this.emit("reinvite",data),rejected||(this._late_sdp=!1,request.body?"application/sdp"!==contentType?(logger.debug("invalid Content-Type"),request.reply(415)):this._processInDialogSdpOffer(request).then(function(desc){_this14._status!==C.STATUS_TERMINATED&&sendAnswer.call(_this14,desc)}).catch(function(error){logger.warn(error)}):(this._late_sdp=!0,this._remoteHold&&(this._remoteHold=!1,this._onunhold("remote")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this14._createLocalDescription("offer",_this14._rtcOfferConstraints)}).then(function(sdp){sendAnswer.call(_this14,sdp)}).catch(function(){request.reply(500)})))}},{key:"_receiveUpdate",value:function(request){var _this16=this,contentType=(logger.debug("receiveUpdate()"),request.hasHeader("Content-Type")?request.getHeader("Content-Type").toLowerCase():void 0),data={request:request,callback:void 0,reject:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},status_code=(rejected=!0,options.status_code||403),reason_phrase=options.reason_phrase||"",options=Utils.cloneArray(options.extraHeaders);if(this._status!==C.STATUS_CONFIRMED)return!1;if(status_code<300||700<=status_code)throw new TypeError("Invalid status_code: ".concat(status_code));request.reply(status_code,reason_phrase,options)}.bind(this)},rejected=!1;function sendAnswer(desc){var extraHeaders=["Contact: ".concat(this._contact)];this._handleSessionTimersInIncomingRequest(request,extraHeaders),request.reply(200,null,extraHeaders,desc),"function"==typeof data.callback&&data.callback()}this.emit("update",data),rejected||(request.body?"application/sdp"!==contentType?(logger.debug("invalid Content-Type"),request.reply(415)):this._processInDialogSdpOffer(request).then(function(desc){_this16._status!==C.STATUS_TERMINATED&&sendAnswer.call(_this16,desc)}).catch(function(error){logger.warn(error)}):sendAnswer.call(this,null))}},{key:"_processInDialogSdpOffer",value:function(request){var _step4,_this17=this,sdp=(logger.debug("_processInDialogSdpOffer()"),request.parseSDP()),hold=!1,_iterator4=_createForOfIteratorHelper(sdp.media);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var m=_step4.value;if(-1!==holdMediaTypes.indexOf(m.type)){var direction=m.direction||sdp.direction||"sendrecv";if("sendonly"!==direction&&"inactive"!==direction){hold=!1;break}hold=!0}}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}var e={originator:"remote",type:"offer",sdp:request.body},offer=(logger.debug('emit "sdp"'),this.emit("sdp",e),new RTCSessionDescription({type:"offer",sdp:e.sdp}));return this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(_this17._status===C.STATUS_TERMINATED)throw new Error("terminated");return _this17._connection.setRemoteDescription(offer).catch(function(error){throw request.reply(488),logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this17.emit("peerconnection:setremotedescriptionfailed",error),error})}).then(function(){if(_this17._status===C.STATUS_TERMINATED)throw new Error("terminated");!0===_this17._remoteHold&&!1===hold?(_this17._remoteHold=!1,_this17._onunhold("remote")):!1===_this17._remoteHold&&!0===hold&&(_this17._remoteHold=!0,_this17._onhold("remote"))}).then(function(){if(_this17._status===C.STATUS_TERMINATED)throw new Error("terminated");return _this17._createLocalDescription("answer",_this17._rtcAnswerConstraints).catch(function(error){throw request.reply(500),logger.warn('emit "peerconnection:createtelocaldescriptionfailed" [error:%o]',error),error})}).catch(function(error){logger.warn("_processInDialogSdpOffer() failed [error: %o]",error)}),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(request){var notifier,_this18=this;logger.debug("receiveRefer()"),request.refer_to?request.refer_to.uri.scheme!==JsSIP_C.SIP?(logger.debug("Refer-To header field points to a non-SIP URI scheme"),request.reply(416)):(request.reply(202),notifier=new RTCSession_ReferNotifier(this,request.cseq),logger.debug('emit "refer"'),this.emit("refer",{request:request,accept:function(initCallback,options){!function(initCallback){var options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(initCallback="function"==typeof initCallback?initCallback:null,this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_CONFIRMED)return!1;var session=new RTCSession(this._ua);{var replaces;session.on("progress",function(_ref2){_ref2=_ref2.response;notifier.notify(_ref2.status_code,_ref2.reason_phrase)}),session.on("accepted",function(_ref3){_ref3=_ref3.response;notifier.notify(_ref3.status_code,_ref3.reason_phrase)}),session.on("_failed",function(_ref4){var message=_ref4.message,_ref4=_ref4.cause;message?notifier.notify(message.status_code,message.reason_phrase):notifier.notify(487,_ref4)}),request.refer_to.uri.hasHeader("replaces")&&(replaces=decodeURIComponent(request.refer_to.uri.getHeader("replaces")),options.extraHeaders=Utils.cloneArray(options.extraHeaders),options.extraHeaders.push("Replaces: ".concat(replaces)))}session.connect(request.refer_to.uri.toAor(),options,initCallback)}.call(_this18,initCallback,options)},reject:function(){!function(){notifier.notify(603)}.call(_this18)}})):(logger.debug("no Refer-To header field present in REFER"),request.reply(400))}},{key:"_receiveNotify",value:function(request){if(logger.debug("receiveNotify()"),request.event||request.reply(400),"refer"===request.event.event){var id;if(request.event.params&&request.event.params.id)id=request.event.params.id,id=this._referSubscribers[id];else{if(1!==Object.keys(this._referSubscribers).length)return void request.reply(400,"Missing event id parameter");id=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}id?(id.receiveNotify(request),request.reply(200)):request.reply(481,"Subscription does not exist")}else request.reply(489)}},{key:"_receiveReplaces",value:function(request){var _this20=this;logger.debug("receiveReplaces()"),this.emit("replaces",{request:request,accept:function(initCallback){!function(initCallback){var _this19=this;if(this._status!==C.STATUS_WAITING_FOR_ACK&&this._status!==C.STATUS_CONFIRMED)return!1;var session=new RTCSession(this._ua);session.on("confirmed",function(){_this19.terminate()}),session.init_incoming(request,initCallback)}.call(_this20,initCallback)},reject:function(){!function(){logger.debug("Replaced INVITE rejected by the user"),request.reply(486)}.call(_this20)}})}},{key:"_sendInitialRequest",value:function(mediaConstraints,rtcOfferConstraints,mediaStream){var _this21=this,request_sender=new RequestSender(this._ua,this._request,{onRequestTimeout:function(){_this21.onRequestTimeout()},onTransportError:function(){_this21.onTransportError()},onAuthenticated:function(request){_this21._request=request},onReceiveResponse:function(response){_this21._receiveInviteResponse(response)}});Promise.resolve().then(function(){return mediaStream||(mediaConstraints.audio||mediaConstraints.video?(_this21._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(mediaConstraints).catch(function(error){if(_this21._status===C.STATUS_TERMINATED)throw new Error("terminated");throw _this21._failed("local",null,JsSIP_C.causes.USER_DENIED_MEDIA_ACCESS),logger.warn('emit "getusermediafailed" [error:%o]',error),_this21.emit("getusermediafailed",error),error})):void 0)}).then(function(stream){if(_this21._status===C.STATUS_TERMINATED)throw new Error("terminated");return(_this21._localMediaStream=stream)&&stream.getTracks().forEach(function(track){_this21._connection.addTrack(track,stream)}),_this21._connecting(_this21._request),_this21._createLocalDescription("offer",rtcOfferConstraints).catch(function(error){throw _this21._failed("local",null,JsSIP_C.causes.WEBRTC_ERROR),error})}).then(function(desc){if(_this21._is_canceled||_this21._status===C.STATUS_TERMINATED)throw new Error("terminated");_this21._request.body=desc,_this21._status=C.STATUS_INVITE_SENT,logger.debug('emit "sending" [request:%o]',_this21._request),_this21.emit("sending",{request:_this21._request}),request_sender.send()}).catch(function(error){_this21._status!==C.STATUS_TERMINATED&&logger.warn(error)})}},{key:"_getDTMFRTPSender",value:function(){var sender=this._connection.getSenders().find(function(rtpSender){return rtpSender.track&&"audio"===rtpSender.track.kind});if(sender&&sender.dtmf)return sender.dtmf;logger.warn("sendDTMF() | no local audio track to send DTMF with")}},{key:"_receiveInviteResponse",value:function(response){var dialog,answer,_answer,_this22=this;if(logger.debug("receiveInviteResponse()"),this._dialog&&200<=response.status_code&&response.status_code<=299)return this._dialog.id.call_id===response.call_id&&this._dialog.id.local_tag===response.from_tag&&this._dialog.id.remote_tag===response.to_tag?void this.sendRequest(JsSIP_C.ACK):void 0!==(dialog=new Dialog(this,response,"UAC")).error?void logger.debug(dialog.error):(this.sendRequest(JsSIP_C.ACK),void this.sendRequest(JsSIP_C.BYE));if(this._is_canceled)100<=response.status_code&&response.status_code<200?this._request.cancel(this._cancel_reason):200<=response.status_code&&response.status_code<299&&this._acceptAndTerminate(response);else if(this._status===C.STATUS_INVITE_SENT||this._status===C.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(response.status_code):this._status=C.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(response.status_code):response.to_tag?response.hasHeader("contact")&&!this._createDialog(response,"UAC",!0)||(this._status=C.STATUS_1XX_RECEIVED,response.body?(e={originator:"remote",type:"answer",sdp:response.body},logger.debug('emit "sdp"'),this.emit("sdp",e),answer=new RTCSessionDescription({type:"answer",sdp:e.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this22._connection.setRemoteDescription(answer)}).then(function(){return _this22._progress("remote",response)}).catch(function(error){logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this22.emit("peerconnection:setremotedescriptionfailed",error)})):this._progress("remote",response)):logger.debug("1xx response received without to tag");break;case/^2[0-9]{2}$/.test(response.status_code):(this._status=C.STATUS_CONFIRMED,response.body)?this._createDialog(response,"UAC")&&(e={originator:"remote",type:"answer",sdp:response.body},logger.debug('emit "sdp"'),this.emit("sdp",e),_answer=new RTCSessionDescription({type:"answer",sdp:e.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if("stable"===_this22._connection.signalingState)return _this22._connection.createOffer(_this22._rtcOfferConstraints).then(function(offer){return _this22._connection.setLocalDescription(offer)}).catch(function(error){_this22._acceptAndTerminate(response,500,error.toString()),_this22._failed("local",response,JsSIP_C.causes.WEBRTC_ERROR)})}).then(function(){_this22._connection.setRemoteDescription(_answer).then(function(){_this22._handleSessionTimersInIncomingResponse(response),_this22._accepted("remote",response),_this22.sendRequest(JsSIP_C.ACK),_this22._confirmed("local",null)}).catch(function(error){_this22._acceptAndTerminate(response,488,"Not Acceptable Here"),_this22._failed("remote",response,JsSIP_C.causes.BAD_MEDIA_DESCRIPTION+" error: "+error.message+"\r\n"+error.stack),logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this22.emit("peerconnection:setremotedescriptionfailed",error)})})):(this._acceptAndTerminate(response,400,JsSIP_C.causes.MISSING_SDP),this._failed("remote",response,JsSIP_C.causes.BAD_MEDIA_DESCRIPTION+" error: "+error.message+"\r\n"+error.stack));break;default:var e=Utils.sipErrorCause(response.status_code);this._failed("remote",response,e)}}},{key:"_sendReinvite",value:function(){var _this23=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},extraHeaders=(logger.debug("sendReinvite()"),Utils.cloneArray(options.extraHeaders)),eventHandlers=Utils.cloneObject(options.eventHandlers),rtcOfferConstraints=options.rtcOfferConstraints||this._rtcOfferConstraints||null,succeeded=!1;function onFailed(response){eventHandlers.failed&&eventHandlers.failed(response)}extraHeaders.push("Contact: ".concat(this._contact)),extraHeaders.push("Content-Type: application/sdp"),this._sessionTimers.running&&extraHeaders.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this23._createLocalDescription("offer",rtcOfferConstraints)}).then(function(sdp){var e={originator:"local",type:"offer",sdp:sdp=_this23._mangleOffer(sdp)};logger.debug('emit "sdp"'),_this23.emit("sdp",e),_this23.sendRequest(JsSIP_C.INVITE,{extraHeaders:extraHeaders,body:sdp,eventHandlers:{onSuccessResponse:function(response){!function(response){var e,answer,_this24=this;this._status===C.STATUS_TERMINATED||(this.sendRequest(JsSIP_C.ACK),succeeded)||(this._handleSessionTimersInIncomingResponse(response),response.body&&response.hasHeader("Content-Type")&&"application/sdp"===response.getHeader("Content-Type").toLowerCase()?(e={originator:"remote",type:"answer",sdp:response.body},logger.debug('emit "sdp"'),this.emit("sdp",e),answer=new RTCSessionDescription({type:"answer",sdp:e.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this24._connection.setRemoteDescription(answer)}).then(function(){eventHandlers.succeeded&&eventHandlers.succeeded(response)}).catch(function(error){onFailed.call(_this24),logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this24.emit("peerconnection:setremotedescriptionfailed",error)})):onFailed.call(this))}.call(_this23,response),succeeded=!0},onErrorResponse:function(response){onFailed.call(_this23,response)},onTransportError:function(){_this23.onTransportError()},onRequestTimeout:function(){_this23.onRequestTimeout()},onDialogError:function(){_this23.onDialogError()}}})}).catch(function(){onFailed()})}},{key:"_sendUpdate",value:function(){var _this25=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},extraHeaders=(logger.debug("sendUpdate()"),Utils.cloneArray(options.extraHeaders)),eventHandlers=Utils.cloneObject(options.eventHandlers),rtcOfferConstraints=options.rtcOfferConstraints||this._rtcOfferConstraints||null,sdpOffer=options.sdpOffer||!1,succeeded=!1;function onSucceeded(response){var e,answer,_this26=this;this._status===C.STATUS_TERMINATED||succeeded||(this._handleSessionTimersInIncomingResponse(response),sdpOffer?response.body&&response.hasHeader("Content-Type")&&"application/sdp"===response.getHeader("Content-Type").toLowerCase()?(e={originator:"remote",type:"answer",sdp:response.body},logger.debug('emit "sdp"'),this.emit("sdp",e),answer=new RTCSessionDescription({type:"answer",sdp:e.sdp}),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this26._connection.setRemoteDescription(answer)}).then(function(){eventHandlers.succeeded&&eventHandlers.succeeded(response)}).catch(function(error){onFailed.call(_this26),logger.warn('emit "peerconnection:setremotedescriptionfailed" [error:%o]',error),_this26.emit("peerconnection:setremotedescriptionfailed",error)})):onFailed.call(this):eventHandlers.succeeded&&eventHandlers.succeeded(response))}function onFailed(response){eventHandlers.failed&&eventHandlers.failed(response)}extraHeaders.push("Contact: ".concat(this._contact)),this._sessionTimers.running&&extraHeaders.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(this._sessionTimers.refresher?"uac":"uas")),sdpOffer?(extraHeaders.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return _this25._createLocalDescription("offer",rtcOfferConstraints)}).then(function(sdp){var e={originator:"local",type:"offer",sdp:sdp=_this25._mangleOffer(sdp)};logger.debug('emit "sdp"'),_this25.emit("sdp",e),_this25.sendRequest(JsSIP_C.UPDATE,{extraHeaders:extraHeaders,body:sdp,eventHandlers:{onSuccessResponse:function(response){onSucceeded.call(_this25,response),succeeded=!0},onErrorResponse:function(response){onFailed.call(_this25,response)},onTransportError:function(){_this25.onTransportError()},onRequestTimeout:function(){_this25.onRequestTimeout()},onDialogError:function(){_this25.onDialogError()}}})}).catch(function(){onFailed.call(_this25)})):this.sendRequest(JsSIP_C.UPDATE,{extraHeaders:extraHeaders,eventHandlers:{onSuccessResponse:function(response){onSucceeded.call(_this25,response)},onErrorResponse:function(response){onFailed.call(_this25,response)},onTransportError:function(){_this25.onTransportError()},onRequestTimeout:function(){_this25.onRequestTimeout()},onDialogError:function(){_this25.onDialogError()}}})}},{key:"_acceptAndTerminate",value:function(response,status_code,reason_phrase){logger.debug("acceptAndTerminate()");var extraHeaders=[];status_code&&(reason_phrase=reason_phrase||JsSIP_C.REASON_PHRASE[status_code]||"",extraHeaders.push("Reason: SIP ;cause=".concat(status_code,'; text="').concat(reason_phrase,'"'))),(this._dialog||this._createDialog(response,"UAC"))&&(this.sendRequest(JsSIP_C.ACK),this.sendRequest(JsSIP_C.BYE,{extraHeaders:extraHeaders})),this._status=C.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(sdp){if(!this._localHold&&!this._remoteHold)return sdp;if(sdp=sdp_transform.parse(sdp),this._localHold&&!this._remoteHold){logger.debug("mangleOffer() | me on hold, mangling offer");var _step5,_iterator5=_createForOfIteratorHelper(sdp.media);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var m=_step5.value;-1!==holdMediaTypes.indexOf(m.type)&&(!m.direction||"sendrecv"===m.direction?m.direction="sendonly":"recvonly"===m.direction&&(m.direction="inactive"))}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}else if(this._localHold&&this._remoteHold){logger.debug("mangleOffer() | both on hold, mangling offer");var _step6,_iterator6=_createForOfIteratorHelper(sdp.media);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var _m=_step6.value;-1!==holdMediaTypes.indexOf(_m.type)&&(_m.direction="inactive")}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}}else if(this._remoteHold){logger.debug("mangleOffer() | remote on hold, mangling offer");var _step7,_iterator7=_createForOfIteratorHelper(sdp.media);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var _m2=_step7.value;-1!==holdMediaTypes.indexOf(_m2.type)&&(!_m2.direction||"sendrecv"===_m2.direction?_m2.direction="recvonly":"recvonly"===_m2.direction&&(_m2.direction="inactive"))}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}}return sdp_transform.write(sdp)}},{key:"_setLocalMediaStatus",value:function(){var enableAudio=!0,enableVideo=!0;(this._localHold||this._remoteHold)&&(enableVideo=enableAudio=!1),this._audioMuted&&(enableAudio=!1),this._videoMuted&&(enableVideo=!1),this._toggleMuteAudio(!enableAudio),this._toggleMuteVideo(!enableVideo)}},{key:"_handleSessionTimersInIncomingRequest",value:function(request,responseExtraHeaders){this._sessionTimers.enabled&&(request=request.session_expires&&request.session_expires>=JsSIP_C.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=request.session_expires,request.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,"uas"),responseExtraHeaders.push("Session-Expires: ".concat(this._sessionTimers.currentExpires,";refresher=").concat(request)),this._sessionTimers.refresher="uas"===request,this._runSessionTimer())}},{key:"_handleSessionTimersInIncomingResponse",value:function(response){this._sessionTimers.enabled&&(response=response.session_expires&&response.session_expires>=JsSIP_C.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=response.session_expires,response.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,"uac"),this._sessionTimers.refresher="uac"===response,this._runSessionTimer())}},{key:"_runSessionTimer",value:function(){var _this27=this,expires=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(function(){_this27._status!==C.STATUS_TERMINATED&&_this27._isReadyToReOffer()&&(logger.debug("runSessionTimer() | sending session refresh request"),_this27._sessionTimers.refreshMethod===JsSIP_C.UPDATE?_this27._sendUpdate():_this27._sendReinvite())},500*expires):this._sessionTimers.timer=setTimeout(function(){_this27._status!==C.STATUS_TERMINATED&&(logger.warn("runSessionTimer() | timer expired, terminating the session"),_this27.terminate({cause:JsSIP_C.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*expires)}},{key:"_toggleMuteAudio",value:function(mute){var _step8,_iterator8=_createForOfIteratorHelper(this._connection.getSenders().filter(function(sender){return sender.track&&"audio"===sender.track.kind}));try{for(_iterator8.s();!(_step8=_iterator8.n()).done;)_step8.value.track.enabled=!mute}catch(err){_iterator8.e(err)}finally{_iterator8.f()}}},{key:"_toggleMuteVideo",value:function(mute){var _step9,_iterator9=_createForOfIteratorHelper(this._connection.getSenders().filter(function(sender){return sender.track&&"video"===sender.track.kind}));try{for(_iterator9.s();!(_step9=_iterator9.n()).done;)_step9.value.track.enabled=!mute}catch(err){_iterator9.e(err)}finally{_iterator9.f()}}},{key:"_newRTCSession",value:function(originator,request){logger.debug("newRTCSession()"),this._ua.newRTCSession(this,{originator:originator,session:this,request:request})}},{key:"_connecting",value:function(request){logger.debug("session connecting"),logger.debug('emit "connecting"'),this.emit("connecting",{request:request})}},{key:"_progress",value:function(originator,response){logger.debug("session progress"),logger.debug('emit "progress"'),this.emit("progress",{originator:originator,response:response||null})}},{key:"_accepted",value:function(originator,message){logger.debug("session accepted"),this._start_time=new Date,logger.debug('emit "accepted"'),this.emit("accepted",{originator:originator,response:message||null})}},{key:"_confirmed",value:function(originator,ack){logger.debug("session confirmed"),this._is_confirmed=!0,logger.debug('emit "confirmed"'),this.emit("confirmed",{originator:originator,ack:ack||null})}},{key:"_ended",value:function(originator,message,cause){logger.debug("session ended"),this._end_time=new Date,this._close(),logger.debug('emit "ended"'),this.emit("ended",{originator:originator,message:message||null,cause:cause})}},{key:"_failed",value:function(originator,message,cause){logger.debug("session failed"),logger.debug('emit "_failed"'),this.emit("_failed",{originator:originator,message:message||null,cause:cause}),this._close(),logger.debug('emit "failed"'),this.emit("failed",{originator:originator,message:message||null,cause:cause})}},{key:"_onhold",value:function(originator){logger.debug("session onhold"),this._setLocalMediaStatus(),logger.debug('emit "hold"'),this.emit("hold",{originator:originator})}},{key:"_onunhold",value:function(originator){logger.debug("session onunhold"),this._setLocalMediaStatus(),logger.debug('emit "unhold"'),this.emit("unhold",{originator:originator})}},{key:"_onmute",value:function(_ref5){var audio=_ref5.audio,_ref5=_ref5.video;logger.debug("session onmute"),this._setLocalMediaStatus(),logger.debug('emit "muted"'),this.emit("muted",{audio:audio,video:_ref5})}},{key:"_onunmute",value:function(_ref6){var audio=_ref6.audio,_ref6=_ref6.video;logger.debug("session onunmute"),this._setLocalMediaStatus(),logger.debug('emit "unmuted"'),this.emit("unmuted",{audio:audio,video:_ref6})}},{key:"C",get:function(){return C}},{key:"causes",get:function(){return JsSIP_C.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(_data){this._data=_data}},{key:"status",get:function(){return this._status}}]),RTCSession}()},{"./Constants":2,"./Dialog":3,"./Exceptions":6,"./Logger":9,"./RTCSession/DTMF":15,"./RTCSession/Info":16,"./RTCSession/ReferNotifier":17,"./RTCSession/ReferSubscriber":18,"./RequestSender":20,"./SIPMessage":21,"./Timers":23,"./Transactions":24,"./URI":27,"./Utils":28,events:31,"sdp-transform":37}],15:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,Logger=require("../Logger"),JsSIP_C=require("../Constants"),Exceptions=require("../Exceptions"),Utils=require("../Utils"),logger=new Logger("RTCSession:DTMF"),C={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};module.exports=function(){var subClass=DTMF,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var staticProps,_super=_createSuper(DTMF);function DTMF(session){var _this;if(this instanceof DTMF)return(_this=_super.call(this))._session=session,_this._direction=null,_this._tone=null,_this._duration=null,_this._request=null,_this;throw new TypeError("Cannot call a class as a function")}return subClass=DTMF,(superClass=[{key:"send",value:function(tone){var _this2=this,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===tone)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new Exceptions.InvalidStateError(this._session.status);var extraHeaders=Utils.cloneArray(options.extraHeaders);if(this.eventHandlers=Utils.cloneObject(options.eventHandlers),"string"==typeof tone)tone=tone.toUpperCase();else{if("number"!=typeof tone)throw new TypeError("Invalid tone: ".concat(tone));tone=tone.toString()}if(!tone.match(/^[0-9A-DR#*]$/))throw new TypeError("Invalid tone: ".concat(tone));this._tone=tone,this._duration=options.duration,extraHeaders.push("Content-Type: application/dtmf-relay");tone="Signal=".concat(this._tone,"\r\n");tone+="Duration=".concat(this._duration),this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(JsSIP_C.INFO,{extraHeaders:extraHeaders,eventHandlers:{onSuccessResponse:function(response){_this2.emit("succeeded",{originator:"remote",response:response})},onErrorResponse:function(response){_this2.eventHandlers.onFailed&&_this2.eventHandlers.onFailed(),_this2.emit("failed",{originator:"remote",response:response})},onRequestTimeout:function(){_this2._session.onRequestTimeout()},onTransportError:function(){_this2._session.onTransportError()},onDialogError:function(){_this2._session.onDialogError()}},body:tone})}},{key:"init_incoming",value:function(request){var body,reg_tone=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,reg_duration=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this._direction="incoming",(this._request=request).reply(200),request.body&&(1<=(body=request.body.split("\n")).length&&reg_tone.test(body[0])&&(this._tone=body[0].replace(reg_tone,"$2")),2<=body.length)&&reg_duration.test(body[1])&&(this._duration=parseInt(body[1].replace(reg_duration,"$2"),10)),this._duration||(this._duration=C.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:request}):logger.debug("invalid INFO DTMF received, discarded")}},{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}}])&&_defineProperties(subClass.prototype,superClass),staticProps&&_defineProperties(subClass,staticProps),DTMF}(),module.exports.C=C},{"../Constants":2,"../Exceptions":6,"../Logger":9,"../Utils":28,events:31}],16:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,JsSIP_C=require("../Constants"),Exceptions=require("../Exceptions"),Utils=require("../Utils");module.exports=function(){var subClass=Info,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var staticProps,_super=_createSuper(Info);function Info(session){var _this;if(this instanceof Info)return(_this=_super.call(this))._session=session,_this._direction=null,_this._contentType=null,_this._body=null,_this;throw new TypeError("Cannot call a class as a function")}return subClass=Info,(superClass=[{key:"send",value:function(contentType,body){var _this2=this,options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this._direction="outgoing",void 0===contentType)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new Exceptions.InvalidStateError(this._session.status);this._contentType=contentType,this._body=body;options=Utils.cloneArray(options.extraHeaders);options.push("Content-Type: ".concat(contentType)),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(JsSIP_C.INFO,{extraHeaders:options,eventHandlers:{onSuccessResponse:function(response){_this2.emit("succeeded",{originator:"remote",response:response})},onErrorResponse:function(response){_this2.emit("failed",{originator:"remote",response:response})},onTransportError:function(){_this2._session.onTransportError()},onRequestTimeout:function(){_this2._session.onRequestTimeout()},onDialogError:function(){_this2._session.onDialogError()}},body:body})}},{key:"init_incoming",value:function(request){this._direction="incoming",(this.request=request).reply(200),this._contentType=request.hasHeader("Content-Type")?request.getHeader("Content-Type").toLowerCase():void 0,this._body=request.body,this._session.newInfo({originator:"remote",info:this,request:request})}},{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}}])&&_defineProperties(subClass.prototype,superClass),staticProps&&_defineProperties(subClass,staticProps),Info}()},{"../Constants":2,"../Exceptions":6,"../Utils":28,events:31}],17:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Logger=require("../Logger"),JsSIP_C=require("../Constants"),logger=new Logger("RTCSession:ReferNotifier"),C_event_type="refer",C_body_type="message/sipfrag;version=2.0",C_expires=300;module.exports=function(){function ReferNotifier(session,id,expires){if(!(this instanceof ReferNotifier))throw new TypeError("Cannot call a class as a function");this._session=session,this._id=id,this._expires=expires||C_expires,this._active=!0,this.notify(100)}var Constructor,protoProps,staticProps;return Constructor=ReferNotifier,(protoProps=[{key:"notify",value:function(code,reason){var state;logger.debug("notify()"),!1!==this._active&&(reason=reason||JsSIP_C.REASON_PHRASE[code]||"",state=200<=code?"terminated;reason=noresource":"active;expires=".concat(this._expires),this._session.sendRequest(JsSIP_C.NOTIFY,{extraHeaders:["Event: ".concat(C_event_type,";id=").concat(this._id),"Subscription-State: ".concat(state),"Content-Type: ".concat(C_body_type)],body:"SIP/2.0 ".concat(code," ").concat(reason),eventHandlers:{onErrorResponse:function(){this._active=!1}}}))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),ReferNotifier}()},{"../Constants":2,"../Logger":9}],18:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,Logger=require("../Logger"),JsSIP_C=require("../Constants"),Grammar=require("../Grammar"),Utils=require("../Utils"),logger=new Logger("RTCSession:ReferSubscriber");module.exports=function(){var subClass=ReferSubscriber,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var staticProps,_super=_createSuper(ReferSubscriber);function ReferSubscriber(session){var _this;if(this instanceof ReferSubscriber)return(_this=_super.call(this))._id=null,_this._session=session,_this;throw new TypeError("Cannot call a class as a function")}return subClass=ReferSubscriber,(superClass=[{key:"sendRefer",value:function(target){var event,_this2=this,options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},extraHeaders=(logger.debug("sendRefer()"),Utils.cloneArray(options.extraHeaders)),eventHandlers=Utils.cloneObject(options.eventHandlers);for(event in eventHandlers)Object.prototype.hasOwnProperty.call(eventHandlers,event)&&this.on(event,eventHandlers[event]);var replaces=null,options=(options.replaces&&(replaces=options.replaces._request.call_id,replaces=(replaces+=";to-tag=".concat(options.replaces._to_tag))+";from-tag=".concat(options.replaces._from_tag),replaces=encodeURIComponent(replaces)),"Refer-To: <".concat(target).concat(replaces?"?Replaces=".concat(replaces):"",">")),replaces=(extraHeaders.push(options),extraHeaders.some(function(header){return header.toLowerCase().startsWith("referred-by:")})||(target="Referred-By: <".concat(this._session._ua._configuration.uri._scheme,":").concat(this._session._ua._configuration.uri._user,"@").concat(this._session._ua._configuration.uri._host,">"),extraHeaders.push(target)),extraHeaders.push("Contact: ".concat(this._session.contact)),this._session.sendRequest(JsSIP_C.REFER,{extraHeaders:extraHeaders,eventHandlers:{onSuccessResponse:function(response){_this2._requestSucceeded(response)},onErrorResponse:function(response){_this2._requestFailed(response,JsSIP_C.causes.REJECTED)},onTransportError:function(){_this2._requestFailed(null,JsSIP_C.causes.CONNECTION_ERROR)},onRequestTimeout:function(){_this2._requestFailed(null,JsSIP_C.causes.REQUEST_TIMEOUT)},onDialogError:function(){_this2._requestFailed(null,JsSIP_C.causes.DIALOG_ERROR)}}}));this._id=replaces.cseq}},{key:"receiveNotify",value:function(request){if(logger.debug("receiveNotify()"),request.body){var status_line=Grammar.parse(request.body.trim().split("\r\n",1)[0],"Status_Line");if(-1===status_line)logger.debug('receiveNotify() | error parsing NOTIFY body: "'.concat(request.body,'"'));else switch(!0){case/^100$/.test(status_line.status_code):this.emit("trying",{request:request,status_line:status_line});break;case/^1[0-9]{2}$/.test(status_line.status_code):this.emit("progress",{request:request,status_line:status_line});break;case/^2[0-9]{2}$/.test(status_line.status_code):this.emit("accepted",{request:request,status_line:status_line});break;default:this.emit("failed",{request:request,status_line:status_line})}}}},{key:"_requestSucceeded",value:function(response){logger.debug("REFER succeeded"),logger.debug('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:response})}},{key:"_requestFailed",value:function(response,cause){logger.debug("REFER failed"),logger.debug('emit "requestFailed"'),this.emit("requestFailed",{response:response||null,cause:cause})}},{key:"id",get:function(){return this._id}}])&&_defineProperties(subClass.prototype,superClass),staticProps&&_defineProperties(subClass,staticProps),ReferSubscriber}()},{"../Constants":2,"../Grammar":7,"../Logger":9,"../Utils":28,events:31}],19:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Logger=require("./Logger"),Utils=require("./Utils"),JsSIP_C=require("./Constants"),SIPMessage=require("./SIPMessage"),RequestSender=require("./RequestSender"),logger=new Logger("Registrator");module.exports=function(){function Registrator(ua,transport){if(!(this instanceof Registrator))throw new TypeError("Cannot call a class as a function");this._reg_id=1,this._ua=ua,this._transport=transport,this._registrar=ua.configuration.registrar_server,this._expires=ua.configuration.register_expires,this._call_id=Utils.createRandomToken(22),this._cseq=0,this._to_uri=ua.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._sipInstance='"<urn:uuid:'.concat(this._ua.configuration.instance_id,'>"'),this._contact+=";reg-id=".concat(this._reg_id),this._contact+=";+sip.instance=".concat(this._sipInstance)}var Constructor,protoProps,staticProps;return Constructor=Registrator,(protoProps=[{key:"setExtraHeaders",value:function(extraHeaders){Array.isArray(extraHeaders)||(extraHeaders=[]),this._extraHeaders=extraHeaders.slice()}},{key:"setExtraContactParams",value:function(extraContactParams){for(var param_key in extraContactParams instanceof Object||(extraContactParams={}),this._extraContactParams="",extraContactParams){var param_value;Object.prototype.hasOwnProperty.call(extraContactParams,param_key)&&(param_value=extraContactParams[param_key],this._extraContactParams+=";".concat(param_key),param_value)&&(this._extraContactParams+="=".concat(param_value))}}},{key:"register",value:function(){var extraHeaders,_this=this;this._registering?logger.debug("Register request in progress..."):((extraHeaders=this._extraHeaders.slice()).push("Contact: ".concat(this._contact,";expires=").concat(this._expires).concat(this._extraContactParams)),extraHeaders.push("Expires: ".concat(this._expires)),extraHeaders=new SIPMessage.OutgoingRequest(JsSIP_C.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},extraHeaders),extraHeaders=new RequestSender(this._ua,extraHeaders,{onRequestTimeout:function(){_this._registrationFailure(null,JsSIP_C.causes.REQUEST_TIMEOUT)},onTransportError:function(){_this._registrationFailure(null,JsSIP_C.causes.CONNECTION_ERROR)},onAuthenticated:function(){_this._cseq+=1},onReceiveResponse:function(response){if(response.cseq===_this._cseq)switch(null!==_this._registrationTimer&&(clearTimeout(_this._registrationTimer),_this._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):var contact;(_this._registering=!1,response.hasHeader("Contact"))?(contact=(contact=(contacts=response.headers.Contact.reduce(function(a,b){return a.concat(b.parsed)},[])).find(function(element){return _this._sipInstance===element.getParam("+sip.instance")&&_this._reg_id===parseInt(element.getParam("reg-id"))}))||contacts.find(function(element){return element.uri.user===_this._ua.contact.uri.user}))?(contacts=(contacts=!(contacts=contact.getParam("expires"))&&response.hasHeader("expires")?response.getHeader("expires"):contacts)||_this._expires,contacts=64<(contacts=(contacts=Number(contacts))<10?10:contacts)?1e3*contacts/2+Math.floor(1e3*(contacts/2-32)*Math.random()):1e3*contacts-5e3,_this._registrationTimer=setTimeout(function(){_this._registrationTimer=null,0===_this._ua.listeners("registrationExpiring").length?_this.register():_this._ua.emit("registrationExpiring")},contacts),contact.hasParam("temp-gruu")&&(_this._ua.contact.temp_gruu=contact.getParam("temp-gruu").replace(/"/g,"")),contact.hasParam("pub-gruu")&&(_this._ua.contact.pub_gruu=contact.getParam("pub-gruu").replace(/"/g,"")),_this._registered||(_this._registered=!0,_this._ua.registered({response:response}))):logger.debug("no Contact header pointing to us, response ignored"):logger.debug("no Contact header in response to REGISTER, response ignored");break;case/^423$/.test(response.status_code):response.hasHeader("min-expires")?(_this._expires=Number(response.getHeader("min-expires")),_this._expires<10&&(_this._expires=10),_this.register()):(logger.debug("423 response received for REGISTER without Min-Expires"),_this._registrationFailure(response,JsSIP_C.causes.SIP_FAILURE_CODE));break;default:var contacts=Utils.sipErrorCause(response.status_code);_this._registrationFailure(response,contacts)}}}),this._registering=!0,extraHeaders.send())}},{key:"unregister",value:function(){var extraHeaders,_this2=this,options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._registered?(this._registered=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),extraHeaders=this._extraHeaders.slice(),options.all?extraHeaders.push("Contact: *".concat(this._extraContactParams)):extraHeaders.push("Contact: ".concat(this._contact,";expires=0").concat(this._extraContactParams)),extraHeaders.push("Expires: 0"),options=new SIPMessage.OutgoingRequest(JsSIP_C.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},extraHeaders),new RequestSender(this._ua,options,{onRequestTimeout:function(){_this2._unregistered(null,JsSIP_C.causes.REQUEST_TIMEOUT)},onTransportError:function(){_this2._unregistered(null,JsSIP_C.causes.CONNECTION_ERROR)},onAuthenticated:function(){_this2._cseq+=1},onReceiveResponse:function(response){switch(!0){case/^1[0-9]{2}$/.test(response.status_code):break;case/^2[0-9]{2}$/.test(response.status_code):_this2._unregistered(response);break;default:var cause=Utils.sipErrorCause(response.status_code);_this2._unregistered(response,cause)}}}).send()):logger.debug("already unregistered")}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(response,cause){this._registering=!1,this._ua.registrationFailed({response:response||null,cause:cause}),this._registered&&(this._registered=!1,this._ua.unregistered({response:response||null,cause:cause}))}},{key:"_unregistered",value:function(response,cause){this._registering=!1,this._registered=!1,this._ua.unregistered({response:response||null,cause:cause||null})}},{key:"registered",get:function(){return this._registered}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Registrator}()},{"./Constants":2,"./Logger":9,"./RequestSender":20,"./SIPMessage":21,"./Utils":28}],20:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Logger=require("./Logger"),JsSIP_C=require("./Constants"),DigestAuthentication=require("./DigestAuthentication"),Transactions=require("./Transactions"),logger=new Logger("RequestSender"),EventHandlers={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}};module.exports=function(){function RequestSender(ua,request,eventHandlers){if(!(this instanceof RequestSender))throw new TypeError("Cannot call a class as a function");for(var handler in this._ua=ua,this._eventHandlers=eventHandlers,this._method=request.method,this._request=request,this._auth=null,this._challenged=!1,this._staled=!1,EventHandlers)!Object.prototype.hasOwnProperty.call(EventHandlers,handler)||this._eventHandlers[handler]||(this._eventHandlers[handler]=EventHandlers[handler]);ua.status!==ua.C.STATUS_USER_CLOSED||this._method===JsSIP_C.BYE&&this._method===JsSIP_C.ACK||this._eventHandlers.onTransportError()}var Constructor,protoProps,staticProps;return Constructor=RequestSender,(protoProps=[{key:"send",value:function(){var _this=this,eventHandlers={onRequestTimeout:function(){_this._eventHandlers.onRequestTimeout()},onTransportError:function(){_this._eventHandlers.onTransportError()},onReceiveResponse:function(response){_this._receiveResponse(response)}};switch(this._method){case"INVITE":this.clientTransaction=new Transactions.InviteClientTransaction(this._ua,this._ua.transport,this._request,eventHandlers);break;case"ACK":this.clientTransaction=new Transactions.AckClientTransaction(this._ua,this._ua.transport,this._request,eventHandlers);break;default:this.clientTransaction=new Transactions.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,eventHandlers)}this._ua._configuration.authorization_jwt&&this._request.setHeader("Authorization",this._ua._configuration.authorization_jwt),this.clientTransaction.send()}},{key:"_receiveResponse",value:function(response){var challenge,status_code=response.status_code;401!==status_code&&407!==status_code||null===this._ua.configuration.password&&null===this._ua.configuration.ha1?this._eventHandlers.onReceiveResponse(response):(status_code=401===response.status_code?(challenge=response.parseHeader("www-authenticate"),"authorization"):(challenge=response.parseHeader("proxy-authenticate"),"proxy-authorization"),challenge?(!this._challenged||!this._staled&&!0===challenge.stale)&&(this._auth||(this._auth=new DigestAuthentication({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),this._auth.authenticate(this._request,challenge))?(this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),challenge.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq","".concat(this._request.cseq," ").concat(this._method)),this._request.setHeader(status_code,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()):this._eventHandlers.onReceiveResponse(response):(logger.debug("".concat(response.status_code," with wrong or missing challenge, cannot authenticate")),this._eventHandlers.onReceiveResponse(response)))}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),RequestSender}()},{"./Constants":2,"./DigestAuthentication":5,"./Logger":9,"./Transactions":24}],21:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?function(self){if(void 0!==self)return self;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(Super):call}}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}var sdp_transform=require("sdp-transform"),Logger=require("./Logger"),JsSIP_C=require("./Constants"),Utils=require("./Utils"),NameAddrHeader=require("./NameAddrHeader"),Grammar=require("./Grammar"),logger=new Logger("SIPMessage"),OutgoingRequest=function(){function OutgoingRequest(method,ruri,ua,params,extraHeaders,body){if(_classCallCheck(this,OutgoingRequest),!method||!ruri||!ua)return null;params=params||{},this.ua=ua,this.headers={},this.method=method,this.ruri=ruri,this.body=body,this.extraHeaders=Utils.cloneArray(extraHeaders),this.ua.configuration.extra_headers&&(this.extraHeaders=this.extraHeaders.concat(this.ua.configuration.extra_headers)),params.route_set?this.setHeader("route",params.route_set):ua.configuration.use_preloaded_route&&this.setHeader("route","<".concat(ua.transport.sip_uri,";lr>")),this.setHeader("via",""),this.setHeader("max-forwards",JsSIP_C.MAX_FORWARDS);body=params.to_uri||ruri,extraHeaders=params.to_tag?{tag:params.to_tag}:null,ruri=void 0!==params.to_display_name?params.to_display_name:null,this.to=new NameAddrHeader(body,ruri,extraHeaders),this.setHeader("to",this.to.toString()),body=params.from_uri||ua.configuration.uri,ruri={tag:params.from_tag||Utils.newTag()},extraHeaders=void 0!==params.from_display_name?params.from_display_name:ua.configuration.display_name||null,this.from=new NameAddrHeader(body,extraHeaders,ruri),this.setHeader("from",this.from.toString()),body=params.call_id||ua.configuration.jssip_id+Utils.createRandomToken(15),this.call_id=body,this.setHeader("call-id",body),extraHeaders=params.cseq||Math.floor(1e4*Math.random());this.cseq=extraHeaders,this.setHeader("cseq","".concat(extraHeaders," ").concat(method))}return _createClass(OutgoingRequest,[{key:"setHeader",value:function(name,value){for(var regexp=new RegExp("^\\s*".concat(name,"\\s*:"),"i"),idx=0;idx<this.extraHeaders.length;idx++)regexp.test(this.extraHeaders[idx])&&this.extraHeaders.splice(idx,1);this.headers[Utils.headerize(name)]=Array.isArray(value)?value:[value]}},{key:"getHeader",value:function(name){var headers=this.headers[Utils.headerize(name)];if(headers){if(headers[0])return headers[0]}else{var _step,regexp=new RegExp("^\\s*".concat(name,"\\s*:"),"i"),_iterator=_createForOfIteratorHelper(this.extraHeaders);try{for(_iterator.s();!(_step=_iterator.n()).done;){var header=_step.value;if(regexp.test(header))return header.substring(header.indexOf(":")+1).trim()}}catch(err){_iterator.e(err)}finally{_iterator.f()}}}},{key:"getHeaders",value:function(name){var headers=this.headers[Utils.headerize(name)],result=[];if(headers){var _step2,_iterator2=_createForOfIteratorHelper(headers);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var header=_step2.value;result.push(header)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}else{var _step3,regexp=new RegExp("^\\s*".concat(name,"\\s*:"),"i"),_iterator3=_createForOfIteratorHelper(this.extraHeaders);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _header=_step3.value;regexp.test(_header)&&result.push(_header.substring(_header.indexOf(":")+1).trim())}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return result}},{key:"hasHeader",value:function(name){if(this.headers[Utils.headerize(name)])return!0;var _step4,regexp=new RegExp("^\\s*".concat(name,"\\s*:"),"i"),_iterator4=_createForOfIteratorHelper(this.extraHeaders);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var header=_step4.value;if(regexp.test(header))return!0}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return!1}},{key:"parseSDP",value:function(force){return!force&&this.sdp||(this.sdp=sdp_transform.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){var headerName,msg="".concat(this.method," ").concat(this.ruri," SIP/2.0\r\n");for(headerName in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,headerName)){var _step5,_iterator5=_createForOfIteratorHelper(this.headers[headerName]);try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var headerValue=_step5.value;msg+="".concat(headerName,": ").concat(headerValue,"\r\n")}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}}var _step6,_iterator6=_createForOfIteratorHelper(this.extraHeaders);try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var header=_step6.value;msg+="".concat(header.trim(),"\r\n")}}catch(err){_iterator6.e(err)}finally{_iterator6.f()}var supported=[];switch(this.method){case JsSIP_C.REGISTER:supported.push("path","gruu");break;case JsSIP_C.INVITE:this.ua.configuration.session_timers&&supported.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&supported.push("gruu"),supported.push("ice","replaces");break;case JsSIP_C.UPDATE:this.ua.configuration.session_timers&&supported.push("timer"),supported.push("ice")}supported.push("outbound");var userAgent=this.ua.configuration.user_agent||JsSIP_C.USER_AGENT;return msg=(msg=(msg+="Allow: ".concat(JsSIP_C.ALLOWED_METHODS,"\r\n"))+"Supported: ".concat(supported,"\r\n"))+"User-Agent: ".concat(userAgent,"\r\n"),this.body?(userAgent=Utils.str_utf8_length(this.body),msg=(msg+="Content-Length: ".concat(userAgent,"\r\n\r\n"))+this.body):msg+="Content-Length: 0\r\n\r\n",msg}},{key:"clone",value:function(){var request=new OutgoingRequest(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(name){request.headers[name]=this.headers[name].slice()},this),request.body=this.body,request.extraHeaders=Utils.cloneArray(this.extraHeaders),request.to=this.to,request.from=this.from,request.call_id=this.call_id,request.cseq=this.cseq,request}}]),OutgoingRequest}(),require=function(){_inherits(InitialOutgoingInviteRequest,OutgoingRequest);var _super=_createSuper(InitialOutgoingInviteRequest);function InitialOutgoingInviteRequest(ruri,ua,params,extraHeaders,body){return _classCallCheck(this,InitialOutgoingInviteRequest),(ruri=_super.call(this,JsSIP_C.INVITE,ruri,ua,params,extraHeaders,body)).transaction=null,ruri}return _createClass(InitialOutgoingInviteRequest,[{key:"cancel",value:function(reason){this.transaction.cancel(reason)}},{key:"clone",value:function(){var request=new InitialOutgoingInviteRequest(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(name){request.headers[name]=this.headers[name].slice()},this),request.body=this.body,request.extraHeaders=Utils.cloneArray(this.extraHeaders),request.to=this.to,request.from=this.from,request.call_id=this.call_id,request.cseq=this.cseq,request.transaction=this.transaction,request}}]),InitialOutgoingInviteRequest}(),IncomingMessage=function(){function IncomingMessage(){_classCallCheck(this,IncomingMessage),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}return _createClass(IncomingMessage,[{key:"addHeader",value:function(name,value){value={raw:value};name=Utils.headerize(name),this.headers[name]?this.headers[name].push(value):this.headers[name]=[value]}},{key:"getHeader",value:function(name){name=this.headers[Utils.headerize(name)];if(name&&name[0])return name[0].raw}},{key:"getHeaders",value:function(name){var name=this.headers[Utils.headerize(name)],result=[];if(!name)return[];var _step7,_iterator7=_createForOfIteratorHelper(name);try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var header=_step7.value;result.push(header.raw)}}catch(err){_iterator7.e(err)}finally{_iterator7.f()}return result}},{key:"hasHeader",value:function(name){return!!this.headers[Utils.headerize(name)]}},{key:"parseHeader",value:function(name){var header,value,parsed,idx=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(name=Utils.headerize(name),this.headers[name]){if(!(idx>=this.headers[name].length))return value=(header=this.headers[name][idx]).raw,header.parsed||(-1!==(parsed=Grammar.parse(value,name.replace(/-/g,"_")))?header.parsed=parsed:(this.headers[name].splice(idx,1),void logger.debug('error parsing "'.concat(name,'" header field with value "').concat(value,'"'))));logger.debug('not so many "'.concat(name,'" headers present'))}else logger.debug('header "'.concat(name,'" not present'))}},{key:"s",value:function(name,idx){return this.parseHeader(name,idx)}},{key:"setHeader",value:function(name,value){value={raw:value};this.headers[Utils.headerize(name)]=[value]}},{key:"parseSDP",value:function(force){return!force&&this.sdp||(this.sdp=sdp_transform.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){return this.data}}]),IncomingMessage}(),Logger=function(){_inherits(IncomingRequest,IncomingMessage);var _super2=_createSuper(IncomingRequest);function IncomingRequest(ua){var _this2;return _classCallCheck(this,IncomingRequest),(_this2=_super2.call(this)).ua=ua,_this2.headers={},_this2.ruri=null,_this2.transport=null,_this2.server_transaction=null,_this2}return _createClass(IncomingRequest,[{key:"reply",value:function(code,reason,extraHeaders,body,onSuccess,onFailure){var supported=[],to=this.getHeader("To");if(reason=reason||null,!(code=code||null)||code<100||699<code)throw new TypeError("Invalid status_code: ".concat(code));if(reason&&"string"!=typeof reason&&!(reason instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(reason));reason=reason||JsSIP_C.REASON_PHRASE[code]||"",extraHeaders=Utils.cloneArray(extraHeaders),this.ua.configuration.extra_headers&&(extraHeaders=extraHeaders.concat(this.ua.configuration.extra_headers));var response="SIP/2.0 ".concat(code," ").concat(reason,"\r\n");if(this.method===JsSIP_C.INVITE&&100<code&&code<=200){var _step8,_iterator8=_createForOfIteratorHelper(this.getHeaders("record-route"));try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var header=_step8.value;response+="Record-Route: ".concat(header,"\r\n")}}catch(err){_iterator8.e(err)}finally{_iterator8.f()}}var _step9,_iterator9=_createForOfIteratorHelper(this.getHeaders("via"));try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var via=_step9.value;response+="Via: ".concat(via,"\r\n")}}catch(err){_iterator9.e(err)}finally{_iterator9.f()}!this.to_tag&&100<code?to+=";tag=".concat(Utils.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(to+=";tag=".concat(this.to_tag)),response=(response=(response=(response+="To: ".concat(to,"\r\n"))+"From: ".concat(this.getHeader("From"),"\r\n"))+"Call-ID: ".concat(this.call_id,"\r\n"))+"CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n");var _step10,_iterator10=_createForOfIteratorHelper(extraHeaders);try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var _header2=_step10.value;response+="".concat(_header2.trim(),"\r\n")}}catch(err){_iterator10.e(err)}finally{_iterator10.f()}switch(this.method){case JsSIP_C.INVITE:this.ua.configuration.session_timers&&supported.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&supported.push("gruu"),supported.push("ice","replaces");break;case JsSIP_C.UPDATE:this.ua.configuration.session_timers&&supported.push("timer"),body&&supported.push("ice"),supported.push("replaces")}supported.push("outbound"),this.method===JsSIP_C.OPTIONS?response=(response+="Allow: ".concat(JsSIP_C.ALLOWED_METHODS,"\r\n"))+"Accept: ".concat(JsSIP_C.ACCEPTED_BODY_TYPES,"\r\n"):405===code?response+="Allow: ".concat(JsSIP_C.ALLOWED_METHODS,"\r\n"):415===code&&(response+="Accept: ".concat(JsSIP_C.ACCEPTED_BODY_TYPES,"\r\n")),response+="Supported: ".concat(supported,"\r\n"),body?(reason=Utils.str_utf8_length(body),response=(response+="Content-Type: application/sdp\r\n")+"Content-Length: ".concat(reason,"\r\n\r\n")+body):response+="Content-Length: ".concat(0,"\r\n\r\n"),this.server_transaction.receiveResponse(code,response,onSuccess,onFailure)}},{key:"reply_sl",value:function(){var code=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,reason=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,vias=this.getHeaders("via");if(!code||code<100||699<code)throw new TypeError("Invalid status_code: ".concat(code));if(reason&&"string"!=typeof reason&&!(reason instanceof String))throw new TypeError("Invalid reason_phrase: ".concat(reason));var _step11,reason=reason||JsSIP_C.REASON_PHRASE[code]||"",response="SIP/2.0 ".concat(code," ").concat(reason,"\r\n"),_iterator11=_createForOfIteratorHelper(vias);try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var via=_step11.value;response+="Via: ".concat(via,"\r\n")}}catch(err){_iterator11.e(err)}finally{_iterator11.f()}reason=this.getHeader("To");if(!this.to_tag&&100<code?reason+=";tag=".concat(Utils.newTag()):this.to_tag&&!this.s("to").hasParam("tag")&&(reason+=";tag=".concat(this.to_tag)),response=(response=(response=(response+="To: ".concat(reason,"\r\n"))+"From: ".concat(this.getHeader("From"),"\r\n"))+"Call-ID: ".concat(this.call_id,"\r\n"))+"CSeq: ".concat(this.cseq," ").concat(this.method,"\r\n"),this.ua.configuration.extra_headers){var _step12,_iterator12=_createForOfIteratorHelper(this.ua.configuration.extra_headers);try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var header=_step12.value;response+="".concat(header.trim(),"\r\n")}}catch(err){_iterator12.e(err)}finally{_iterator12.f()}}response+="Content-Length: ".concat(0,"\r\n\r\n"),this.transport.send(response)}}]),IncomingRequest}();module.exports={OutgoingRequest:OutgoingRequest,InitialOutgoingInviteRequest:require,IncomingRequest:Logger,IncomingResponse:function(){_inherits(IncomingResponse,IncomingMessage);var _super3=_createSuper(IncomingResponse);function IncomingResponse(){var _this3;return _classCallCheck(this,IncomingResponse),(_this3=_super3.call(this)).headers={},_this3.status_code=null,_this3.reason_phrase=null,_this3}return IncomingResponse}()}},{"./Constants":2,"./Grammar":7,"./Logger":9,"./NameAddrHeader":11,"./Utils":28,"sdp-transform":37}],22:[function(require,module,exports){"use strict";var Logger=require("./Logger"),Utils=require("./Utils"),Grammar=require("./Grammar"),logger=new Logger("Socket");exports.isSocket=function(socket){if(Array.isArray(socket))return!1;if(void 0===socket)return logger.warn("undefined JsSIP.Socket instance"),!1;try{if(!Utils.isString(socket.url))throw logger.warn("missing or invalid JsSIP.Socket url property"),new Error("Missing or invalid JsSIP.Socket url property");if(!Utils.isString(socket.via_transport))throw logger.warn("missing or invalid JsSIP.Socket via_transport property"),new Error("Missing or invalid JsSIP.Socket via_transport property");if(-1===Grammar.parse(socket.sip_uri,"SIP_URI"))throw logger.warn("missing or invalid JsSIP.Socket sip_uri property"),new Error("missing or invalid JsSIP.Socket sip_uri property")}catch(e){return!1}try{["connect","disconnect","send"].forEach(function(method){if(!Utils.isFunction(socket[method]))throw logger.warn("missing or invalid JsSIP.Socket method: ".concat(method)),new Error("Missing or invalid JsSIP.Socket method: ".concat(method))})}catch(e){return!1}return!0}},{"./Grammar":7,"./Logger":9,"./Utils":28}],23:[function(require,module,exports){"use strict";var T1=500;module.exports={T1:T1,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4}},{}],24:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(Super):call}}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,Logger=require("./Logger"),JsSIP_C=require("./Constants"),SIPMessage=require("./SIPMessage"),Timers=require("./Timers"),loggernict=new Logger("NonInviteClientTransaction"),loggerict=new Logger("InviteClientTransaction"),loggeract=new Logger("AckClientTransaction"),loggernist=new Logger("NonInviteServerTransaction"),loggerist=new Logger("InviteServerTransaction"),C={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},require=function(){_inherits(NonInviteClientTransaction,EventEmitter);var _super=_createSuper(NonInviteClientTransaction);function NonInviteClientTransaction(ua,transport,request,eventHandlers){_classCallCheck(this,NonInviteClientTransaction),(_this=_super.call(this)).type=C.NON_INVITE_CLIENT,_this.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),_this.ua=ua,_this.transport=transport,_this.request=request,_this.eventHandlers=eventHandlers;var _this,request="SIP/2.0/".concat(transport.via_transport);return request+=" ".concat(ua.configuration.via_host,";branch=").concat(_this.id),_this.request.setHeader("via",request),_this.ua.newTransaction(_assertThisInitialized(_this)),_this}return _createClass(NonInviteClientTransaction,[{key:"stateChanged",value:function(state){this.state=state,this.emit("stateChanged")}},{key:"send",value:function(){var _this2=this;this.stateChanged(C.STATUS_TRYING),this.F=setTimeout(function(){_this2.timer_F()},Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){loggernict.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){loggernict.debug("Timer F expired for transaction ".concat(this.id)),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(response){var _this3=this,status_code=response.status_code;if(status_code<200)switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(response)}else switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED),clearTimeout(this.F),408===status_code?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(response),this.K=setTimeout(function(){_this3.timer_K()},Timers.TIMER_K)}}},{key:"C",get:function(){return C}}]),NonInviteClientTransaction}(),Logger=function(){_inherits(InviteClientTransaction,EventEmitter);var _super2=_createSuper(InviteClientTransaction);function InviteClientTransaction(ua,transport,request,eventHandlers){_classCallCheck(this,InviteClientTransaction),(_this4=_super2.call(this)).type=C.INVITE_CLIENT,_this4.id="z9hG4bK".concat(Math.floor(1e7*Math.random())),_this4.ua=ua,_this4.transport=transport,_this4.request=request,_this4.eventHandlers=eventHandlers,request.transaction=_assertThisInitialized(_this4);var _this4,eventHandlers="SIP/2.0/".concat(transport.via_transport);return eventHandlers+=" ".concat(ua.configuration.via_host,";branch=").concat(_this4.id),_this4.request.setHeader("via",eventHandlers),_this4.ua.newTransaction(_assertThisInitialized(_this4)),_this4}return _createClass(InviteClientTransaction,[{key:"stateChanged",value:function(state){this.state=state,this.emit("stateChanged")}},{key:"send",value:function(){var _this5=this;this.stateChanged(C.STATUS_CALLING),this.B=setTimeout(function(){_this5.timer_B()},Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==C.STATUS_ACCEPTED&&(loggerict.debug("transport error occurred, deleting transaction ".concat(this.id)),this.eventHandlers.onTransportError()),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){loggerict.debug("Timer M expired for transaction ".concat(this.id)),this.state===C.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){loggerict.debug("Timer B expired for transaction ".concat(this.id)),this.state===C.STATUS_CALLING&&(this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){loggerict.debug("Timer D expired for transaction ".concat(this.id)),clearTimeout(this.B),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(response){var _this6=this,ack=new SIPMessage.OutgoingRequest(JsSIP_C.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});ack.setHeader("from",this.request.getHeader("from")),ack.setHeader("via",this.request.getHeader("via")),ack.setHeader("to",response.getHeader("to")),this.D=setTimeout(function(){_this6.timer_D()},Timers.TIMER_D),this.transport.send(ack)}},{key:"cancel",value:function(reason){var cancel;this.state===C.STATUS_PROCEEDING&&((cancel=new SIPMessage.OutgoingRequest(JsSIP_C.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeaders("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq})).setHeader("from",this.request.getHeader("from")),cancel.setHeader("via",this.request.getHeader("via")),cancel.setHeader("to",this.request.getHeader("to")),reason&&cancel.setHeader("reason",reason),this.transport.send(cancel))}},{key:"receiveResponse",value:function(response){var _this7=this,status_code=response.status_code;if(100<=status_code&&status_code<=199)switch(this.state){case C.STATUS_CALLING:this.stateChanged(C.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(response);break;case C.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(response)}else if(200<=status_code&&status_code<=299)switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED),this.M=setTimeout(function(){_this7.timer_M()},Timers.TIMER_M),this.eventHandlers.onReceiveResponse(response);break;case C.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(response)}else if(300<=status_code&&status_code<=699)switch(this.state){case C.STATUS_CALLING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED),this.sendACK(response),this.eventHandlers.onReceiveResponse(response);break;case C.STATUS_COMPLETED:this.sendACK(response)}}},{key:"C",get:function(){return C}}]),InviteClientTransaction}(),AckClientTransaction=function(){_inherits(AckClientTransaction,EventEmitter);var _super3=_createSuper(AckClientTransaction);function AckClientTransaction(ua,transport,request,eventHandlers){_classCallCheck(this,AckClientTransaction),(_this8=_super3.call(this)).id="z9hG4bK".concat(Math.floor(1e7*Math.random())),_this8.transport=transport,_this8.request=request,_this8.eventHandlers=eventHandlers;var _this8,request="SIP/2.0/".concat(transport.via_transport);return request+=" ".concat(ua.configuration.via_host,";branch=").concat(_this8.id),_this8.request.setHeader("via",request),_this8}return _createClass(AckClientTransaction,[{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){loggeract.debug("transport error occurred for transaction ".concat(this.id)),this.eventHandlers.onTransportError()}},{key:"C",get:function(){return C}}]),AckClientTransaction}(),NonInviteServerTransaction=function(){_inherits(NonInviteServerTransaction,EventEmitter);var _super4=_createSuper(NonInviteServerTransaction);function NonInviteServerTransaction(ua,transport,request){var _this9;return _classCallCheck(this,NonInviteServerTransaction),(_this9=_super4.call(this)).type=C.NON_INVITE_SERVER,_this9.id=request.via_branch,_this9.ua=ua,_this9.transport=transport,_this9.request=request,_this9.last_response="",request.server_transaction=_assertThisInitialized(_this9),_this9.state=C.STATUS_TRYING,ua.newTransaction(_assertThisInitialized(_this9)),_this9}return _createClass(NonInviteServerTransaction,[{key:"stateChanged",value:function(state){this.state=state,this.emit("stateChanged")}},{key:"timer_J",value:function(){loggernist.debug("Timer J expired for transaction ".concat(this.id)),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,loggernist.debug("transport error occurred, deleting transaction ".concat(this.id)),clearTimeout(this.J),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(status_code,response,onSuccess,onFailure){var _this10=this;if(100===status_code)switch(this.state){case C.STATUS_TRYING:this.stateChanged(C.STATUS_PROCEEDING),this.transport.send(response)||this.onTransportError();break;case C.STATUS_PROCEEDING:this.last_response=response,this.transport.send(response)?onSuccess&&onSuccess():(this.onTransportError(),onFailure&&onFailure())}else if(200<=status_code&&status_code<=699)switch(this.state){case C.STATUS_TRYING:case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_COMPLETED),this.last_response=response,this.J=setTimeout(function(){_this10.timer_J()},Timers.TIMER_J),this.transport.send(response)?onSuccess&&onSuccess():(this.onTransportError(),onFailure&&onFailure())}}},{key:"C",get:function(){return C}}]),NonInviteServerTransaction}(),InviteServerTransaction=function(){_inherits(InviteServerTransaction,EventEmitter);var _super5=_createSuper(InviteServerTransaction);function InviteServerTransaction(ua,transport,request){var _this11;return _classCallCheck(this,InviteServerTransaction),(_this11=_super5.call(this)).type=C.INVITE_SERVER,_this11.id=request.via_branch,_this11.ua=ua,_this11.transport=transport,_this11.request=request,_this11.last_response="",request.server_transaction=_assertThisInitialized(_this11),_this11.state=C.STATUS_PROCEEDING,ua.newTransaction(_assertThisInitialized(_this11)),_this11.resendProvisionalTimer=null,request.reply(100),_this11}return _createClass(InviteServerTransaction,[{key:"stateChanged",value:function(state){this.state=state,this.emit("stateChanged")}},{key:"timer_H",value:function(){loggerist.debug("Timer H expired for transaction ".concat(this.id)),this.state===C.STATUS_COMPLETED&&loggerist.debug("ACK not received, dialog will be terminated"),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_L",value:function(){loggerist.debug("Timer L expired for transaction ".concat(this.id)),this.state===C.STATUS_ACCEPTED&&(this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,loggerist.debug("transport error occurred, deleting transaction ".concat(this.id)),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(C.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(status_code,response,onSuccess,onFailure){var _this12=this;if(100<=status_code&&status_code<=199&&this.state===C.STATUS_PROCEEDING&&(this.transport.send(response)||this.onTransportError(),this.last_response=response),100<status_code&&status_code<=199&&this.state===C.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){_this12.resend_provisional()},Timers.PROVISIONAL_RESPONSE_INTERVAL));else if(200<=status_code&&status_code<=299)switch(this.state){case C.STATUS_PROCEEDING:this.stateChanged(C.STATUS_ACCEPTED),this.last_response=response,this.L=setTimeout(function(){_this12.timer_L()},Timers.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case C.STATUS_ACCEPTED:this.transport.send(response)?onSuccess&&onSuccess():(this.onTransportError(),onFailure&&onFailure())}else 300<=status_code&&status_code<=699&&this.state===C.STATUS_PROCEEDING&&(null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(response)?(this.stateChanged(C.STATUS_COMPLETED),this.H=setTimeout(function(){_this12.timer_H()},Timers.TIMER_H),onSuccess&&onSuccess()):(this.onTransportError(),onFailure&&onFailure()))}},{key:"C",get:function(){return C}}]),InviteServerTransaction}();module.exports={C:C,NonInviteClientTransaction:require,InviteClientTransaction:Logger,AckClientTransaction:AckClientTransaction,NonInviteServerTransaction:NonInviteServerTransaction,InviteServerTransaction:InviteServerTransaction,checkTransaction:function(_ref,request){var tr,_transactions=_ref._transactions;switch(request.method){case JsSIP_C.INVITE:if(tr=_transactions.ist[request.via_branch])return tr.state===C.STATUS_PROCEEDING&&tr.transport.send(tr.last_response),!0;break;case JsSIP_C.ACK:if(!(tr=_transactions.ist[request.via_branch]))return!1;if(tr.state===C.STATUS_ACCEPTED)return!1;if(tr.state===C.STATUS_COMPLETED)return tr.state=C.STATUS_CONFIRMED,tr.I=setTimeout(function(){tr.timer_I()},Timers.TIMER_I),!0;break;case JsSIP_C.CANCEL:return(tr=_transactions.ist[request.via_branch])?(request.reply_sl(200),tr.state!==C.STATUS_PROCEEDING):(request.reply_sl(481),!0);default:if(tr=_transactions.nist[request.via_branch]){switch(tr.state){case C.STATUS_TRYING:break;case C.STATUS_PROCEEDING:case C.STATUS_COMPLETED:tr.transport.send(tr.last_response)}return!0}}}}},{"./Constants":2,"./Logger":9,"./SIPMessage":21,"./Timers":23,events:31}],25:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Logger=require("./Logger"),Socket=require("./Socket"),require=require("./Constants"),logger=new Logger("Transport"),C={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:require.CONNECTION_RECOVERY_MIN_INTERVAL,max_interval:require.CONNECTION_RECOVERY_MAX_INTERVAL}};module.exports=function(){function Transport(sockets){var recovery_options=1<arguments.length&&void 0!==arguments[1]?arguments[1]:C.recovery_options,instance=this,Constructor=Transport;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");logger.debug("new()"),this.status=C.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=recovery_options,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1;try{this.textDecoder=new TextDecoder("utf8")}catch(error){logger.warn("cannot use TextDecoder: ".concat(error))}if(void 0===sockets)throw new TypeError("Invalid argument. undefined 'sockets' argument");(sockets=sockets instanceof Array?sockets:[sockets]).forEach(function(socket){if(!Socket.isSocket(socket.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(socket.weight&&!Number(socket.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:socket.socket,weight:socket.weight||0,status:C.SOCKET_STATUS_READY})},this),this._getSocket()}var Constructor,protoProps,staticProps;return Constructor=Transport,(protoProps=[{key:"connect",value:function(){logger.debug("connect()"),this.isConnected()?logger.debug("Transport is already connected"):this.isConnecting()?logger.debug("Transport is connecting"):(this.close_requested=!1,this.status=C.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}},{key:"disconnect",value:function(){logger.debug("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=C.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(data){return logger.debug("send()"),this.isConnected()?(data=data.toString(),logger.debug("sending message:\n\n".concat(data,"\n")),this.socket.send(data)):(logger.warn("unable to send message, transport is not connected"),!1)}},{key:"isConnected",value:function(){return this.status===C.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===C.STATUS_CONNECTING}},{key:"_reconnect",value:function(){var _this=this,k=(this.recover_attempts+=1,Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1));k<this.recovery_options.min_interval?k=this.recovery_options.min_interval:k>this.recovery_options.max_interval&&(k=this.recovery_options.max_interval),logger.debug("reconnection attempt: ".concat(this.recover_attempts,". next connection attempt in ").concat(k," seconds")),this.recovery_timer=setTimeout(function(){_this.close_requested||_this.isConnected()||_this.isConnecting()||(_this._getSocket(),_this.connect())},1e3*k)}},{key:"_getSocket",value:function(){var idx,candidates=[];this.sockets.forEach(function(socket){socket.status!==C.SOCKET_STATUS_ERROR&&(0===candidates.length?candidates.push(socket):socket.weight>candidates[0].weight?candidates=[socket]:socket.weight===candidates[0].weight&&candidates.push(socket))}),0===candidates.length?(this.sockets.forEach(function(socket){socket.status=C.SOCKET_STATUS_READY}),this._getSocket()):(idx=Math.floor(Math.random()*candidates.length),this.socket=candidates[idx].socket)}},{key:"_onConnect",value:function(){this.recover_attempts=0,this.status=C.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(error,code,reason){this.status=C.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:error,code:code,reason:reason}),this.close_requested||(this.sockets.forEach(function(socket){this.socket===socket.socket&&(socket.status=C.SOCKET_STATUS_ERROR)},this),this._reconnect(error))}},{key:"_onData",value:function(data){if("\r\n"===data)logger.debug("received message with CRLF Keep Alive response");else{if("string"!=typeof data){try{data=this.textDecoder?this.textDecoder.decode(data):String.fromCharCode.apply(null,new Uint8Array(data))}catch(evt){return void logger.debug("received binary message failed to be converted into string, message discarded")}logger.debug("received binary message:\n\n".concat(data,"\n"))}else logger.debug("received text message:\n\n".concat(data,"\n"));this.ondata({transport:this,message:data})}}},{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Transport}()},{"./Constants":2,"./Logger":9,"./Socket":22}],26:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function(o,p){return o.__proto__=p,o})(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var NewTarget,call,Super=_getPrototypeOf(Derived);return NewTarget=hasNativeReflectConstruct?(NewTarget=_getPrototypeOf(this).constructor,Reflect.construct(Super,arguments,NewTarget)):Super.apply(this,arguments),Super=this,!(call=NewTarget)||"object"!==_typeof(call)&&"function"!=typeof call?_assertThisInitialized(Super):call}}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}var EventEmitter=require("events").EventEmitter,Logger=require("./Logger"),JsSIP_C=require("./Constants"),Registrator=require("./Registrator"),RTCSession=require("./RTCSession"),Message=require("./Message"),Options=require("./Options"),Transactions=require("./Transactions"),Transport=require("./Transport"),Utils=require("./Utils"),Exceptions=require("./Exceptions"),URI=require("./URI"),Parser=require("./Parser"),SIPMessage=require("./SIPMessage"),sanityCheck=require("./sanityCheck"),config=require("./Config"),logger=new Logger("UA"),C={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};module.exports=function(){var subClass=UA,superClass=EventEmitter;if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass);var _super=_createSuper(UA);function UA(configuration){var _this;if(!(this instanceof UA))throw new TypeError("Cannot call a class as a function");if(logger.debug("new() [configuration:%o]",configuration),(_this=_super.call(this))._cache={credentials:{}},_this._configuration=Object.assign({},config.settings),_this._dynConfiguration={},_this._dialogs={},_this._applicants={},_this._sessions={},_this._transport=null,_this._contact=null,_this._status=C.STATUS_INIT,_this._error=null,_this._transactions={nist:{},nict:{},ist:{},ict:{}},_this._data={},_this._closeTimer=null,void 0===configuration)throw new TypeError("Not enough arguments");try{_this._loadConfig(configuration)}catch(e){throw _this._status=C.STATUS_NOT_READY,_this._error=C.CONFIGURATION_ERROR,e}return _this._registrator=new Registrator(_assertThisInitialized(_this)),_this}return _createClass(UA,null,[{key:"C",get:function(){return C}}]),_createClass(UA,[{key:"start",value:function(){logger.debug("start()"),this._status===C.STATUS_INIT?this._transport.connect():this._status===C.STATUS_USER_CLOSED?(logger.debug("restarting UA"),null!==this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=C.STATUS_INIT,this._transport.connect()):this._status===C.STATUS_READY?logger.debug("UA is in READY status, not restarted"):logger.debug("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){logger.debug("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(options){logger.debug("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(options)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(target,options){logger.debug("call()");var session=new RTCSession(this);return session.connect(target,options),session}},{key:"sendMessage",value:function(target,body,options){logger.debug("sendMessage()");var message=new Message(this);return message.send(target,body,options),message}},{key:"sendOptions",value:function(target,body,options){logger.debug("sendOptions()");var message=new Options(this);return message.send(target,body,options),message}},{key:"terminateSessions",value:function(options){for(var idx in logger.debug("terminateSessions()"),this._sessions)this._sessions[idx].isEnded()||this._sessions[idx].terminate(options)}},{key:"stop",value:function(){var _this2=this;if(logger.debug("stop()"),this._dynConfiguration={},this._status===C.STATUS_USER_CLOSED)logger.debug("UA already closed");else{this._registrator.close();var session,applicant,num_sessions=Object.keys(this._sessions).length;for(session in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,session)){logger.debug("closing session ".concat(session));try{this._sessions[session].terminate()}catch(error){}}for(applicant in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,applicant))try{this._applicants[applicant].close()}catch(error){}this._status=C.STATUS_USER_CLOSED,0===Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length&&0===num_sessions?this._transport.disconnect():this._closeTimer=setTimeout(function(){_this2._closeTimer=null,_this2._transport.disconnect()},2e3)}}},{key:"normalizeTarget",value:function(target){return Utils.normalizeTarget(target,this._configuration.hostport_params)}},{key:"get",value:function(parameter){switch(parameter){case"authorization_user":return this._configuration.authorization_user;case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;case"authorization_jwt":return this._configuration.authorization_jwt;default:return void logger.warn('get() | cannot get "%s" parameter in runtime',parameter)}}},{key:"set",value:function(parameter,value){switch(parameter){case"authorization_user":this._configuration.authorization_user=String(value);break;case"password":this._configuration.password=String(value);break;case"realm":this._configuration.realm=String(value);break;case"ha1":this._configuration.ha1=String(value),this._configuration.password=null;break;case"authorization_jwt":this._configuration.authorization_jwt=String(value);break;case"display_name":this._configuration.display_name=value;break;default:return logger.warn('set() | cannot set "%s" parameter in runtime',parameter),!1}return!0}},{key:"newTransaction",value:function(transaction){this._transactions[transaction.type][transaction.id]=transaction,this.emit("newTransaction",{transaction:transaction})}},{key:"destroyTransaction",value:function(transaction){delete this._transactions[transaction.type][transaction.id],this.emit("transactionDestroyed",{transaction:transaction})}},{key:"newDialog",value:function(dialog){this._dialogs[dialog.id]=dialog}},{key:"destroyDialog",value:function(dialog){delete this._dialogs[dialog.id]}},{key:"newMessage",value:function(message,data){this._applicants[message]=message,this.emit("newMessage",data)}},{key:"newOptions",value:function(message,data){this._applicants[message]=message,this.emit("newOptions",data)}},{key:"destroyMessage",value:function(message){delete this._applicants[message]}},{key:"newRTCSession",value:function(session,data){this._sessions[session.id]=session,this.emit("newRTCSession",data)}},{key:"destroyRTCSession",value:function(session){delete this._sessions[session.id]}},{key:"registered",value:function(data){this.emit("registered",data)}},{key:"unregistered",value:function(data){this.emit("unregistered",data)}},{key:"registrationFailed",value:function(data){this.emit("registrationFailed",data)}},{key:"receiveRequest",value:function(request){var session,replaces,dialog,method=request.method;if(request.ruri.user!==this._configuration.uri.user&&request.ruri.user!==this._contact.uri.user)logger.debug("Request-URI does not point to us"),request.method!==JsSIP_C.ACK&&request.reply_sl(404);else if(request.ruri.scheme===JsSIP_C.SIPS)request.reply_sl(416);else if(!Transactions.checkTransaction(this,request)){if(method===JsSIP_C.INVITE?new Transactions.InviteServerTransaction(this,this._transport,request):method!==JsSIP_C.ACK&&method!==JsSIP_C.CANCEL&&new Transactions.NonInviteServerTransaction(this,this._transport,request),method===JsSIP_C.OPTIONS){if(0===this.listeners("newOptions").length)return void request.reply(200);new Options(this).init_incoming(request)}else if(method===JsSIP_C.MESSAGE){if(0===this.listeners("newMessage").length)return void request.reply(405);new Message(this).init_incoming(request)}else if(method===JsSIP_C.INVITE&&!request.to_tag&&0===this.listeners("newRTCSession").length)return void request.reply(405);if(request.to_tag)(dialog=this._findDialog(request.call_id,request.from_tag,request.to_tag))?dialog.receiveRequest(request):method===JsSIP_C.NOTIFY?(session=this._findSession(request))?session.receiveRequest(request):(logger.debug("received NOTIFY request for a non existent subscription"),request.reply(481,"Subscription does not exist")):method!==JsSIP_C.ACK&&request.reply(481);else switch(method){case JsSIP_C.INVITE:window.RTCPeerConnection?request.hasHeader("replaces")?(replaces=request.replaces,(dialog=this._findDialog(replaces.call_id,replaces.from_tag,replaces.to_tag))?(session=dialog.owner).isEnded()?request.reply(603):session.receiveRequest(request):request.reply(481)):(session=new RTCSession(this)).init_incoming(request):(logger.warn("INVITE received but WebRTC is not supported"),request.reply(488));break;case JsSIP_C.BYE:request.reply(481);break;case JsSIP_C.CANCEL:(session=this._findSession(request))?session.receiveRequest(request):logger.debug("received CANCEL request for a non existent session");break;case JsSIP_C.ACK:break;case JsSIP_C.NOTIFY:this.emit("sipEvent",{event:request.event,request:request}),request.reply(200);break;default:request.reply(405)}}}},{key:"_findSession",value:function(_ref){var call_id=_ref.call_id,from_tag=_ref.from_tag,_ref=_ref.to_tag,from_tag=this._sessions[call_id+from_tag],call_id=this._sessions[call_id+_ref];return from_tag||call_id||null}},{key:"_findDialog",value:function(call_id,from_tag,to_tag){var dialog=this._dialogs[call_id+from_tag+to_tag];return dialog||this._dialogs[call_id+to_tag+from_tag]||null}},{key:"_loadConfig",value:function(configuration){try{config.load(this._configuration,configuration)}catch(e){throw e}0===this._configuration.display_name&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=Utils.newUUID()),this._configuration.jssip_id=Utils.createRandomToken(5);var configuration=this._configuration.uri.clone();configuration.user=null,this._configuration.hostport_params=configuration.toString().replace(/^sip:/i,"");try{this._transport=new Transport(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=function(data){this.emit("connecting",data)}.bind(this),this._transport.onconnect=function(data){this._status!==C.STATUS_USER_CLOSED&&(this._status=C.STATUS_READY,this._error=null,this.emit("connected",data),this._dynConfiguration.register)&&this._registrator.register()}.bind(this),this._transport.ondisconnect=function(data){for(var _i=0,_client_transactions=["nict","ict","nist","ist"];_i<_client_transactions.length;_i++){var id,type=_client_transactions[_i];for(id in this._transactions[type])Object.prototype.hasOwnProperty.call(this._transactions[type],id)&&this._transactions[type][id].onTransportError()}this.emit("disconnected",data),this._registrator.onTransportClosed(),this._status!==C.STATUS_USER_CLOSED&&(this._status=C.STATUS_NOT_READY,this._error=C.NETWORK_ERROR)}.bind(this),this._transport.ondata=function(data){var transaction,transport=data.transport,message=data.message;if((message=Parser.parseMessage(message,this))&&!(this._status===C.STATUS_USER_CLOSED&&message instanceof SIPMessage.IncomingRequest)&&sanityCheck(message,this,transport))if(message instanceof SIPMessage.IncomingRequest)message.transport=transport,this.receiveRequest(message);else if(message instanceof SIPMessage.IncomingResponse)switch(message.method){case JsSIP_C.INVITE:(transaction=this._transactions.ict[message.via_branch])&&transaction.receiveResponse(message);break;case JsSIP_C.ACK:break;default:(transaction=this._transactions.nict[message.via_branch])&&transaction.receiveResponse(message)}}.bind(this)}catch(e){throw logger.warn(e),new Exceptions.ConfigurationError("sockets",this._configuration.sockets)}delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),this._configuration.registrar_server||((configuration=this._configuration.uri.clone()).user=null,configuration.clearParams(),configuration.clearHeaders(),this._configuration.registrar_server=configuration),this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new URI("sip",Utils.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},anonymous=options.anonymous||null,options=options.outbound||null,contact="<";return contact+=anonymous?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!options||(anonymous?this.temp_gruu:this.pub_gruu)||(contact+=";ob"),contact+=">"}};var parameter,_parameter,writable_parameters=["authorization_user","password","realm","ha1","authorization_jwt","display_name","register"];for(parameter in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,parameter)&&(-1!==writable_parameters.indexOf(parameter)?Object.defineProperty(this._configuration,parameter,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,parameter,{writable:!1,configurable:!1}));for(_parameter in logger.debug("configuration parameters after validation:"),this._configuration)if(Object.prototype.hasOwnProperty.call(config.settings,_parameter))switch(_parameter){case"uri":case"registrar_server":logger.debug("- ".concat(_parameter,": ").concat(this._configuration[_parameter]));break;case"password":case"ha1":case"authorization_jwt":logger.debug("- ".concat(_parameter,": NOT SHOWN"));break;default:logger.debug("- ".concat(_parameter,": ").concat(JSON.stringify(this._configuration[_parameter])))}}},{key:"C",get:function(){return C}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}}]),UA}()},{"./Config":1,"./Constants":2,"./Exceptions":6,"./Logger":9,"./Message":10,"./Options":12,"./Parser":13,"./RTCSession":14,"./Registrator":19,"./SIPMessage":21,"./Transactions":24,"./Transport":25,"./URI":27,"./Utils":28,"./sanityCheck":30,events:31}],27:[function(require,module,exports){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps)}var JsSIP_C=require("./Constants"),Utils=require("./Utils"),Grammar=require("./Grammar");module.exports=function(){function URI(scheme,user,host,port){var param,header,parameters=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},headers=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{},instance=this,Constructor=URI;if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function");if(!host)throw new TypeError('missing or invalid "host" parameter');for(param in this._parameters={},this._headers={},this._scheme=scheme||JsSIP_C.SIP,this._user=user,this._host=host,this._port=port,parameters)Object.prototype.hasOwnProperty.call(parameters,param)&&this.setParam(param,parameters[param]);for(header in headers)Object.prototype.hasOwnProperty.call(headers,header)&&this.setHeader(header,headers[header])}return _createClass(URI,null,[{key:"parse",value:function(uri){if(-1!==(uri=Grammar.parse(uri,"SIP_URI")))return uri}}]),_createClass(URI,[{key:"setParam",value:function(key,value){key&&(this._parameters[key.toLowerCase()]=null==value?null:value.toString())}},{key:"getParam",value:function(key){if(key)return this._parameters[key.toLowerCase()]}},{key:"hasParam",value:function(key){if(key)return!!this._parameters.hasOwnProperty(key.toLowerCase())}},{key:"deleteParam",value:function(parameter){var value;if(parameter=parameter.toLowerCase(),this._parameters.hasOwnProperty(parameter))return value=this._parameters[parameter],delete this._parameters[parameter],value}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(name,value){this._headers[Utils.headerize(name)]=Array.isArray(value)?value:[value]}},{key:"getHeader",value:function(name){if(name)return this._headers[Utils.headerize(name)]}},{key:"hasHeader",value:function(name){if(name)return!!this._headers.hasOwnProperty(Utils.headerize(name))}},{key:"deleteHeader",value:function(header){var value;if(header=Utils.headerize(header),this._headers.hasOwnProperty(header))return value=this._headers[header],delete this._headers[header],value}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new URI(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var parameter,header,headers=[],uri="".concat(this._scheme,":");for(parameter in this._user&&(uri+="".concat(Utils.escapeUser(this._user),"@")),uri+=this._host,!this._port&&0!==this._port||(uri+=":".concat(this._port)),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,parameter)&&(uri+=";".concat(parameter),null!==this._parameters[parameter])&&(uri+="=".concat(this._parameters[parameter]));for(header in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,header)){var _step,_iterator=_createForOfIteratorHelper(this._headers[header]);try{for(_iterator.s();!(_step=_iterator.n()).done;){var item=_step.value;headers.push("".concat(header,"=").concat(item))}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return 0<headers.length&&(uri+="?".concat(headers.join("&"))),uri}},{key:"toAor",value:function(show_port){var aor="".concat(this._scheme,":");return this._user&&(aor+="".concat(Utils.escapeUser(this._user),"@")),aor+=this._host,show_port&&(this._port||0===this._port)&&(aor+=":".concat(this._port)),aor}},{key:"scheme",get:function(){return this._scheme},set:function(value){this._scheme=value.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(value){this._user=value}},{key:"host",get:function(){return this._host},set:function(value){this._host=value.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(value){this._port=0===value?value:parseInt(value,10)||null}}]),URI}()},{"./Constants":2,"./Grammar":7,"./Utils":28}],28:[function(require,module,exports){"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var JsSIP_C=require("./Constants"),URI=require("./URI"),Grammar=require("./Grammar"),isFunction=(exports.str_utf8_length=function(string){return unescape(encodeURIComponent(string)).length},exports.isFunction=function(fn){return void 0!==fn&&"[object Function]"===Object.prototype.toString.call(fn)}),createRandomToken=(exports.isString=function(str){return void 0!==str&&"[object String]"===Object.prototype.toString.call(str)},exports.isDecimal=function(num){return!isNaN(num)&&parseFloat(num)===parseInt(num,10)},exports.isEmpty=function(value){return null===value||""===value||void 0===value||Array.isArray(value)&&0===value.length||"number"==typeof value&&isNaN(value)},exports.hasMethods=function(obj){for(var _len=arguments.length,methodNames=new Array(1<_len?_len-1:0),_key=1;_key<_len;_key++)methodNames[_key-1]=arguments[_key];for(var _i=0,_methodNames=methodNames;_i<_methodNames.length;_i++){var methodName=_methodNames[_i];if(isFunction(obj[methodName]))return!1}return!0},exports.createRandomToken=function(size){for(var base=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,token="",i=0;i<size;i++)token+=(Math.random()*base|0).toString(base);return token}),escapeUser=(exports.newTag=function(){return createRandomToken(10)},exports.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)})},exports.hostType=function(host){if(host&&-1!==(host=Grammar.parse(host,"host")))return host.host_type},exports.escapeUser=function(user){return encodeURIComponent(decodeURIComponent(user)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")});exports.normalizeTarget=function(target,domain){if(target){if(target instanceof URI)return target;if("string"==typeof target){var target_user,target_domain,uri,target_array=target.split("@");switch(target_array.length){case 1:if(!domain)return;target_user=target,target_domain=domain;break;case 2:target_user=target_array[0],target_domain=target_array[1];break;default:target_user=target_array.slice(0,target_array.length-1).join("@"),target_domain=target_array[target_array.length-1]}if(target_user=target_user.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(target_user)&&(target_user=target_user.replace(/[-.()]/g,"")),target="".concat(JsSIP_C.SIP,":").concat(escapeUser(target_user),"@").concat(target_domain),uri=URI.parse(target))return uri}}},exports.headerize=function(string){for(var exceptions={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},name=string.toLowerCase().replace(/_/g,"-").split("-"),hname="",parts=name.length,part=0;part<parts;part++)0!==part&&(hname+="-"),hname+=name[part].charAt(0).toUpperCase()+name[part].substring(1);return hname=exceptions[hname]?exceptions[hname]:hname},exports.sipErrorCause=function(status_code){for(var cause in JsSIP_C.SIP_ERROR_CAUSES)if(-1!==JsSIP_C.SIP_ERROR_CAUSES[cause].indexOf(status_code))return JsSIP_C.causes[cause];return JsSIP_C.causes.SIP_FAILURE_CODE},exports.getRandomTestNetIP=function(){return"192.0.2.".concat((from=1,to=254,Math.floor(Math.random()*(to-from+1)+from)));var from,to},exports.calculateMD5=function(string){function rotateLeft(lValue,iShiftBits){return lValue<<iShiftBits|lValue>>>32-iShiftBits}function addUnsigned(lX,lY){var lX8=2147483648&lX,lY8=2147483648&lY,lX4=1073741824&lX,lY4=1073741824&lY,lX=(1073741823&lX)+(1073741823&lY);return lX4&lY4?2147483648^lX^lX8^lY8:lX4|lY4?1073741824&lX?3221225472^lX^lX8^lY8:1073741824^lX^lX8^lY8:lX^lX8^lY8}function doFF(a,b,c,d,x,s,ac){return a=addUnsigned(a,addUnsigned(addUnsigned(function(x,y,z){return x&y|~x&z}(b,c,d),x),ac)),addUnsigned(rotateLeft(a,s),b)}function doGG(a,b,c,d,x,s,ac){return a=addUnsigned(a,addUnsigned(addUnsigned(function(x,y,z){return x&z|y&~z}(b,c,d),x),ac)),addUnsigned(rotateLeft(a,s),b)}function doHH(a,b,c,d,x,s,ac){return a=addUnsigned(a,addUnsigned(addUnsigned(b^c^d,x),ac)),addUnsigned(rotateLeft(a,s),b)}function doII(a,b,c,d,x,s,ac){return a=addUnsigned(a,addUnsigned(addUnsigned(c^(b|~d),x),ac)),addUnsigned(rotateLeft(a,s),b)}function wordToHex(lValue){for(var wordToHexValue="",wordToHexValue_temp="",lCount=0;lCount<=3;lCount++)wordToHexValue+=(wordToHexValue_temp="0".concat((lValue>>>8*lCount&255).toString(16))).substr(wordToHexValue_temp.length-2,2);return wordToHexValue}for(var AA,BB,CC,DD,x=function(str){for(var lWordCount,lMessageLength=str.length,lNumberOfWords_temp1=16*(1+((lNumberOfWords_temp1=lMessageLength+8)-lNumberOfWords_temp1%64)/64),lWordArray=new Array(lNumberOfWords_temp1-1),lBytePosition=0,lByteCount=0;lByteCount<lMessageLength;)lBytePosition=lByteCount%4*8,lWordArray[lWordCount=(lByteCount-lByteCount%4)/4]=lWordArray[lWordCount]|str.charCodeAt(lByteCount)<<lBytePosition,lByteCount++;return lWordArray[lWordCount=(lByteCount-lByteCount%4)/4]=lWordArray[lWordCount]|128<<(lBytePosition=lByteCount%4*8),lWordArray[lNumberOfWords_temp1-2]=lMessageLength<<3,lWordArray[lNumberOfWords_temp1-1]=lMessageLength>>>29,lWordArray}(string=function(str){for(var utftext="",n=0;n<str.length;n++){var _c=str.charCodeAt(n);_c<128?utftext+=String.fromCharCode(_c):utftext=127<_c&&_c<2048?(utftext+=String.fromCharCode(_c>>6|192))+String.fromCharCode(63&_c|128):(utftext=(utftext+=String.fromCharCode(_c>>12|224))+String.fromCharCode(_c>>6&63|128))+String.fromCharCode(63&_c|128)}return utftext}(string)),a=1732584193,b=4023233417,c=2562383102,d=271733878,k=0;k<x.length;k+=16)a=doFF(AA=a,BB=b,CC=c,DD=d,x[k+0],7,3614090360),d=doFF(d,a,b,c,x[k+1],12,3905402710),c=doFF(c,d,a,b,x[k+2],17,606105819),b=doFF(b,c,d,a,x[k+3],22,3250441966),a=doFF(a,b,c,d,x[k+4],7,4118548399),d=doFF(d,a,b,c,x[k+5],12,1200080426),c=doFF(c,d,a,b,x[k+6],17,2821735955),b=doFF(b,c,d,a,x[k+7],22,4249261313),a=doFF(a,b,c,d,x[k+8],7,1770035416),d=doFF(d,a,b,c,x[k+9],12,2336552879),c=doFF(c,d,a,b,x[k+10],17,4294925233),b=doFF(b,c,d,a,x[k+11],22,2304563134),a=doFF(a,b,c,d,x[k+12],7,1804603682),d=doFF(d,a,b,c,x[k+13],12,4254626195),c=doFF(c,d,a,b,x[k+14],17,2792965006),a=doGG(a,b=doFF(b,c,d,a,x[k+15],22,1236535329),c,d,x[k+1],5,4129170786),d=doGG(d,a,b,c,x[k+6],9,3225465664),c=doGG(c,d,a,b,x[k+11],14,643717713),b=doGG(b,c,d,a,x[k+0],20,3921069994),a=doGG(a,b,c,d,x[k+5],5,3593408605),d=doGG(d,a,b,c,x[k+10],9,38016083),c=doGG(c,d,a,b,x[k+15],14,3634488961),b=doGG(b,c,d,a,x[k+4],20,3889429448),a=doGG(a,b,c,d,x[k+9],5,568446438),d=doGG(d,a,b,c,x[k+14],9,3275163606),c=doGG(c,d,a,b,x[k+3],14,4107603335),b=doGG(b,c,d,a,x[k+8],20,1163531501),a=doGG(a,b,c,d,x[k+13],5,2850285829),d=doGG(d,a,b,c,x[k+2],9,4243563512),c=doGG(c,d,a,b,x[k+7],14,1735328473),a=doHH(a,b=doGG(b,c,d,a,x[k+12],20,2368359562),c,d,x[k+5],4,4294588738),d=doHH(d,a,b,c,x[k+8],11,2272392833),c=doHH(c,d,a,b,x[k+11],16,1839030562),b=doHH(b,c,d,a,x[k+14],23,4259657740),a=doHH(a,b,c,d,x[k+1],4,2763975236),d=doHH(d,a,b,c,x[k+4],11,1272893353),c=doHH(c,d,a,b,x[k+7],16,4139469664),b=doHH(b,c,d,a,x[k+10],23,3200236656),a=doHH(a,b,c,d,x[k+13],4,681279174),d=doHH(d,a,b,c,x[k+0],11,3936430074),c=doHH(c,d,a,b,x[k+3],16,3572445317),b=doHH(b,c,d,a,x[k+6],23,76029189),a=doHH(a,b,c,d,x[k+9],4,3654602809),d=doHH(d,a,b,c,x[k+12],11,3873151461),c=doHH(c,d,a,b,x[k+15],16,530742520),a=doII(a,b=doHH(b,c,d,a,x[k+2],23,3299628645),c,d,x[k+0],6,4096336452),d=doII(d,a,b,c,x[k+7],10,1126891415),c=doII(c,d,a,b,x[k+14],15,2878612391),b=doII(b,c,d,a,x[k+5],21,4237533241),a=doII(a,b,c,d,x[k+12],6,1700485571),d=doII(d,a,b,c,x[k+3],10,2399980690),c=doII(c,d,a,b,x[k+10],15,4293915773),b=doII(b,c,d,a,x[k+1],21,2240044497),a=doII(a,b,c,d,x[k+8],6,1873313359),d=doII(d,a,b,c,x[k+15],10,4264355552),c=doII(c,d,a,b,x[k+6],15,2734768916),b=doII(b,c,d,a,x[k+13],21,1309151649),a=doII(a,b,c,d,x[k+4],6,4149444226),d=doII(d,a,b,c,x[k+11],10,3174756917),c=doII(c,d,a,b,x[k+2],15,718787259),b=doII(b,c,d,a,x[k+9],21,3951481745),a=addUnsigned(a,AA),b=addUnsigned(b,BB),c=addUnsigned(c,CC),d=addUnsigned(d,DD);return(wordToHex(a)+wordToHex(b)+wordToHex(c)+wordToHex(d)).toLowerCase()},exports.closeMediaStream=function(stream){if(stream)try{if(stream.getTracks){var _step,_iterator=_createForOfIteratorHelper(stream.getTracks());try{for(_iterator.s();!(_step=_iterator.n()).done;)_step.value.stop()}catch(err){_iterator.e(err)}finally{_iterator.f()}}else{var _step2,_iterator2=_createForOfIteratorHelper(stream.getAudioTracks());try{for(_iterator2.s();!(_step2=_iterator2.n()).done;)_step2.value.stop()}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var _step3,_iterator3=_createForOfIteratorHelper(stream.getVideoTracks());try{for(_iterator3.s();!(_step3=_iterator3.n()).done;)_step3.value.stop()}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}}catch(error){"function"!=typeof stream.stop&&"object"!==_typeof(stream.stop)||stream.stop()}},exports.cloneArray=function(array){return array&&array.slice()||[]},exports.cloneObject=function(obj){var fallback=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return obj&&Object.assign({},obj)||fallback}},{"./Constants":2,"./Grammar":7,"./URI":27}],29:[function(require,module,exports){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Logger=require("./Logger"),Grammar=require("./Grammar"),logger=new Logger("WebSocketInterface");module.exports=function(){function WebSocketInterface(url){if(!(this instanceof WebSocketInterface))throw new TypeError("Cannot call a class as a function");logger.debug('new() [url:"%s"]',url),this._url=url,this._sip_uri=null,this._via_transport=null,this._ws=null;var parsed_url=Grammar.parse(url,"absoluteURI");if(-1===parsed_url)throw logger.warn("invalid WebSocket URI: ".concat(url)),new TypeError("Invalid argument: ".concat(url));if("wss"!==parsed_url.scheme&&"ws"!==parsed_url.scheme)throw logger.warn("invalid WebSocket URI scheme: ".concat(parsed_url.scheme)),new TypeError("Invalid argument: ".concat(url));this._sip_uri="sip:".concat(parsed_url.host).concat(parsed_url.port?":".concat(parsed_url.port):"",";transport=ws"),this._via_transport=parsed_url.scheme.toUpperCase()}var Constructor,protoProps,staticProps;return Constructor=WebSocketInterface,(protoProps=[{key:"connect",value:function(){if(logger.debug("connect()"),this.isConnected())logger.debug("WebSocket ".concat(this._url," is already connected"));else if(this.isConnecting())logger.debug("WebSocket ".concat(this._url," is connecting"));else{this._ws&&this.disconnect(),logger.debug("connecting to WebSocket ".concat(this._url));try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(e){this._onError(e)}}}},{key:"disconnect",value:function(){logger.debug("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(message){return logger.debug("send()"),this.isConnected()?(this._ws.send(message),!0):(logger.warn("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){logger.debug("WebSocket ".concat(this._url," connected")),this.onconnect()}},{key:"_onClose",value:function(_ref){var wasClean=_ref.wasClean,code=_ref.code,_ref=_ref.reason;logger.debug("WebSocket ".concat(this._url," closed")),!1===wasClean&&logger.debug("WebSocket abrupt disconnection"),this.ondisconnect(!wasClean,code,_ref)}},{key:"_onMessage",value:function(_ref2){_ref2=_ref2.data;logger.debug("received WebSocket message"),this.ondata(_ref2)}},{key:"_onError",value:function(e){logger.warn("WebSocket ".concat(this._url," error: "),e)}},{key:"via_transport",get:function(){return this._via_transport},set:function(value){this._via_transport=value.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),WebSocketInterface}()},{"./Grammar":7,"./Logger":9}],30:[function(require,module,exports){"use strict";function _createForOfIteratorHelper(o,allowArrayLike){var it,i;if("undefined"==typeof Symbol||null==o[Symbol.iterator]){if(Array.isArray(o)||(it=function(o,minLen){var n;if(o)return"string"==typeof o?_arrayLikeToArray(o,minLen):"Map"===(n="Object"===(n=Object.prototype.toString.call(o).slice(8,-1))&&o.constructor?o.constructor.name:n)||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}(o))||allowArrayLike&&o&&"number"==typeof o.length)return it&&(o=it),i=0,{s:allowArrayLike=function(){},n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:allowArrayLike};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=o[Symbol.iterator]()},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}var message,ua,transport,Logger=require("./Logger"),JsSIP_C=require("./Constants"),SIPMessage=require("./SIPMessage"),Utils=require("./Utils"),logger=new Logger("sanityCheck"),all=[function(){for(var _i=0,_mandatoryHeaders=["from","to","call_id","cseq","via"];_i<_mandatoryHeaders.length;_i++){var header=_mandatoryHeaders[_i];if(!message.hasHeader(header))return logger.debug("missing mandatory header field : ".concat(header,", dropping the response")),!1}}],requests=[function(){if("sip"!==message.s("to").uri.scheme)return reply(416),!1},function(){if(!message.to_tag&&message.call_id.substr(0,5)===ua.configuration.jssip_id)return reply(482),!1},function(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength)return reply(400),!1},function(){var tr,fromTag=message.from_tag,call_id=message.call_id,cseq=message.cseq;if(!message.to_tag)if(message.method===JsSIP_C.INVITE){if(ua._transactions.ist[message.via_branch])return!1;for(var transaction in ua._transactions.ist)if(Object.prototype.hasOwnProperty.call(ua._transactions.ist,transaction)&&(tr=ua._transactions.ist[transaction]).request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq)return reply(482),!1}else{if(ua._transactions.nist[message.via_branch])return!1;for(var _transaction in ua._transactions.nist)if(Object.prototype.hasOwnProperty.call(ua._transactions.nist,_transaction)&&(tr=ua._transactions.nist[_transaction]).request.from_tag===fromTag&&tr.request.call_id===call_id&&tr.request.cseq===cseq)return reply(482),!1}}],responses=[function(){if(1<message.getHeaders("via").length)return logger.debug("more than one Via header field present in the response, dropping the response"),!1},function(){var len=Utils.str_utf8_length(message.body),contentLength=message.getHeader("content-length");if(len<contentLength)return logger.debug("message body length is lower than the value in Content-Length header field, dropping the response"),!1}];function reply(status_code){var _step4,vias=message.getHeaders("via"),response="SIP/2.0 ".concat(status_code," ").concat(JsSIP_C.REASON_PHRASE[status_code],"\r\n"),_iterator4=_createForOfIteratorHelper(vias);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var via=_step4.value;response+="Via: ".concat(via,"\r\n")}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}status_code=message.getHeader("To"),message.to_tag||(status_code+=";tag=".concat(Utils.newTag())),response=(response=(response=(response+="To: ".concat(status_code,"\r\n"))+"From: ".concat(message.getHeader("From"),"\r\n"))+"Call-ID: ".concat(message.call_id,"\r\n"))+"CSeq: ".concat(message.cseq," ").concat(message.method,"\r\n"),transport.send(response+="\r\n")}module.exports=function(m,u,t){message=m,ua=u,transport=t;var _step,_iterator=_createForOfIteratorHelper(all);try{for(_iterator.s();!(_step=_iterator.n()).done;)if(!1===(0,_step.value)())return!1}catch(err){_iterator.e(err)}finally{_iterator.f()}if(message instanceof SIPMessage.IncomingRequest){var _step2,_iterator2=_createForOfIteratorHelper(requests);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;)if(!1===(0,_step2.value)())return!1}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}else if(message instanceof SIPMessage.IncomingResponse){var _step3,_iterator3=_createForOfIteratorHelper(responses);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;)if(!1===(0,_step3.value)())return!1}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return!0}},{"./Constants":2,"./Logger":9,"./SIPMessage":21,"./Utils":28}],31:[function(require,module,exports){var objectCreate=Object.create||function(proto){function F(){}return F.prototype=proto,new F},objectKeys=Object.keys||function(obj){var k,keys=[];for(k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k},bind=Function.prototype.bind||function(context){var fn=this;return function(){return fn.apply(context,arguments)}};function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((module.exports=EventEmitter).EventEmitter=EventEmitter).prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,"x",{value:0}),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var events,existing;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return(events=target._events)?(events.newListener&&(target.emit("newListener",type,listener.listener||listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing?("function"==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),existing.warned||(prepend=$getMaxListeners(target))&&0<prepend&&existing.length>prepend&&(existing.warned=!0,(prepend=new Error("Possible EventEmitter memory leak detected. "+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",prepend.emitter=target,prepend.type=type,prepend.count=existing.length,"object"==typeof console)&&console.warn&&console.warn("%s: %s",prepend.name,prepend.message)):(existing=events[type]=listener,++target._eventsCount),target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){target={fired:!1,wrapFn:void 0,target:target,type:type,listener:listener},type=bind.call(onceWrapper,target);return type.listener=listener,target.wrapFn=type}function _listeners(target,type,unwrap){target=target._events;if(!target)return[];target=target[type];if(!target)return[];if("function"==typeof target)return unwrap?[target.listener||target]:[target];if(unwrap){for(var arr=target,ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}return arrayClone(target,target.length)}function listenerCount(type){var events=this._events;if(events){events=events[type];if("function"==typeof events)return 1;if(events)return events.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}hasDefineProperty?Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if("number"!=typeof arg||arg<0||arg!=arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg}}):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){var er,handler,args,i,doError="error"===type,events=this._events;if(events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError)throw(er=1<arguments.length?arguments[1]:er)instanceof Error?er:((doError=new Error('Unhandled "error" event. ('+er+")")).context=er,doError);if(!(handler=events[type]))return!1;var len,isFn="function"==typeof handler;switch(len=arguments.length){case 1:!function(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}(handler,isFn,this);break;case 2:!function(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}(handler,isFn,this,arguments[1]);break;case 3:!function(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}(handler,isFn,this,arguments[1],arguments[2]);break;case 4:!function(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];!function(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}(handler,isFn,this,args)}return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if("function"!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=this._events)&&(list=events[type]))if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit("removeListener",type,list.listener||listener));else if("function"!=typeof list){for(position=-1,i=list.length-1;0<=i;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit("removeListener",type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events=this._events;if(events)if(events.removeListener){if(0===arguments.length){for(var key,keys=objectKeys(events),i=0;i<keys.length;++i)"removeListener"!==(key=keys[i])&&this.removeAllListeners(key);this.removeAllListeners("removeListener"),this._events=objectCreate(null),this._eventsCount=0}else if("function"==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;0<=i;i--)this.removeListener(type,listeners[i])}else 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=objectCreate(null):delete events[type]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return"function"==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],32:[function(require,module,exports){!function(process){exports.log=function(...args){return"object"==typeof console&&console.log&&console.log(...args)},exports.formatArgs=function(args){if(args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),this.useColors){var c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,match=>{"%%"!==match&&(index++,"%c"===match)&&(lastC=index)}),args.splice(lastC,0,c)}},exports.save=function(namespaces){try{namespaces?exports.storage.setItem("debug",namespaces):exports.storage.removeItem("debug")}catch(error){}},exports.load=function(){let r;try{r=exports.storage.getItem("debug")}catch(error){}!r&&void 0!==process&&"env"in process&&(r=process.env.DEBUG);return r},exports.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},exports.storage=function(){try{return localStorage}catch(error){}}(),exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],module.exports=require("./common")(exports);var formatters=module.exports["formatters"];formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}}.call(this,require("_process"))},{"./common":33,_process:35}],33:[function(require,module,exports){module.exports=function(env){function selectColor(namespace){let hash=0;for(let i=0;i<namespace.length;i++)hash=(hash<<5)-hash+namespace.charCodeAt(i),hash|=0;return createDebug.colors[Math.abs(hash)%createDebug.colors.length]}function createDebug(namespace){let prevTime;function debug(...args){if(debug.enabled){const self=debug;var curr=Number(new Date),ms=curr-(prevTime||curr);self.diff=ms,self.prev=prevTime,self.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),"string"!=typeof args[0]&&args.unshift("%O");let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{var val;return"%%"!==match&&(index++,"function"==typeof(format=createDebug.formatters[format]))&&(val=args[index],match=format.call(self,val),args.splice(index,1),index--),match}),createDebug.formatArgs.call(self,args),(self.log||createDebug.log).apply(self,args)}}return debug.namespace=namespace,debug.enabled=createDebug.enabled(namespace),debug.useColors=createDebug.useColors(),debug.color=selectColor(namespace),debug.destroy=destroy,debug.extend=extend,"function"==typeof createDebug.init&&createDebug.init(debug),createDebug.instances.push(debug),debug}function destroy(){var index=createDebug.instances.indexOf(this);return-1!==index&&(createDebug.instances.splice(index,1),!0)}function extend(namespace,delimiter){delimiter=createDebug(this.namespace+(void 0===delimiter?":":delimiter)+namespace);return delimiter.log=this.log,delimiter}function toNamespace(regexp){return regexp.toString().substring(2,regexp.toString().length-2).replace(/\.\*\?$/,"*")}return((createDebug.debug=createDebug).default=createDebug).coerce=function(val){if(val instanceof Error)return val.stack||val.message;return val},createDebug.disable=function(){var namespaces=[...createDebug.names.map(toNamespace),...createDebug.skips.map(toNamespace).map(namespace=>"-"+namespace)].join(",");return createDebug.enable(""),namespaces},createDebug.enable=function(namespaces){createDebug.save(namespaces),createDebug.names=[],createDebug.skips=[];let i;var split=("string"==typeof namespaces?namespaces:"").split(/[\s,]+/),len=split.length;for(i=0;i<len;i++)split[i]&&("-"===(namespaces=split[i].replace(/\*/g,".*?"))[0]?createDebug.skips.push(new RegExp("^"+namespaces.substr(1)+"$")):createDebug.names.push(new RegExp("^"+namespaces+"$")));for(i=0;i<createDebug.instances.length;i++){var instance=createDebug.instances[i];instance.enabled=createDebug.enabled(instance.namespace)}},createDebug.enabled=function(name){if("*"===name[name.length-1])return!0;let i,len;for(i=0,len=createDebug.skips.length;i<len;i++)if(createDebug.skips[i].test(name))return!1;for(i=0,len=createDebug.names.length;i<len;i++)if(createDebug.names[i].test(name))return!0;return!1},createDebug.humanize=require("ms"),Object.keys(env).forEach(key=>{createDebug[key]=env[key]}),createDebug.instances=[],createDebug.names=[],createDebug.skips=[],createDebug.formatters={},createDebug.selectColor=selectColor,createDebug.enable(createDebug.load()),createDebug}},{ms:34}],34:[function(require,module,exports){var s=1e3,m=6e4,h=36e5,d=24*h;function plural(ms,msAbs,n,name){msAbs=1.5*n<=msAbs;return Math.round(ms/n)+" "+name+(msAbs?"s":"")}module.exports=function(val,options){options=options||{};var type=typeof val;if("string"==type&&0<val.length)return function(str){if(!(100<(str=String(str)).length)){str=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(str){var n=parseFloat(str[1]);switch((str[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(val);if("number"==type&&isFinite(val))return(options.long?function(ms){var msAbs=Math.abs(ms);if(d<=msAbs)return plural(ms,msAbs,d,"day");if(h<=msAbs)return plural(ms,msAbs,h,"hour");if(m<=msAbs)return plural(ms,msAbs,m,"minute");if(s<=msAbs)return plural(ms,msAbs,s,"second");return ms+" ms"}:function(ms){var msAbs=Math.abs(ms);if(d<=msAbs)return Math.round(ms/d)+"d";if(h<=msAbs)return Math.round(ms/h)+"h";if(m<=msAbs)return Math.round(ms/m)+"m";if(s<=msAbs)return Math.round(ms/s)+"s";return ms+"ms"})(val);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))}},{}],35:[function(require,module,exports){var cachedSetTimeout,cachedClearTimeout,module=module.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return(cachedSetTimeout=setTimeout)(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length)&&drainQueue()}function drainQueue(){if(!draining){for(var timeout=runTimeout(cleanUpNextTick),len=(draining=!0,queue.length);len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,!function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return(cachedClearTimeout=clearTimeout)(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}module.nextTick=function(fun){var args=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},module.title="browser",module.browser=!0,module.env={},module.argv=[],module.version="",module.versions={},module.on=noop,module.addListener=noop,module.once=noop,module.off=noop,module.removeListener=noop,module.removeAllListeners=noop,module.emit=noop,module.prependListener=noop,module.prependOnceListener=noop,module.listeners=function(name){return[]},module.binding=function(name){throw new Error("process.binding is not supported")},module.cwd=function(){return"/"},module.chdir=function(dir){throw new Error("process.chdir is not supported")},module.umask=function(){return 0}},{}],36:[function(require,module,exports){var grammar=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":o.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return null!=o.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return null!=o.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(o){return"extmap:%d"+(o.direction?"/%s":"%v")+(o["encrypt-uri"]?" %s":"%v")+" %s"+(o.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return null!=o.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(o){var str="candidate:%s %d %s %d %s %d typ %s",str=(str+=null!=o.raddr?" raddr %s rport %d":"%v%v")+(null!=o.tcptype?" tcptype %s":"%v");return null!=o.generation&&(str+=" generation %d"),str=(str+=null!=o["network-id"]?" network-id %d":"%v")+(null!=o["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(o){var str="ssrc:%d";return null!=o.attribute&&(str+=" %s",null!=o.value)&&(str+=":%s"),str}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(o){return null!=o.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(o){return o.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(o){return"imageattr:%s %s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(o){return"simulcast:%s %s"+(o.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(o){return"ts-refclk:%s"+(null!=o.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(o){var str="mediaclk:";return(str+=null!=o.id?"id=%s %s":"%v%s")+(null!=o.mediaClockValue?"=%s":"")+(null!=o.rateNumerator?" rate=%s":"")+(null!=o.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(grammar).forEach(function(key){grammar[key].forEach(function(obj){obj.reg||(obj.reg=/(.*)/),obj.format||(obj.format="%s")})})},{}],37:[function(require,module,exports){var parser=require("./parser"),require=require("./writer");exports.write=require,exports.parse=parser.parse,exports.parseParams=parser.parseParams,exports.parseFmtpConfig=parser.parseFmtpConfig,exports.parsePayloads=parser.parsePayloads,exports.parseRemoteCandidates=parser.parseRemoteCandidates,exports.parseImageAttributes=parser.parseImageAttributes,exports.parseSimulcastStreamList=parser.parseSimulcastStreamList},{"./parser":38,"./writer":39}],38:[function(require,module,exports){function parseReg(obj,location,content){var needsBlank=obj.name&&obj.names,needsBlank=(obj.push&&!location[obj.push]?location[obj.push]=[]:needsBlank&&!location[obj.name]&&(location[obj.name]={}),obj.push?{}:needsBlank?location[obj.name]:location);!function(match,location,names,rawName){if(rawName&&!names)location[rawName]=toIntIfInt(match[1]);else for(var i=0;i<names.length;i+=1)null!=match[i+1]&&(location[names[i]]=toIntIfInt(match[i+1]))}(content.match(obj.reg),needsBlank,obj.names,obj.name),obj.push&&location[obj.push].push(needsBlank)}function paramReducer(acc,expr){var s=expr.split(/=(.+)/,2);return 2===s.length?acc[s[0]]=toIntIfInt(s[1]):1===s.length&&1<expr.length&&(acc[s[0]]=void 0),acc}var toIntIfInt=function(v){return String(Number(v))===v?Number(v):v},grammar=require("./grammar"),validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(sdp){var session={},media=[],location=session;return sdp.split(/(\r\n|\r|\n)/).filter(validLine).forEach(function(l){var type=l[0],content=l.slice(2);"m"===type&&(media.push({rtp:[],fmtp:[]}),location=media[media.length-1]);for(var j=0;j<(grammar[type]||[]).length;j+=1){var obj=grammar[type][j];if(obj.reg.test(content))return parseReg(obj,location,content)}}),session.media=media,session};exports.parseParams=function(str){return str.split(/;\s?/).reduce(paramReducer,{})},exports.parseFmtpConfig=exports.parseParams,exports.parsePayloads=function(str){return str.toString().split(" ").map(Number)},exports.parseRemoteCandidates=function(str){for(var candidates=[],parts=str.split(" ").map(toIntIfInt),i=0;i<parts.length;i+=3)candidates.push({component:parts[i],ip:parts[i+1],port:parts[i+2]});return candidates},exports.parseImageAttributes=function(str){return str.split(" ").map(function(item){return item.substring(1,item.length-1).split(",").reduce(paramReducer,{})})},exports.parseSimulcastStreamList=function(str){return str.split(";").map(function(stream){return stream.split(",").map(function(format){var scid,paused=!1;return"~"!==format[0]?scid=toIntIfInt(format):(scid=toIntIfInt(format.substring(1,format.length)),paused=!0),{scid:scid,paused:paused}})})}},{"./grammar":36}],39:[function(require,module,exports){function makeLine(type,obj,location){var args=[type+"="+(obj.format instanceof Function?obj.format(obj.push?location:location[obj.name]):obj.format)];if(obj.names)for(var i=0;i<obj.names.length;i+=1){var n=obj.names[i];obj.name?args.push(location[obj.name][n]):args.push(location[obj.names[i]])}else args.push(location[obj.name]);return function(formatStr){var i=1,args=arguments,len=args.length;return formatStr.replace(formatRegExp,function(x){if(len<=i)return x;var arg=args[i];switch(i+=1,x){case"%%":return"%";case"%s":return String(arg);case"%d":return Number(arg);case"%v":return""}})}.apply(null,args)}var grammar=require("./grammar"),formatRegExp=/%[sdv%]/g,defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"];module.exports=function(session,opts){opts=opts||{},null==session.version&&(session.version=0),null==session.name&&(session.name=" "),session.media.forEach(function(mLine){null==mLine.payloads&&(mLine.payloads="")});var outerOrder=opts.outerOrder||defaultOuterOrder,innerOrder=opts.innerOrder||defaultInnerOrder,sdp=[];return outerOrder.forEach(function(type){grammar[type].forEach(function(obj){obj.name in session&&null!=session[obj.name]?sdp.push(makeLine(type,obj,session)):obj.push in session&&null!=session[obj.push]&&session[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})})}),session.media.forEach(function(mLine){sdp.push(makeLine("m",grammar.m[0],mLine)),innerOrder.forEach(function(type){grammar[type].forEach(function(obj){obj.name in mLine&&null!=mLine[obj.name]?sdp.push(makeLine(type,obj,mLine)):obj.push in mLine&&null!=mLine[obj.push]&&mLine[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})})})}),sdp.join("\r\n")+"\r\n"}},{"./grammar":36}],40:[function(require,module,exports){module.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"3.10.0",homepage:"https://jssip.net",contributors:["José Luis Millán <jmillan@aliax.net> (https://github.com/jmillan)","Iñaki Baz Castillo <ibc@aliax.net> (https://inakibaz.me)"],types:"lib/JsSIP.d.ts",main:"lib-es5/JsSIP.js",keywords:["sip","websocket","webrtc","node","browser","library"],license:"MIT",repository:{type:"git",url:"https://github.com/versatica/JsSIP.git"},bugs:{url:"https://github.com/versatica/JsSIP/issues"},dependencies:{"@types/events":"^3.0.0","@types/debug":"^4.1.7",debug:"^4.3.1",events:"^3.3.0","sdp-transform":"^2.14.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","ansi-colors":"^3.2.4",browserify:"^16.5.1",eslint:"^5.16.0","fancy-log":"^1.3.3",gulp:"^4.0.2","gulp-babel":"^8.0.0","gulp-eslint":"^5.0.0","gulp-expect-file":"^1.0.2","gulp-header":"^2.0.9","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.1","gulp-rename":"^1.4.0","gulp-uglify-es":"^1.0.4",pegjs:"^0.7.0","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},scripts:{lint:"node npm-scripts.js lint",test:"node npm-scripts.js test",prepublish:"node npm-scripts.js prepublish",release:"node npm-scripts.js release"}}},{}]},{},[8])(8)});